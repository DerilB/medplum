const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chart.js-DKzgItnz.js","assets/@kurkle-BZxJdD1U.js","assets/react-chartjs-2-O1y0Ls0q.js","assets/react-Dk2Bg5U_.js","assets/prop-types-CqkleIqs.js"])))=>i.map(i=>d[i]);
import{r as h,j as r}from"./react-Dk2Bg5U_.js";import{G as D,T,A as Ft,a as en,C as fe,L as un,B as O,b as $n,c as P,M as E,U as dt,P as Na,d as Y,e as se,f as kt,g as B,S as F,h as Bi,N as tt,i as Oe,s as Ne,j as W,k as Ua,l as $i,m as qi,n as $,o as Nr,p as Bt,D as ht,q as Vi,u as zi,r as de,F as Hi,t as Fa,v as qn,w as Wi,x as Ba,y as Ur,z as Fr,E as Br,H as $a,I as Qi,J as qa,R as $r,K as Ke,O as Va,Q as za,V as Ha,W as Fe,X as Wa,Y as Qa,Z as qr,_ as dn,$ as Dn,a0 as Ct,a1 as Gi,a2 as Ji,a3 as Ga,a4 as Vr,a5 as En,a6 as Ja,a7 as Ya,a8 as Za,a9 as Ka,aa as Xa}from"./@mantine-DA1b5jjP.js";import{c as eo}from"./react-dom-jO352gp3.js";import{N as zr,O as Vn,u as Je,a as Se,R as Yi,b as V,c as Kt,L as to,B as no}from"./react-router-dom-B8ZX0SzV.js";import{c as zn}from"./clsx-B-dksMZM.js";import{I as Zi,a as tn,b as Ki,c as Hn,d as ro,e as io,f as Yt,g as so,h as Hr,i as An,j as ao,k as oo,l as co,m as lo,n as uo,o as ho,p as mo,q as fo,r as po}from"./@tabler-m0qk4id6.js";import"./prop-types-CqkleIqs.js";import"./react-remove-scroll-D9QXrdXD.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-W8M4uLGD.js";import"./react-style-singleton-Dhqrxhhz.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-Bca7JepF.js";import"./use-callback-ref-DdJeqZBH.js";import"./react-textarea-autosize-CUArctry.js";import"./@babel-JV_V2uDp.js";import"./use-latest-Bl-cOoxe.js";import"./use-isomorphic-layout-effect-DNkaZPZ3.js";import"./use-composed-ref-BtW8ChFA.js";import"./@floating-ui-Cj6iWb6Z.js";import"./react-number-format-Cv9JaXGR.js";import"./react-transition-group-fEnPdTBy.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-CpOLBhuy.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();var go=class{constructor(e,t){this.operator=e,this.child=t}toString(){return`${this.operator}(${this.child.toString()})`}},$t=class{constructor(t,n,i){this.operator=t,this.left=n,this.right=i}toString(){return`${this.left.toString()} ${this.operator} ${this.right.toString()}`}},yo=class{constructor(){this.prefixParselets={},this.infixParselets={}}registerInfix(e,t){return this.infixParselets[e]=t,this}registerPrefix(e,t){return this.prefixParselets[e]=t,this}prefix(e,t,n){return this.registerPrefix(e,{parse(i,s){let a=i.consumeAndParse(t);return n(s,a)}})}infixLeft(e,t,n){return this.registerInfix(e,{parse(i,s,a){let o=i.consumeAndParse(t);return n(s,a,o)},precedence:t})}construct(e){return new xo(e,this.prefixParselets,this.infixParselets)}},xo=class{constructor(e,t,n){this.tokens=e,this.prefixParselets=t,this.infixParselets=n}hasMore(){return this.tokens.length>0}match(e){var t;return((t=this.peek())==null?void 0:t.id)!==e?!1:(this.consume(),!0)}consumeAndParse(e=1/0){let t=this.consume(),n=this.prefixParselets[t.id];if(!n)throw Error(`Parse error at "${t.value}" (line ${t.line}, column ${t.column}). No matching prefix parselet.`);let i=n.parse(this,t);for(;e>this.getPrecedence();){let s=this.consume();i=this.getInfixParselet(s).parse(this,i,s)}return i}getPrecedence(){let e=this.peek();if(!e)return 1/0;let t=this.getInfixParselet(e);return t?t.precedence:1/0}consume(e,t){var n,i;if(!this.tokens.length)throw Error("Cant consume unknown more tokens.");if(e&&((n=this.peek())==null?void 0:n.id)!==e){let s=this.peek();throw Error(`Expected ${e} but got "${s.id}" (${s.value}) at line ${s.line} column ${s.column}.`)}if(t&&((i=this.peek())==null?void 0:i.value)!==t){let s=this.peek();throw Error(`Expected "${t}" but got "${s.value}" at line ${s.line} column ${s.column}.`)}return this.tokens.shift()}peek(){return this.tokens.length>0?this.tokens[0]:void 0}removeComments(){this.tokens=this.tokens.filter(e=>e.id!=="Comment")}getInfixParselet(e){return this.infixParselets[e.id==="Symbol"?e.value:e.id]}},Xi="ok",vo="created",jo="not-modified",bo="not-found",Co="accepted",wo={resourceType:"OperationOutcome",id:Xi,issue:[{severity:"information",code:"informational",details:{text:"All OK"}}]},So={resourceType:"OperationOutcome",id:bo,issue:[{severity:"error",code:"not-found",details:{text:"Not found"}}]};function mt(e,t){return{resourceType:"OperationOutcome",issue:[{severity:"error",code:"invalid",details:{text:e}}]}}function G(e){return{resourceType:"OperationOutcome",issue:[{severity:"error",code:"structure",details:{text:e}}]}}function ko(e){return{resourceType:"OperationOutcome",issue:[{severity:"error",code:"exception",details:{text:"Internal server error"},diagnostics:e.toString()}]}}function Wn(e){return typeof e=="object"&&e!==null&&e.resourceType==="OperationOutcome"}function es(e){return e.id===Xi||e.id===vo||e.id===jo||e.id===Co}var U=class extends Error{constructor(e,t){super(ts(e)),this.outcome=e,this.cause=t}};function he(e){return e instanceof U?e.outcome:Wn(e)?e:mt(be(e))}function be(e){return e?typeof e=="string"?e:e instanceof Error?e.message:Wn(e)?ts(e):typeof e=="object"&&"code"in e&&typeof e.code=="string"?e.code:JSON.stringify(e):"Unknown error"}function ts(e){var n;let t=((n=e.issue)==null?void 0:n.map(ns))??[];return t.length>0?t.join("; "):"Unknown error"}function ns(e){var n,i;let t;return(n=e.details)!=null&&n.text?e.diagnostics?t=`${e.details.text} (${e.diagnostics})`:t=e.details.text:e.diagnostics?t=e.diagnostics:t="Unknown error",(i=e.expression)!=null&&i.length&&(t+=` (${e.expression.join(", ")})`),t}function Eo(e,t){let n=t.max&&t.max===Number.MAX_SAFE_INTEGER?Number.POSITIVE_INFINITY:t.max;return{path:e,description:"",type:t.type??[],min:t.min??0,max:n??1,isArray:!!n&&n>1,constraints:[]}}function To(e){let t=Object.create(null);for(let[n,i]of Object.entries(e))t[n]={name:n,elements:Object.fromEntries(Object.entries(i.elements).map(([s,a])=>[s,Eo(s,a)])),constraints:[],innerTypes:[]};return t}var Po={Element:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]}}},BackboneElement:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},modifierExtension:{max:9007199254740991,type:[{code:"Extension"}]}}},Address:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},use:{type:[{code:"code"}]},type:{type:[{code:"code"}]},text:{type:[{code:"string"}]},line:{max:9007199254740991,type:[{code:"string"}]},city:{type:[{code:"string"}]},district:{type:[{code:"string"}]},state:{type:[{code:"string"}]},postalCode:{type:[{code:"string"}]},country:{type:[{code:"string"}]},period:{type:[{code:"Period"}]}}},Age:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},Annotation:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},"author[x]":{type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Practitioner","http://hl7.org/fhir/StructureDefinition/Patient","http://hl7.org/fhir/StructureDefinition/RelatedPerson","http://hl7.org/fhir/StructureDefinition/Organization"]},{code:"string"}]},time:{type:[{code:"dateTime"}]},text:{min:1,type:[{code:"markdown"}]}}},Attachment:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},contentType:{type:[{code:"code"}]},language:{type:[{code:"code"}]},data:{type:[{code:"base64Binary"}]},url:{type:[{code:"url"}]},size:{type:[{code:"unsignedInt"}]},hash:{type:[{code:"base64Binary"}]},title:{type:[{code:"string"}]},creation:{type:[{code:"dateTime"}]}}},CodeableConcept:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},coding:{max:9007199254740991,type:[{code:"Coding"}]},text:{type:[{code:"string"}]}}},Coding:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},system:{type:[{code:"uri"}]},version:{type:[{code:"string"}]},code:{type:[{code:"code"}]},display:{type:[{code:"string"}]},userSelected:{type:[{code:"boolean"}]}}},ContactDetail:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},name:{type:[{code:"string"}]},telecom:{max:9007199254740991,type:[{code:"ContactPoint"}]}}},ContactPoint:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},system:{type:[{code:"code"}]},value:{type:[{code:"string"}]},use:{type:[{code:"code"}]},rank:{type:[{code:"positiveInt"}]},period:{type:[{code:"Period"}]}}},Contributor:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},name:{min:1,type:[{code:"string"}]},contact:{max:9007199254740991,type:[{code:"ContactDetail"}]}}},Count:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},DataRequirement:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},profile:{max:9007199254740991,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]},"subject[x]":{type:[{code:"CodeableConcept"},{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Group"]}]},mustSupport:{max:9007199254740991,type:[{code:"string"}]},codeFilter:{max:9007199254740991,type:[{code:"DataRequirementCodeFilter"}]},dateFilter:{max:9007199254740991,type:[{code:"DataRequirementDateFilter"}]},limit:{type:[{code:"positiveInt"}]},sort:{max:9007199254740991,type:[{code:"DataRequirementSort"}]}}},Distance:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},Dosage:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},modifierExtension:{max:9007199254740991,type:[{code:"Extension"}]},sequence:{type:[{code:"integer"}]},text:{type:[{code:"string"}]},additionalInstruction:{max:9007199254740991,type:[{code:"CodeableConcept"}]},patientInstruction:{type:[{code:"string"}]},timing:{type:[{code:"Timing"}]},"asNeeded[x]":{type:[{code:"boolean"},{code:"CodeableConcept"}]},site:{type:[{code:"CodeableConcept"}]},route:{type:[{code:"CodeableConcept"}]},method:{type:[{code:"CodeableConcept"}]},doseAndRate:{max:9007199254740991,type:[{code:"DosageDoseAndRate"}]},maxDosePerPeriod:{type:[{code:"Ratio"}]},maxDosePerAdministration:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},maxDosePerLifetime:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]}}},Duration:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},ElementDefinition:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},modifierExtension:{max:9007199254740991,type:[{code:"Extension"}]},path:{min:1,type:[{code:"string"}]},representation:{max:9007199254740991,type:[{code:"code"}]},sliceName:{type:[{code:"string"}]},sliceIsConstraining:{type:[{code:"boolean"}]},label:{type:[{code:"string"}]},code:{max:9007199254740991,type:[{code:"Coding"}]},slicing:{type:[{code:"ElementDefinitionSlicing"}]},short:{type:[{code:"string"}]},definition:{type:[{code:"markdown"}]},comment:{type:[{code:"markdown"}]},requirements:{type:[{code:"markdown"}]},alias:{max:9007199254740991,type:[{code:"string"}]},min:{type:[{code:"unsignedInt"}]},max:{type:[{code:"string"}]},base:{type:[{code:"ElementDefinitionBase"}]},contentReference:{type:[{code:"uri"}]},type:{max:9007199254740991,type:[{code:"ElementDefinitionType"}]},"defaultValue[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]},meaningWhenMissing:{type:[{code:"markdown"}]},orderMeaning:{type:[{code:"string"}]},"fixed[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]},"pattern[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]},example:{max:9007199254740991,type:[{code:"ElementDefinitionExample"}]},"minValue[x]":{type:[{code:"date"},{code:"dateTime"},{code:"instant"},{code:"time"},{code:"decimal"},{code:"integer"},{code:"positiveInt"},{code:"unsignedInt"},{code:"Quantity"}]},"maxValue[x]":{type:[{code:"date"},{code:"dateTime"},{code:"instant"},{code:"time"},{code:"decimal"},{code:"integer"},{code:"positiveInt"},{code:"unsignedInt"},{code:"Quantity"}]},maxLength:{type:[{code:"integer"}]},condition:{max:9007199254740991,type:[{code:"id"}]},constraint:{max:9007199254740991,type:[{code:"ElementDefinitionConstraint"}]},mustSupport:{type:[{code:"boolean"}]},isModifier:{type:[{code:"boolean"}]},isModifierReason:{type:[{code:"string"}]},isSummary:{type:[{code:"boolean"}]},binding:{type:[{code:"ElementDefinitionBinding"}]},mapping:{max:9007199254740991,type:[{code:"ElementDefinitionMapping"}]}}},Expression:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},description:{type:[{code:"string"}]},name:{type:[{code:"id"}]},language:{min:1,type:[{code:"code"}]},expression:{type:[{code:"string"}]},reference:{type:[{code:"uri"}]}}},Extension:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},url:{min:1,type:[{code:"uri"}]},"value[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]}}},HumanName:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},use:{type:[{code:"code"}]},text:{type:[{code:"string"}]},family:{type:[{code:"string"}]},given:{max:9007199254740991,type:[{code:"string"}]},prefix:{max:9007199254740991,type:[{code:"string"}]},suffix:{max:9007199254740991,type:[{code:"string"}]},period:{type:[{code:"Period"}]}}},Identifier:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},use:{type:[{code:"code"}]},type:{type:[{code:"CodeableConcept"}]},system:{type:[{code:"uri"}]},value:{type:[{code:"string"}]},period:{type:[{code:"Period"}]},assigner:{type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Organization"]}]}}},MarketingStatus:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},modifierExtension:{max:9007199254740991,type:[{code:"Extension"}]},country:{min:1,type:[{code:"CodeableConcept"}]},jurisdiction:{type:[{code:"CodeableConcept"}]},status:{min:1,type:[{code:"CodeableConcept"}]},dateRange:{min:1,type:[{code:"Period"}]},restoreDate:{type:[{code:"dateTime"}]}}},Meta:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},versionId:{type:[{code:"id"}]},lastUpdated:{type:[{code:"instant"}]},source:{type:[{code:"uri"}]},profile:{max:9007199254740991,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]},security:{max:9007199254740991,type:[{code:"Coding"}]},tag:{max:9007199254740991,type:[{code:"Coding"}]},project:{type:[{code:"uri"}]},author:{type:[{code:"Reference"}]},onBehalfOf:{type:[{code:"Reference"}]},account:{type:[{code:"Reference"}]},compartment:{max:9007199254740991,type:[{code:"Reference"}]}}},Money:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},currency:{type:[{code:"code"}]}}},Narrative:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},status:{min:1,type:[{code:"code"}]},div:{min:1,type:[{code:"xhtml"}]}}},ParameterDefinition:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},name:{type:[{code:"code"}]},use:{min:1,type:[{code:"code"}]},min:{type:[{code:"integer"}]},max:{type:[{code:"string"}]},documentation:{type:[{code:"string"}]},type:{min:1,type:[{code:"code"}]},profile:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]}}},Period:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},start:{type:[{code:"dateTime"}]},end:{type:[{code:"dateTime"}]}}},Population:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},modifierExtension:{max:9007199254740991,type:[{code:"Extension"}]},"age[x]":{type:[{code:"Range"},{code:"CodeableConcept"}]},gender:{type:[{code:"CodeableConcept"}]},race:{type:[{code:"CodeableConcept"}]},physiologicalCondition:{type:[{code:"CodeableConcept"}]}}},ProdCharacteristic:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},modifierExtension:{max:9007199254740991,type:[{code:"Extension"}]},height:{type:[{code:"Quantity"}]},width:{type:[{code:"Quantity"}]},depth:{type:[{code:"Quantity"}]},weight:{type:[{code:"Quantity"}]},nominalVolume:{type:[{code:"Quantity"}]},externalDiameter:{type:[{code:"Quantity"}]},shape:{type:[{code:"string"}]},color:{max:9007199254740991,type:[{code:"string"}]},imprint:{max:9007199254740991,type:[{code:"string"}]},image:{max:9007199254740991,type:[{code:"Attachment"}]},scoring:{type:[{code:"CodeableConcept"}]}}},ProductShelfLife:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},modifierExtension:{max:9007199254740991,type:[{code:"Extension"}]},identifier:{type:[{code:"Identifier"}]},type:{min:1,type:[{code:"CodeableConcept"}]},period:{min:1,type:[{code:"Quantity"}]},specialPrecautionsForStorage:{max:9007199254740991,type:[{code:"CodeableConcept"}]}}},Quantity:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},Range:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},low:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},high:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]}}},Ratio:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},numerator:{type:[{code:"Quantity"}]},denominator:{type:[{code:"Quantity"}]}}},Reference:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},reference:{type:[{code:"string"}]},type:{type:[{code:"uri"}]},identifier:{type:[{code:"Identifier"}]},display:{type:[{code:"string"}]}}},RelatedArtifact:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},label:{type:[{code:"string"}]},display:{type:[{code:"string"}]},citation:{type:[{code:"markdown"}]},url:{type:[{code:"url"}]},document:{type:[{code:"Attachment"}]},resource:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/Resource"]}]}}},SampledData:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},origin:{min:1,type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},period:{min:1,type:[{code:"decimal"}]},factor:{type:[{code:"decimal"}]},lowerLimit:{type:[{code:"decimal"}]},upperLimit:{type:[{code:"decimal"}]},dimensions:{min:1,type:[{code:"positiveInt"}]},data:{type:[{code:"string"}]}}},Signature:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},type:{min:1,max:9007199254740991,type:[{code:"Coding"}]},when:{min:1,type:[{code:"instant"}]},who:{min:1,type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Practitioner","http://hl7.org/fhir/StructureDefinition/PractitionerRole","http://hl7.org/fhir/StructureDefinition/RelatedPerson","http://hl7.org/fhir/StructureDefinition/Patient","http://hl7.org/fhir/StructureDefinition/Device","http://hl7.org/fhir/StructureDefinition/Organization"]}]},onBehalfOf:{type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Practitioner","http://hl7.org/fhir/StructureDefinition/PractitionerRole","http://hl7.org/fhir/StructureDefinition/RelatedPerson","http://hl7.org/fhir/StructureDefinition/Patient","http://hl7.org/fhir/StructureDefinition/Device","http://hl7.org/fhir/StructureDefinition/Organization"]}]},targetFormat:{type:[{code:"code"}]},sigFormat:{type:[{code:"code"}]},data:{type:[{code:"base64Binary"}]}}},SubstanceAmount:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},modifierExtension:{max:9007199254740991,type:[{code:"Extension"}]},"amount[x]":{type:[{code:"Quantity"},{code:"Range"},{code:"string"}]},amountType:{type:[{code:"CodeableConcept"}]},amountText:{type:[{code:"string"}]},referenceRange:{type:[{code:"SubstanceAmountReferenceRange"}]}}},Timing:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},modifierExtension:{max:9007199254740991,type:[{code:"Extension"}]},event:{max:9007199254740991,type:[{code:"dateTime"}]},repeat:{type:[{code:"TimingRepeat"}]},code:{type:[{code:"CodeableConcept"}]}}},TriggerDefinition:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},name:{type:[{code:"string"}]},"timing[x]":{type:[{code:"Timing"},{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Schedule"]},{code:"date"},{code:"dateTime"}]},data:{max:9007199254740991,type:[{code:"DataRequirement"}]},condition:{type:[{code:"Expression"}]}}},UsageContext:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},code:{min:1,type:[{code:"Coding"}]},"value[x]":{min:1,type:[{code:"CodeableConcept"},{code:"Quantity"},{code:"Range"},{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/PlanDefinition","http://hl7.org/fhir/StructureDefinition/ResearchStudy","http://hl7.org/fhir/StructureDefinition/InsurancePlan","http://hl7.org/fhir/StructureDefinition/HealthcareService","http://hl7.org/fhir/StructureDefinition/Group","http://hl7.org/fhir/StructureDefinition/Location","http://hl7.org/fhir/StructureDefinition/Organization"]}]}}},MoneyQuantity:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},SimpleQuantity:{elements:{id:{type:[{code:"string"}]},extension:{max:9007199254740991,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{max:0,type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},IdentityProvider:{elements:{authorizeUrl:{min:1,type:[{code:"string"}]},tokenUrl:{min:1,type:[{code:"string"}]},tokenAuthMethod:{type:[{code:"code"}]},userInfoUrl:{min:1,type:[{code:"string"}]},clientId:{min:1,type:[{code:"string"}]},clientSecret:{min:1,type:[{code:"string"}]},usePkce:{type:[{code:"boolean"}]},useSubject:{type:[{code:"boolean"}]}}}};function Io(e){return new Ro(e).parse()}var rs=To(Po),Qn=Object.create(null),Wr=Object.create(null);function Mn(e){let t;return e?(t=Wr[e],t||(t=Wr[e]=Object.create(null))):t=rs,t}function Qr(e,t){var i;let n=Array.isArray(e)?e:((i=e.entry)==null?void 0:i.map(s=>s.resource))??[];for(let s of n)is(s,t)}function is(e,t){if(!(e!=null&&e.name))throw new Error("Failed loading StructureDefinition from bundle");if(e.resourceType!=="StructureDefinition")return;let n=Io(e),i=Mn(t);i[e.name]=n,t&&e.url===t&&(Qn[t]=n);for(let s of n.innerTypes)s.parentType=n,i[s.name]=s}function ss(e){return!!rs[e]}function Gn(e,t){let n=Mn(t)[e];return!n&&t&&(n=Mn()[e]),n}function as(e,t){let n=Gn(e,t);if(!n)throw new U(mt("Unknown data type: "+e));return n}function os(e){return!!Qn[e]}function hn(e){return Qn[e]}var Ro=class{constructor(e){var t;if(!((t=e.snapshot)!=null&&t.element)||e.snapshot.element.length===0)throw new Error(`No snapshot defined for StructureDefinition '${e.name}'`);this.root=e.snapshot.element[0],this.elements=e.snapshot.element.slice(1),this.elementIndex=Object.create(null),this.index=0,this.resourceSchema={name:e.name,title:e.title,type:e.type,url:e.url,kind:e.kind,description:Mo(e),elements:{},constraints:this.parseElementDefinition(this.root).constraints,innerTypes:[],summaryProperties:new Set,mandatoryProperties:new Set},this.innerTypes=[]}parse(){var t,n,i,s,a;let e=this.next();for(;e;){if(e.sliceName)this.parseSliceStart(e);else if((t=e.id)!=null&&t.includes(":")){if((n=this.slicingContext)!=null&&n.current){let o=Tn(e,this.slicingContext.path);this.slicingContext.current.elements[o]=this.parseElementDefinition(e)}}else{let o=this.parseElementDefinition(e);this.checkFieldEnter(e,o);let c=this.backboneContext;for(;c;){if((i=e.path)!=null&&i.startsWith(c.path+".")){c.type.elements[Tn(e,c.path)]=o;break}c=c.parent}if(!c){let l=Tn(e,this.root.path);e.isSummary&&((s=this.resourceSchema.summaryProperties)==null||s.add(l.replace("[x]",""))),o.min>0&&((a=this.resourceSchema.mandatoryProperties)==null||a.add(l.replace("[x]",""))),this.resourceSchema.elements[l]=o}this.checkFieldExit(e)}e=this.next()}return this.checkFieldExit(),this.innerTypes.length>0&&(this.resourceSchema.innerTypes=this.innerTypes),this.resourceSchema}checkFieldEnter(e,t){this.isInnerType(e)&&this.enterInnerType(e),e.slicing&&!this.slicingContext&&this.enterSlice(e,t)}enterInnerType(e){var t,n,i;for(;this.backboneContext&&!xt((t=this.backboneContext)==null?void 0:t.path,e.path);)this.innerTypes.push(this.backboneContext.type),this.backboneContext=this.backboneContext.parent;this.backboneContext={type:{name:ni(e),title:e.label,description:e.definition,elements:{},constraints:this.parseElementDefinition(e).constraints,innerTypes:[]},path:e.path??"",parent:xt((n=this.backboneContext)==null?void 0:n.path,e.path)?this.backboneContext:(i=this.backboneContext)==null?void 0:i.parent}}enterSlice(e,t){var n,i,s,a;Ao(e)&&!((n=this.peek())!=null&&n.sliceName)||(t.slicing={discriminator:(((i=e.slicing)==null?void 0:i.discriminator)??[]).map(o=>{if(o.type!=="value"&&o.type!=="pattern"&&o.type!=="type")throw new Error(`Unsupported slicing discriminator type: ${o.type}`);return{path:o.path,type:o.type}}),slices:[],ordered:((s=e.slicing)==null?void 0:s.ordered)??!1,rule:(a=e.slicing)==null?void 0:a.rules},this.slicingContext={field:t.slicing,path:e.path??""})}checkFieldExit(e=void 0){var t;if(this.backboneContext&&!xt(this.backboneContext.path,e==null?void 0:e.path))if(this.backboneContext.parent)do this.innerTypes.push(this.backboneContext.type),this.backboneContext=this.backboneContext.parent;while(this.backboneContext&&!xt(this.backboneContext.path,e==null?void 0:e.path));else this.innerTypes.push(this.backboneContext.type),this.backboneContext=void 0;this.slicingContext&&!xt(this.slicingContext.path,e==null?void 0:e.path)&&((t=this.slicingContext)!=null&&t.current&&this.slicingContext.field.slices.push(this.slicingContext.current),this.slicingContext=void 0)}next(){let e=this.peek();if(e)return this.index++,e}peek(){var t,n,i,s,a;let e=this.elements[this.index];if(e){if(this.elementIndex[e.path??""]=e,e.contentReference){let o=e.contentReference.slice(e.contentReference.indexOf("#")+1),c=this.elementIndex[o];return c?{...c,id:e.id,path:e.path,min:e.min??c.min,max:e.max??c.max,base:{path:((t=c.base)==null?void 0:t.path)??o,min:((n=e.base)==null?void 0:n.min)??((i=c.base)==null?void 0:i.min)??c.min,max:((s=e.base)==null?void 0:s.max)??((a=c.base)==null?void 0:a.max)??c.max},contentReference:e.contentReference,definition:e.definition}:void 0}return e}}isInnerType(e){var n;let t=this.peek();return!!(xt(e==null?void 0:e.path,t==null?void 0:t.path)&&((n=e.type)!=null&&n.some(i=>["BackboneElement","Element"].includes(i.code))))}parseSliceStart(e){if(!this.slicingContext)throw new Error(`Invalid slice start before discriminator: ${e.sliceName} (${e.id})`);this.slicingContext.current&&this.slicingContext.field.slices.push(this.slicingContext.current),this.slicingContext.current={...this.parseElementDefinition(e),name:e.sliceName??"",definition:e.definition,elements:{}}}parseElementDefinitionType(e){return(e.type??[]).map(t=>{var i;let n;return(t.code==="BackboneElement"||t.code==="Element")&&(n=ni(e)),n||(n=(i=qt(t,"http://hl7.org/fhir/StructureDefinition/structuredefinition-fhir-type"))==null?void 0:i.valueUrl),n||(n=t.code??""),{code:n,targetProfile:t.targetProfile,profile:t.profile}})}parseElementDefinition(e){var s,a;let t=Gr(e.max),n=(s=e.base)!=null&&s.max?Gr(e.base.max):t,i={type:"ElementDefinition",value:e};return{description:e.definition||"",path:e.path||((a=e.base)==null?void 0:a.path)||"",min:e.min??0,max:t,isArray:n>1,constraints:(e.constraint??[]).map(o=>({key:o.key??"",severity:o.severity??"error",expression:o.expression??"",description:o.human??""})),type:this.parseElementDefinitionType(e),fixed:Jr(ie(i,"fixed[x]")),pattern:Jr(ie(i,"pattern[x]")),binding:e.binding}}};function Gr(e){return e==="*"?Number.POSITIVE_INFINITY:Number.parseInt(e,10)}function Tn(e,t=""){return Do(e.path,t)}function Do(e,t){return e?t&&e.startsWith(t)?e.substring(t.length+1):e:""}function xt(e,t){return!e||!t?!1:t.startsWith(e+".")||t===e}function Jr(e){return Array.isArray(e)&&e.length>0?e[0]:re(e)?void 0:e}function Ao(e){var n,i;let t=(n=e.slicing)==null?void 0:n.discriminator;return!!((i=e.type)!=null&&i.some(s=>s.code==="Extension")&&(t==null?void 0:t.length)===1&&t[0].type==="value"&&t[0].path==="url")}function Mo(e){let t=e.description;return t!=null&&t.startsWith(`Base StructureDefinition for ${e.name} Type: `)&&(t=t.substring(`Base StructureDefinition for ${e.name} Type: `.length)),t}function _o(e,t,n){if(e===void 0)return[void 0];if(t==="$this")return[e];let i=n!=null&&n.withPath?Oo:ie,[s,...a]=t.split("."),o=[i(e,s,n)];for(let c of a){let l=[];for(let u of o)if(Array.isArray(u))for(let d of u)l.push(i(d,c,n));else(n!=null&&n.withPath&&u&&u.value!==void 0||!(n!=null&&n.withPath)&&u!==void 0)&&l.push(i(u,c,n));o=l}return o}function Oo(e,t,n){let i=e.path;return Lo(ie(e,t,n),i,t)}function Lo(e,t,n){let i=t?t+".":"";return e===void 0?{type:"undefined",value:void 0,path:`${i}${n}`}:Array.isArray(e)?e.map((s,a)=>({...s,path:`${i}${n}[${a}]`})):{...e,path:`${i}${n}`}}var cs={base64Binary:/^([A-Za-z\d+/]{4})*([A-Za-z\d+/]{2}==|[A-Za-z\d+/]{3}=)?$/,canonical:/^\S*$/,code:/^[^\s]+( [^\s]+)*$/,date:/^(\d(\d(\d[1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2]\d|3[0-1]))?)?$/,dateTime:/^(\d(\d(\d[1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2]\d|3[0-1])(T([01]\d|2[0-3])(:[0-5]\d:([0-5]\d|60)(\.\d{1,9})?)?)?)?(Z|[+-]((0\d|1[0-3]):[0-5]\d|14:00)?)?)?$/,id:/^[A-Za-z0-9\-.]{1,64}$/,instant:/^(\d(\d(\d[1-9]|[1-9]0)|[1-9]00)|[1-9]000)-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])T([01]\d|2[0-3]):[0-5]\d:([0-5]\d|60)(\.\d{1,9})?(Z|[+-]((0\d|1[0-3]):[0-5]\d|14:00))$/,markdown:/^[\s\S]+$/,oid:/^urn:oid:[0-2](\.(0|[1-9]\d*))+$/,string:/^[\s\S]+$/,time:/^([01]\d|2[0-3]):[0-5]\d:([0-5]\d|60)(\.\d{1,9})?$/,uri:/^\S*$/,url:/^\S*$/,uuid:/^urn:uuid:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/,xhtml:/.*/};function No(e,t,n,i){var o;if(Array.isArray(e))return!1;let s;t.path==="$this"?s=n:s=(i??n.elements)[t.path];let a=n.type;switch(t.type){case"value":case"pattern":if(!e||!s)return!1;if(s.pattern)return Kn(e,s.pattern);if(s.fixed)return Qe(e,s.fixed);if(((o=s.binding)==null?void 0:o.strength)==="required"&&s.binding.valueSet)return!0;break;case"type":return!e||!(a!=null&&a.length)?!1:a.some(c=>c.code===e.type)}return!1}function R(e){return[{type:b.boolean,value:e}]}function nt(e){return e==null?{type:"undefined",value:void 0}:Number.isSafeInteger(e)?{type:b.integer,value:e}:typeof e=="number"?{type:b.decimal,value:e}:typeof e=="boolean"?{type:b.boolean,value:e}:typeof e=="string"?{type:b.string,value:e}:je(e)?{type:b.Quantity,value:e}:Tt(e)?{type:e.resourceType,value:e}:{type:b.BackboneElement,value:e}}function ze(e){return e.length===0?!1:!!e[0].value}function We(e,t){if(e.length!==0){if(e.length===1&&(!t||e[0].type===t))return e[0];throw new Error(`Expected singleton of type ${t}, but found ${JSON.stringify(e)}`)}}function ie(e,t,n){if(!e.value)return;let i=fn(e.type,t,n==null?void 0:n.profileUrl);return i?Uo(e,t,i):Fo(e,t)}function Uo(e,t,n){let i=e.value,s=n.type;if(!s||s.length===0)return;let a,o="undefined",c;if(n.path.endsWith("[x]")){let l=n.path.split(".").pop().replace("[x]","");for(let u of s){let d=l+De(u.code);if(a=i[d],c=i["_"+d],a!==void 0||c!==void 0){o=u.code;break}}}else console.assert(s.length===1,"Expected single type",n.path),a=i[t],o=s[0].code,c=i["_"+t];if(c)if(Array.isArray(a)){a=a.slice();for(let l=0;l<Math.max(a.length,c.length);l++)a[l]=Xr(a[l],c[l])}else a=Xr(a,c);if(!re(a))return(o==="Element"||o==="BackboneElement")&&(o=n.type[0].code),Array.isArray(a)?a.map(l=>Yr(l,o)):Yr(a,o)}function Yr(e,t){return t==="Resource"&&Tt(e)&&(t=e.resourceType),{type:t,value:e}}function Fo(e,t){let n=e.value;if(!n||typeof n!="object")return;let i;if(t in n)i=n[t];else for(let s in b){let a=t+De(s);if(a in n){i=n[a];break}}if(!re(i))return Array.isArray(i)?i.map(nt):nt(i)}function ls(e){let t=[];for(let n of e){let i=!1;for(let s of t)if(ze(Jn(n,s))){i=!0;break}i||t.push(n)}return t}function Bo(e){return R(!ze(e))}function $o(e,t){return e.length===0||t.length===0?[]:e.length!==t.length?R(!1):R(e.every((n,i)=>ze(Jn(n,t[i]))))}function qo(e,t){return e.length===0||t.length===0?[]:e.length!==t.length?R(!0):R(e.some((n,i)=>!ze(Jn(n,t[i]))))}function Jn(e,t){var s,a;let n=(s=e.value)==null?void 0:s.valueOf(),i=(a=t.value)==null?void 0:a.valueOf();return typeof n=="number"&&typeof i=="number"?R(Math.abs(n-i)<1e-8):je(n)&&je(i)?R(hs(n,i)):R(typeof n=="object"&&typeof i=="object"?Yn(e,t):n===i)}function us(e,t){return e.length===0&&t.length===0?R(!0):e.length!==t.length?R(!1):(e.sort(Zr),t.sort(Zr),R(e.every((n,i)=>ze(Vo(n,t[i])))))}function Vo(e,t){let{type:n,value:i}=e,{type:s,value:a}=t,o=i==null?void 0:i.valueOf(),c=a==null?void 0:a.valueOf();return typeof o=="number"&&typeof c=="number"?R(Math.abs(o-c)<.01):je(o)&&je(c)?R(hs(o,c)):R(n==="Coding"&&s==="Coding"?typeof o!="object"||typeof c!="object"?!1:o.code===c.code&&o.system===c.system:typeof o=="object"&&typeof c=="object"?Yn({...o,id:void 0},{...c,id:void 0}):typeof o=="string"&&typeof c=="string"?o.toLowerCase()===c.toLowerCase():o===c)}function Zr(e,t){var s,a;let n=(s=e.value)==null?void 0:s.valueOf(),i=(a=t.value)==null?void 0:a.valueOf();return typeof n=="number"&&typeof i=="number"?n-i:typeof n=="string"&&typeof i=="string"?n.localeCompare(i):0}function ds(e,t){let{value:n}=e;if(n==null)return!1;switch(t){case"Boolean":return typeof n=="boolean";case"Decimal":case"Integer":return typeof n=="number";case"Date":return zo(n);case"DateTime":return _n(n);case"Time":return typeof n=="string"&&!!/^T\d/.exec(n);case"Period":return Ho(n);case"Quantity":return je(n);default:return typeof n=="object"&&(n==null?void 0:n.resourceType)===t}}function zo(e){return typeof e=="string"&&!!cs.date.exec(e)}function _n(e){return typeof e=="string"&&!!cs.dateTime.exec(e)}function Ho(e){return!!(e&&typeof e=="object"&&("start"in e&&_n(e.start)||"end"in e&&_n(e.end)))}function je(e){return!!(e&&typeof e=="object"&&"value"in e&&typeof e.value=="number")}function hs(e,t){return Math.abs(e.value-t.value)<.01&&(e.unit===t.unit||e.code===t.code||e.unit===t.code||e.code===t.unit)}function Yn(e,t){let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let s of n){let a=e[s],o=t[s];if(Kr(a)&&Kr(o)){if(!Yn(a,o))return!1}else if(a!==o)return!1}return!0}function Kr(e){return e!==null&&typeof e=="object"}function Xr(e,t){if(t){if(typeof t!="object")throw new Error("Primitive extension must be an object");return Wo(e??{},t)}return e}function Wo(e,t){return delete t.__proto__,delete t.constructor,Object.assign(e,t)}function Le(e){let t=Z(e),n=Et(e);return n===t?{reference:t}:{reference:t,display:n}}function Z(e){return pt(e)?e.reference:`${e.resourceType}/${e.id}`}function Zn(e){if(e)return pt(e)?e.reference.split("/")[1]:e.id}function Qo(e){return e.resourceType==="Patient"||e.resourceType==="Practitioner"||e.resourceType==="RelatedPerson"}function Et(e){if(Qo(e)){let t=Go(e);if(t)return t}if(e.resourceType==="Device"){let t=Jo(e);if(t)return t}if(e.resourceType==="MedicationRequest"&&e.medicationCodeableConcept)return wt(e.medicationCodeableConcept);if(e.resourceType==="Subscription"&&e.criteria)return e.criteria;if(e.resourceType==="User"&&e.email)return e.email;if("name"in e&&e.name&&typeof e.name=="string")return e.name;if("code"in e&&e.code){let t=e.code;if(Array.isArray(t)&&(t=t[0]),sc(t))return wt(t);if(ac(t))return t.text}return Z(e)}function Go(e){let t=e.name;if(t&&t.length>0)return Vt(t[0])}function Jo(e){let t=e.deviceName;if(t&&t.length>0)return t[0].name}function Yo(e){if(!("photo"in e))return;let t=e.photo;if(t)if(Array.isArray(t))for(let n of t){let i=ei(n);if(i)return i}else return ei(t)}function ei(e){var t;if(e.url&&((t=e.contentType)!=null&&t.startsWith("image/")))return e.url}function Zo(e,t){let n=new Date(e);n.setUTCHours(0,0,0,0);let i=t?new Date(t):new Date;i.setUTCHours(0,0,0,0);let s=n.getUTCFullYear(),a=n.getUTCMonth(),o=n.getUTCDate(),c=i.getUTCFullYear(),l=i.getUTCMonth(),u=i.getUTCDate(),d=c-s;(l<a||l===a&&u<o)&&d--;let m=c*12+l-(s*12+a);u<o&&m--;let f=Math.floor((i.getTime()-n.getTime())/(1e3*60*60*24));return{years:d,months:m,days:f}}function qt(e,...t){var i;let n=e;for(let s=0;s<t.length&&n;s++)n=(i=n==null?void 0:n.extension)==null?void 0:i.find(a=>a.url===t[s]);return n}function rt(e,t){return JSON.stringify(e,Ko,void 0)}function Ko(e,t){return!Xo(e)&&re(t)?void 0:t}function Xo(e){return!!/\d+$/.exec(e)}function re(e){if(e==null)return!0;let t=typeof e;return t==="string"||t==="object"?!Ye(e):!1}function Ye(e){if(e==null)return!1;let t=typeof e;return t==="string"&&e!==""||t==="object"&&("length"in e&&e.length>0||Object.keys(e).length>0)}function Qe(e,t,n){return e===t||re(e)&&re(t)?!0:re(e)||re(t)?!1:Array.isArray(e)&&Array.isArray(t)?ec(e,t):Array.isArray(e)||Array.isArray(t)?!1:Ie(e)&&Ie(t)?tc(e,t,n):!1}function ec(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Qe(e[n],t[n]))return!1;return!0}function tc(e,t,n){let i=new Set;Object.keys(e).forEach(s=>i.add(s)),Object.keys(t).forEach(s=>i.add(s)),n==="meta"&&(i.delete("versionId"),i.delete("lastUpdated"),i.delete("author"));for(let s of i){let a=e[s],o=t[s];if(!Qe(a,o,s))return!1}return!0}function Kn(e,t){return re(e)?!0:re(t)?!1:Array.isArray(e)&&Array.isArray(t)?nc(e,t):Array.isArray(e)||Array.isArray(t)?!1:Ie(e)&&Ie(t)?rc(e,t):Ie(e)||Ie(t)?!1:e===t}function nc(e,t){return t.every(n=>e.some(i=>Kn(i,n)))}function rc(e,t){return Object.entries(t).every(([n,i])=>n in e&&Kn(e[n],i))}function Ie(e){return e!==null&&typeof e=="object"}function ic(e){return Ie(e)&&"code"in e&&typeof e.code=="string"}function sc(e){return Ie(e)&&"coding"in e&&Array.isArray(e.coding)&&e.coding.every(ic)}function ac(e){return Ie(e)&&"text"in e&&typeof e.text=="string"}var ms=[];for(let e=0;e<256;e++)ms.push(e.toString(16).padStart(2,"0"));function oc(e){let t=new Uint8Array(e),n=new Array(t.length);for(let i=0;i<t.length;i++)n[i]=ms[t[i]];return n.join("")}function cc(e){let t=new Uint8Array(e),n=[];for(let i=0;i<t.length;i++)n[i]=String.fromCharCode(t[i]);return window.btoa(n.join(""))}function De(e){return e?e.charAt(0).toUpperCase()+e.substring(1):""}function lc(e,t){let n=e+".";if(t.startsWith(n))return t.slice(n.length)}var ti=e=>new Promise(t=>{setTimeout(t,e)});function On(e,t,n){let i=[];for(let s=0;s<n-1;s++){let a=e.indexOf(t);if(a<0)break;i.push(e.slice(0,a)),e=e.slice(a+t.length)}return i.push(e),i}function uc(e){let t,n=!1;return function(){return n||(t=e(),n=!0),t}}function Mt(e,t){return e?(e.push(t),e):[t]}function Xn(e){return e.sort((t,n)=>t.localeCompare(n))}function fs(e){return e.endsWith("/")?e:e+"/"}function dc(e){return e.startsWith("/")?e.slice(1):e}function Ve(e,t){return new URL(dc(t),fs(e.toString())).toString()}function hc(e,t){return Ve(e,t).toString().replace("http://","ws://").replace("https://","wss://")}function mc(e){return typeof e=="object"&&!Array.isArray(e)&&!(e instanceof URLSearchParams)&&(e=Object.fromEntries(Object.entries(e).filter(t=>t[1]!==void 0))),new URLSearchParams(e).toString()}function fc(e,t){let n=[];if(e.line&&n.push(...e.line),e.city||e.state||e.postalCode){let i=[];e.city&&i.push(e.city),e.state&&i.push(e.state),e.postalCode&&i.push(e.postalCode),n.push(i.join(", "))}return e.use&&(t!=null&&t.use)&&n.push("["+e.use+"]"),n.join(", ").trim()}function Vt(e,t){let n=[];if(e.prefix&&(t==null?void 0:t.prefix)!==!1&&n.push(...e.prefix),e.given&&n.push(...e.given),e.family&&n.push(e.family),e.suffix&&(t==null?void 0:t.suffix)!==!1&&n.push(...e.suffix),e.use&&(t!=null&&t.all||t!=null&&t.use)&&n.push("["+e.use+"]"),n.length===0){let i=St(e.text);if(i)return i}return n.join(" ").trim()}function er(e){let t=[];return e.given&&t.push(...e.given),t.join(" ").trim()}function ps(e){return St(e.family)??""}function zt(e){return e instanceof Date&&!isNaN(e.getTime())}function ft(e,t,n){if(!e)return"";let i=new Date(e);return zt(i)?(i.setUTCHours(0,0,0,0),i.toLocaleDateString(t,{timeZone:"UTC",...n})):""}function pc(e,t,n){if(!e)return"";let i=new Date("2000-01-01T"+e+"Z");return zt(i)?i.toLocaleTimeString(t,n):""}function Ce(e,t,n){if(!e)return"";let i=new Date(e);return zt(i)?i.toLocaleString(t,n):""}function gc(e,t,n){return!e||!e.start&&!e.end?"":Ce(e.start,t,n)+" - "+Ce(e.end,t,n)}var yc={s:"every second",min:"every minute",h:"hourly",d:"daily",wk:"weekly",mo:"monthly",a:"annually"},xc={s:"second",min:"minute",h:"hour",d:"day",wk:"week",mo:"month",a:"year"},vc={s:"seconds",min:"minutes",h:"hours",d:"days",wk:"weeks",mo:"months",a:"years"};function gs(e){if(!e)return"";let t=[];return jc(t,e.repeat),e.event&&t.push(e.event.map(n=>Ce(n)).join(", ")),De(t.join(" ").trim())}function jc(e,t){if(!(t!=null&&t.periodUnit))return;let n=t.frequency??1,i=t.period??1,s=t.periodUnit;n===1&&i===1?e.push(yc[s]):(n===1?e.push("once"):e.push(n+" times"),i===1?e.push("per "+xc[s]):e.push("per "+i+" "+vc[s])),t.dayOfWeek&&e.push("on "+t.dayOfWeek.map(De).join(", ")),t.timeOfDay&&e.push("at "+t.timeOfDay.map(a=>pc(a)).join(", "))}function bc(e,t,n=!1){if(n&&t===void 0)throw new Error("Precision must be specified for exclusive ranges");let i=(e==null?void 0:e.low)&&{...e.low,comparator:void 0},s=(e==null?void 0:e.high)&&{...e.high,comparator:void 0};return(i==null?void 0:i.value)===void 0&&(s==null?void 0:s.value)===void 0?"":(i==null?void 0:i.value)!==void 0&&(s==null?void 0:s.value)===void 0?n&&t!==void 0?(i.value=Sc(i.value,t),`> ${Xe(i)}`):`>= ${Xe(i)}`:(i==null?void 0:i.value)===void 0&&(s==null?void 0:s.value)!==void 0?n&&t!==void 0?(s.value=wc(s.value,t),`< ${Xe(s)}`):`<= ${Xe(s)}`:((i==null?void 0:i.unit)===(s==null?void 0:s.unit)&&(i==null||delete i.unit),`${Xe(i)} - ${Xe(s)}`)}function Xe(e,t){if(!e)return"";let n=[];return e.comparator&&(n.push(e.comparator),n.push(" ")),e.value!==void 0&&n.push(e.value),e.unit&&(e.unit!=="%"&&n[n.length-1]!==" "&&n.push(" "),n.push(e.unit)),n.join("").trim()}function Cc(e){return(e==null?void 0:e.value)===void 0?"":e.value.toLocaleString(void 0,{style:"currency",currency:e.currency??"USD",currencyDisplay:"narrowSymbol"})}function wt(e){return e?St(e.text)||(e.coding?e.coding.map(n=>at(n)).join(", "):""):""}function at(e){return St(e==null?void 0:e.display)??St(e==null?void 0:e.code)??""}function mn(e){if(!e)return"";let t=[];if(e.valueQuantity)t.push(Xe(e.valueQuantity));else if(e.valueCodeableConcept)t.push(wt(e.valueCodeableConcept));else{let n=St(e.valueString);n&&t.push(n)}return"component"in e&&t.push(e.component.map(n=>mn(n)).join(" / ")),t.join(" / ").trim()}function St(e){return typeof e=="string"?e:void 0}function wc(e,t,n=1){return(ys(e,t)+n)*Math.pow(10,-t)}function Sc(e,t,n=1){return(ys(e,t)-n)*Math.pow(10,-t)}function ys(e,t){return t===void 0?e:Math.round(e*Math.pow(10,t))}var b={Address:"Address",Age:"Age",Annotation:"Annotation",Attachment:"Attachment",BackboneElement:"BackboneElement",CodeableConcept:"CodeableConcept",Coding:"Coding",ContactDetail:"ContactDetail",ContactPoint:"ContactPoint",Contributor:"Contributor",Count:"Count",DataRequirement:"DataRequirement",Distance:"Distance",Dosage:"Dosage",Duration:"Duration",Expression:"Expression",Extension:"Extension",HumanName:"HumanName",Identifier:"Identifier",MarketingStatus:"MarketingStatus",Meta:"Meta",Money:"Money",Narrative:"Narrative",ParameterDefinition:"ParameterDefinition",Period:"Period",Population:"Population",ProdCharacteristic:"ProdCharacteristic",ProductShelfLife:"ProductShelfLife",Quantity:"Quantity",Range:"Range",Ratio:"Ratio",Reference:"Reference",RelatedArtifact:"RelatedArtifact",SampledData:"SampledData",Signature:"Signature",SubstanceAmount:"SubstanceAmount",SystemString:"http://hl7.org/fhirpath/System.String",Timing:"Timing",TriggerDefinition:"TriggerDefinition",UsageContext:"UsageContext",base64Binary:"base64Binary",boolean:"boolean",canonical:"canonical",code:"code",date:"date",dateTime:"dateTime",decimal:"decimal",id:"id",instant:"instant",integer:"integer",markdown:"markdown",oid:"oid",positiveInt:"positiveInt",string:"string",time:"time",unsignedInt:"unsignedInt",uri:"uri",url:"url",uuid:"uuid"};function kc(e){for(let t of e.base??[]){let n=Ue.types[t];n||(n={searchParamsDetails:{}},Ue.types[t]=n),n.searchParams||(n.searchParams={_id:{base:[t],code:"_id",type:"token",expression:t+".id"},_lastUpdated:{base:[t],code:"_lastUpdated",type:"date",expression:t+".meta.lastUpdated"},_compartment:{base:[t],code:"_compartment",type:"reference",expression:t+".meta.compartment"},_profile:{base:[t],code:"_profile",type:"uri",expression:t+".meta.profile"},_security:{base:[t],code:"_security",type:"token",expression:t+".meta.security"},_source:{base:[t],code:"_source",type:"uri",expression:t+".meta.source"},_tag:{base:[t],code:"_tag",type:"token",expression:t+".meta.tag"}}),n.searchParams[e.code]=e}}function ni(e){var n,i,s,a;let t=(i=(n=e.type)==null?void 0:n[0])==null?void 0:i.code;return t==="BackboneElement"||t==="Element"?Ec((a=((s=e.base)==null?void 0:s.path)??e.path)==null?void 0:a.split(".")):t}function Ec(e){return e.length===1?e[0]:e.map(De).join("")}function tr(e){var t;return(t=Ue.types[e])==null?void 0:t.searchParams}function Tc(e,t){var n,i;return(i=(n=Ue.types[e])==null?void 0:n.searchParams)==null?void 0:i[t]}function nn(e){let t=e.replaceAll("[x]","").split(".").pop();return Pc(t)}function Pc(e){let t;return e.length<100?t=e.match(/[A-Z]+(?![a-z])|[A-Z]?[a-z]+|\d+/g)??[]:t=e.split(/(?=[A-Z])/),t.map(Rc).join(" ").replace("_"," ").replace(/\s+/g," ")}var Ic=new Set(["ID","IP","PKCE","JWKS","URI","URL","OMB","UDI"]);function Rc(e){let t=e.toUpperCase();return e===t?e:Ic.has(t)?t:t.charAt(0)+e.slice(1)}function fn(e,t,n){let i=Gn(e,n);if(i)return Dc(i.elements,t)}function Dc(e,t){let n=e[t]??e[t+"[x]"];if(n)return n;for(let i=0;i<t.length;i++){let s=t[i];if(s>="A"&&s<="Z"){let a=t.slice(0,i)+"[x]",o=e[a];if(o)return o}}}function Tt(e){return!!(e&&typeof e=="object"&&"resourceType"in e)}function pt(e){return!!(e&&typeof e=="object"&&"reference"in e&&typeof e.reference=="string")}var Ue={types:{}};function Xt(e){if(e.startsWith("T"))return e+"T00:00:00.000Z".substring(e.length);if(e.length<=10)return e;try{return new Date(e).toISOString()}catch{return e}}var qe=()=>[],ue={empty:(e,t)=>R(t.length===0||t.every(n=>re(n.value))),hasValue:(e,t)=>R(t.length!==0),exists:(e,t,n)=>R(n?t.filter(i=>ze(n.eval(e,[i]))).length>0:t.length>0&&t.every(i=>!re(i.value))),all:(e,t,n)=>R(t.every(i=>ze(n.eval(e,[i])))),allTrue:(e,t)=>{for(let n of t)if(!n.value)return R(!1);return R(!0)},anyTrue:(e,t)=>{for(let n of t)if(n.value)return R(!0);return R(!1)},allFalse:(e,t)=>{for(let n of t)if(n.value)return R(!1);return R(!0)},anyFalse:(e,t)=>{for(let n of t)if(!n.value)return R(!0);return R(!1)},subsetOf:(e,t,n)=>{if(t.length===0)return R(!0);let i=n.eval(e,ct(e));return i.length===0?R(!1):R(t.every(s=>i.some(a=>a.value===s.value)))},supersetOf:(e,t,n)=>{let i=n.eval(e,ct(e));return i.length===0?R(!0):t.length===0?R(!1):R(i.every(s=>t.some(a=>a.value===s.value)))},count:(e,t)=>[{type:b.integer,value:t.length}],distinct:(e,t)=>{let n=[];for(let i of t)n.some(s=>s.value===i.value)||n.push(i);return n},isDistinct:(e,t)=>R(t.length===ue.distinct(e,t).length),where:(e,t,n)=>t.filter(i=>ze(n.eval(e,[i]))),select:(e,t,n)=>t.map(i=>n.eval(e,[i])).flat(),repeat:qe,ofType:(e,t,n)=>t.filter(i=>i.type===n.name),single:(e,t)=>{if(t.length>1)throw new Error("Expected input length one for single()");return t.length===0?[]:t.slice(0,1)},first:(e,t)=>t.length===0?[]:t.slice(0,1),last:(e,t)=>t.length===0?[]:t.slice(t.length-1,t.length),tail:(e,t)=>t.length===0?[]:t.slice(1,t.length),skip:(e,t,n)=>{var s;let i=(s=n.eval(e,t)[0])==null?void 0:s.value;if(typeof i!="number")throw new Error("Expected a number for skip(num)");return i>=t.length?[]:i<=0?t:t.slice(i,t.length)},take:(e,t,n)=>{var s;let i=(s=n.eval(e,t)[0])==null?void 0:s.value;if(typeof i!="number")throw new Error("Expected a number for take(num)");return i>=t.length?t:i<=0?[]:t.slice(0,i)},intersect:(e,t,n)=>{if(!n)return t;let i=n.eval(e,ct(e)),s=[];for(let a of t)!s.some(o=>o.value===a.value)&&i.some(o=>o.value===a.value)&&s.push(a);return s},exclude:(e,t,n)=>{if(!n)return t;let i=n.eval(e,ct(e)),s=[];for(let a of t)i.some(o=>o.value===a.value)||s.push(a);return s},union:(e,t,n)=>{if(!n)return t;let i=n.eval(e,ct(e));return ls([...t,...i])},combine:(e,t,n)=>{if(!n)return t;let i=n.eval(e,ct(e));return[...t,...i]},htmlChecks:(e,t,n)=>[nt(!0)],iif:(e,t,n,i,s)=>{let a=n.eval(e,t);if(a.length>1||a.length===1&&typeof a[0].value!="boolean")throw new Error("Expected criterion to evaluate to a Boolean");return ze(a)?i.eval(e,t):s?s.eval(e,t):[]},toBoolean:(e,t)=>{if(t.length===0)return[];let[{value:n}]=_e(t,1);if(typeof n=="boolean")return[{type:b.boolean,value:n}];if(typeof n=="number"&&(n===0||n===1))return R(!!n);if(typeof n=="string"){let i=n.toLowerCase();if(["true","t","yes","y","1","1.0"].includes(i))return R(!0);if(["false","f","no","n","0","0.0"].includes(i))return R(!1)}return[]},convertsToBoolean:(e,t)=>t.length===0?[]:R(ue.toBoolean(e,t).length===1),toInteger:(e,t)=>{if(t.length===0)return[];let[{value:n}]=_e(t,1);return typeof n=="number"?[{type:b.integer,value:n}]:typeof n=="string"&&/^[+-]?\d+$/.exec(n)?[{type:b.integer,value:parseInt(n,10)}]:typeof n=="boolean"?[{type:b.integer,value:n?1:0}]:[]},convertsToInteger:(e,t)=>t.length===0?[]:R(ue.toInteger(e,t).length===1),toDate:(e,t)=>{if(t.length===0)return[];let[{value:n}]=_e(t,1);return typeof n=="string"&&/^\d{4}(-\d{2}(-\d{2})?)?/.exec(n)?[{type:b.date,value:Xt(n)}]:[]},convertsToDate:(e,t)=>t.length===0?[]:R(ue.toDate(e,t).length===1),toDateTime:(e,t)=>{if(t.length===0)return[];let[{value:n}]=_e(t,1);return typeof n=="string"&&/^\d{4}(-\d{2}(-\d{2})?)?/.exec(n)?[{type:b.dateTime,value:Xt(n)}]:[]},convertsToDateTime:(e,t)=>t.length===0?[]:R(ue.toDateTime(e,t).length===1),toDecimal:(e,t)=>{if(t.length===0)return[];let[{value:n}]=_e(t,1);return typeof n=="number"?[{type:b.decimal,value:n}]:typeof n=="string"&&/^-?\d{1,9}(\.\d{1,9})?$/.exec(n)?[{type:b.decimal,value:parseFloat(n)}]:typeof n=="boolean"?[{type:b.decimal,value:n?1:0}]:[]},convertsToDecimal:(e,t)=>t.length===0?[]:R(ue.toDecimal(e,t).length===1),toQuantity:(e,t)=>{if(t.length===0)return[];let[{value:n}]=_e(t,1);return je(n)?[{type:b.Quantity,value:n}]:typeof n=="number"?[{type:b.Quantity,value:{value:n,unit:"1"}}]:typeof n=="string"&&/^-?\d{1,9}(\.\d{1,9})?/.exec(n)?[{type:b.Quantity,value:{value:parseFloat(n),unit:"1"}}]:typeof n=="boolean"?[{type:b.Quantity,value:{value:n?1:0,unit:"1"}}]:[]},convertsToQuantity:(e,t)=>t.length===0?[]:R(ue.toQuantity(e,t).length===1),toString:(e,t)=>{if(t.length===0)return[];let[{value:n}]=_e(t,1);return n==null?[]:je(n)?[{type:b.string,value:`${n.value} '${n.unit}'`}]:[{type:b.string,value:n.toString()}]},convertsToString:(e,t)=>t.length===0?[]:R(ue.toString(e,t).length===1),toTime:(e,t)=>{if(t.length===0)return[];let[{value:n}]=_e(t,1);if(typeof n=="string"){let i=/^T?(\d{2}(:\d{2}(:\d{2})?)?)/.exec(n);if(i)return[{type:b.time,value:Xt("T"+i[1])}]}return[]},convertsToTime:(e,t)=>t.length===0?[]:R(ue.toTime(e,t).length===1),indexOf:(e,t,n)=>ye((i,s)=>i.indexOf(s),e,t,n),substring:(e,t,n,i)=>ye((s,a,o)=>{let c=a,l=o?c+o:s.length;return c<0||c>=s.length?void 0:s.substring(c,l)},e,t,n,i),startsWith:(e,t,n)=>ye((i,s)=>i.startsWith(s),e,t,n),endsWith:(e,t,n)=>ye((i,s)=>i.endsWith(s),e,t,n),contains:(e,t,n)=>ye((i,s)=>i.includes(s),e,t,n),upper:(e,t)=>ye(n=>n.toUpperCase(),e,t),lower:(e,t)=>ye(n=>n.toLowerCase(),e,t),replace:(e,t,n,i)=>ye((s,a,o)=>s.replaceAll(a,o),e,t,n,i),matches:(e,t,n)=>ye((i,s)=>!!new RegExp(s).exec(i),e,t,n),replaceMatches:(e,t,n,i)=>ye((s,a,o)=>s.replaceAll(a,o),e,t,n,i),length:(e,t)=>ye(n=>n.length,e,t),toChars:(e,t)=>ye(n=>n?n.split(""):void 0,e,t),encode:qe,decode:qe,escape:qe,unescape:qe,trim:qe,split:qe,join:(e,t,n)=>{var s;let i=((s=n==null?void 0:n.eval(e,ct(e))[0])==null?void 0:s.value)??"";if(typeof i!="string")throw new Error("Separator must be a string.");return[{type:b.string,value:t.map(a=>{var o;return((o=a.value)==null?void 0:o.toString())??""}).join(i)}]},abs:(e,t)=>Me(Math.abs,e,t),ceiling:(e,t)=>Me(Math.ceil,e,t),exp:(e,t)=>Me(Math.exp,e,t),floor:(e,t)=>Me(Math.floor,e,t),ln:(e,t)=>Me(Math.log,e,t),log:(e,t,n)=>Me((i,s)=>Math.log(i)/Math.log(s),e,t,n),power:(e,t,n)=>Me(Math.pow,e,t,n),round:(e,t)=>Me(Math.round,e,t),sqrt:(e,t)=>Me(Math.sqrt,e,t),truncate:(e,t)=>Me(n=>n|0,e,t),children:qe,descendants:qe,trace:(e,t,n)=>t,now:()=>[{type:b.dateTime,value:new Date().toISOString()}],timeOfDay:()=>[{type:b.time,value:new Date().toISOString().substring(11)}],today:()=>[{type:b.date,value:new Date().toISOString().substring(0,10)}],between:(e,t,n,i,s)=>{var u;let a=ue.toDateTime(e,n.eval(e,t));if(a.length===0)throw new Error("Invalid start date");let o=ue.toDateTime(e,i.eval(e,t));if(o.length===0)throw new Error("Invalid end date");let c=(u=s.eval(e,t)[0])==null?void 0:u.value;if(c!=="years"&&c!=="months"&&c!=="days")throw new Error("Invalid units");let l=Zo(a[0].value,o[0].value);return[{type:b.Quantity,value:{value:l[c],unit:c}}]},is:(e,t,n)=>{let i="";return n instanceof rn?i=n.name:n instanceof rr&&(i=n.left.name+"."+n.right.name),i?t.map(s=>({type:b.boolean,value:ds(s,i)})):[]},not:(e,t)=>ue.toBoolean(e,t).map(n=>({type:b.boolean,value:!n.value})),resolve:(e,t)=>t.map(n=>{let i=n.value,s;if(typeof i=="string")s=i;else if(typeof i=="object"){let a=i;if(a.resource)return nt(a.resource);a.reference?s=a.reference:a.type&&a.identifier&&(s=`${a.type}?identifier=${a.identifier.system}|${a.identifier.value}`)}if(s!=null&&s.includes("?")){let[a]=s.split("?");return{type:a,value:{resourceType:a}}}if(s!=null&&s.includes("/")){let[a,o]=s.split("/");return{type:a,value:{resourceType:a,id:o}}}return{type:b.BackboneElement,value:void 0}}).filter(n=>!!n.value),as:(e,t)=>t,type:(e,t)=>t.map(({value:n})=>typeof n=="boolean"?{type:b.BackboneElement,value:{namespace:"System",name:"Boolean"}}:typeof n=="number"?{type:b.BackboneElement,value:{namespace:"System",name:"Integer"}}:Tt(n)?{type:b.BackboneElement,value:{namespace:"FHIR",name:n.resourceType}}:{type:b.BackboneElement,value:null}),conformsTo:(e,t,n)=>{let i=n.eval(e,t)[0].value;if(!i.startsWith("http://hl7.org/fhir/StructureDefinition/"))throw new Error("Expected a StructureDefinition URL");let s=i.replace("http://hl7.org/fhir/StructureDefinition/","");return t.map(a=>{var o;return{type:b.boolean,value:((o=a.value)==null?void 0:o.resourceType)===s}})},getResourceKey:(e,t)=>{let n=t[0].value;return n!=null&&n.id?[{type:b.id,value:n.id}]:[]},getReferenceKey:(e,t,n)=>{let i=t[0].value;if(!(i!=null&&i.reference))return[];let s="";return n instanceof rn&&(s=n.name),s&&!i.reference.startsWith(s+"/")?[]:[{type:b.id,value:Zn(i)}]},extension:(e,t,n)=>{var a;let i=n.eval(e,t)[0].value,s=(a=t==null?void 0:t[0])==null?void 0:a.value;if(s){let o=qt(s,i);if(o)return[{type:b.Extension,value:o}]}return[]}};function ye(e,t,n,...i){if(n.length===0)return[];let[{value:s}]=_e(n,1);if(typeof s!="string")throw new Error("String function cannot be called with non-string");let a=e(s,...i.map(o=>{var c;return(c=o==null?void 0:o.eval(t,n)[0])==null?void 0:c.value}));return a===void 0?[]:Array.isArray(a)?a.map(nt):[nt(a)]}function Me(e,t,n,...i){if(n.length===0)return[];let[{value:s}]=_e(n,1),a=je(s),o=a?s.value:s;if(typeof o!="number")throw new Error("Math function cannot be called with non-number");let c=e(o,...i.map(d=>{var m;return(m=d.eval(t,n)[0])==null?void 0:m.value})),l=a?b.Quantity:n[0].type,u=a?{...s,value:c}:c;return[{type:l,value:u}]}function _e(e,t){if(e.length!==t)throw new Error(`Expected ${t} arguments`);for(let n of e)if(n==null)throw new Error("Expected non-null argument");return e}function ct(e){var n;let t=e;for(;(n=t.parent)!=null&&n.variables.$this;)t=t.parent;return[t.variables.$this]}var Ac=class{constructor(e,t){this.original=e,this.child=t}eval(e,t){try{if(t.length>0){let n=[];for(let i of t)n.push(this.child.eval({parent:e,variables:{$this:i}},[i]));return n.flat()}else return this.child.eval(e,[])}catch(n){throw new Error(`FhirPathError on "${this.original}": ${n}`,{cause:n})}}toString(){return this.child.toString()}},vt=class{constructor(e){this.value=e}eval(){return[this.value]}toString(){let e=this.value.value;return typeof e=="string"?`'${e}'`:e.toString()}},rn=class{constructor(e){this.name=e}eval(e,t){if(this.name==="$this")return t;let n=this.getVariable(e);if(n)return[n];if(this.name.startsWith("%"))throw new Error(`Undefined variable ${this.name}`);return t.flatMap(i=>this.evalValue(i)).filter(i=>(i==null?void 0:i.value)!==void 0)}getVariable(e){let t=e.variables[this.name];if(t!==void 0)return t;if(e.parent)return this.getVariable(e.parent)}evalValue(e){let t=e.value;if(!(!t||typeof t!="object"))return Tt(t)&&t.resourceType===this.name?e:ie(e,this.name)}toString(){return this.name}},Mc=class{eval(){return[]}toString(){return"{}"}},_c=class extends go{constructor(e,t,n){super(e,t),this.impl=n}eval(e,t){return this.impl(this.child.eval(e,t))}toString(){return this.operator+this.child.toString()}},nr=class extends $t{constructor(e,t){super("as",e,t)}eval(e,t){return ue.ofType(e,this.left.eval(e,t),this.right)}},me=class extends $t{},Ee=class extends me{constructor(e,t,n,i){super(e,t,n),this.impl=i}eval(e,t){let n=this.left.eval(e,t);if(n.length!==1)return[];let i=this.right.eval(e,t);if(i.length!==1)return[];let s=n[0].value,a=i[0].value,o=je(s)?s.value:s,c=je(a)?a.value:a,l=this.impl(o,c);return typeof l=="boolean"?R(l):je(s)?[{type:b.Quantity,value:{...s,value:l}}]:[nt(l)]}},Oc=class extends $t{constructor(e,t){super("&",e,t)}eval(e,t){let n=this.left.eval(e,t),i=this.right.eval(e,t),s=[...n,...i];return s.length>0&&s.every(a=>typeof a.value=="string")?[{type:b.string,value:s.map(a=>a.value).join("")}]:s}},Lc=class extends me{constructor(e,t){super("contains",e,t)}eval(e,t){let n=this.left.eval(e,t),i=this.right.eval(e,t);return R(n.some(s=>s.value===i[0].value))}},Nc=class extends me{constructor(e,t){super("in",e,t)}eval(e,t){let n=We(this.left.eval(e,t)),i=this.right.eval(e,t);return n?R(i.some(s=>s.value===n.value)):[]}},rr=class extends $t{constructor(e,t){super(".",e,t)}eval(e,t){return this.right.eval(e,this.left.eval(e,t))}toString(){return`${this.left.toString()}.${this.right.toString()}`}},xs=class extends $t{constructor(e,t){super("|",e,t)}eval(e,t){let n=this.left.eval(e,t),i=this.right.eval(e,t);return ls([...n,...i])}},Uc=class extends me{constructor(e,t){super("=",e,t)}eval(e,t){let n=this.left.eval(e,t),i=this.right.eval(e,t);return $o(n,i)}},Fc=class extends me{constructor(e,t){super("!=",e,t)}eval(e,t){let n=this.left.eval(e,t),i=this.right.eval(e,t);return qo(n,i)}},Bc=class extends me{constructor(e,t){super("~",e,t)}eval(e,t){let n=this.left.eval(e,t),i=this.right.eval(e,t);return us(n,i)}},$c=class extends me{constructor(e,t){super("!~",e,t)}eval(e,t){let n=this.left.eval(e,t),i=this.right.eval(e,t);return Bo(us(n,i))}},ir=class extends me{constructor(e,t){super("is",e,t)}eval(e,t){let n=this.left.eval(e,t);if(n.length!==1)return[];let i=this.right.name;return R(ds(n[0],i))}},qc=class extends me{constructor(e,t){super("and",e,t)}eval(e,t){let n=We(this.left.eval(e,t),"boolean"),i=We(this.right.eval(e,t),"boolean");return(n==null?void 0:n.value)===!0&&(i==null?void 0:i.value)===!0?R(!0):(n==null?void 0:n.value)===!1||(i==null?void 0:i.value)===!1?R(!1):[]}},Vc=class extends me{constructor(e,t){super("or",e,t)}eval(e,t){let n=We(this.left.eval(e,t),"boolean"),i=We(this.right.eval(e,t),"boolean");return(n==null?void 0:n.value)===!1&&(i==null?void 0:i.value)===!1?R(!1):n!=null&&n.value||i!=null&&i.value?R(!0):[]}},zc=class extends me{constructor(e,t){super("xor",e,t)}eval(e,t){let n=We(this.left.eval(e,t),"boolean"),i=We(this.right.eval(e,t),"boolean");return!n||!i?[]:R(n.value!==i.value)}},Hc=class extends me{constructor(e,t){super("implies",e,t)}eval(e,t){let n=We(this.left.eval(e,t),"boolean"),i=We(this.right.eval(e,t),"boolean");return(i==null?void 0:i.value)===!0||(n==null?void 0:n.value)===!1?R(!0):!n||!i?[]:R(!1)}},sr=class{constructor(e,t){this.name=e,this.args=t}eval(e,t){let n=ue[this.name];if(!n)throw new Error("Unrecognized function: "+this.name);return n(e,t,...this.args)}toString(){return`${this.name}(${this.args.map(e=>e.toString()).join(", ")})`}},ar=class{constructor(e,t){this.left=e,this.expr=t}eval(e,t){let n=this.expr.eval(e,t);if(n.length!==1)return[];let i=n[0].value;if(typeof i!="number")throw new Error("Invalid indexer expression: should return integer}");let s=this.left.eval(e,t);return i in s?[s[i]]:[]}toString(){return`${this.left.toString()}[${this.expr.toString()}]`}},Wc=["year","years","month","months","week","weeks","day","days","hour","hours","minute","minutes","second","seconds","millisecond","milliseconds"],Qc=class{constructor(t,n,i,s){this.result=[],this.pos={index:0,line:1,column:0},this.markStack=[],this.str=t,this.keywords=n,this.operators=i,this.dateTimeLiterals=!!(s!=null&&s.dateTimeLiterals),this.symbolRegex=(s==null?void 0:s.symbolRegex)??/[$\w%]/}tokenize(){for(;this.pos.index<this.str.length;){let t=this.consumeToken();t&&this.result.push(t)}return this.result}prevToken(){return this.result.slice(-1)[0]}peekToken(){this.mark();let t=this.consumeToken();return this.reset(),t}consumeToken(){this.consumeWhitespace();let t=this.curr();if(!t)return;this.mark();let n=this.peek();return t==="/"&&n==="*"?this.consumeMultiLineComment():t==="/"&&n==="/"?this.consumeSingleLineComment():t==="'"||t==='"'?this.consumeString(t):t==="`"?this.consumeBacktickSymbol():t==="@"?this.consumeDateTime():/\d/.exec(t)?this.consumeNumber():/\w/.exec(t)?this.consumeSymbol():(t==="$"||t==="%")&&/\w/.exec(n)?this.consumeSymbol():this.consumeOperator()}consumeWhitespace(){this.consumeWhile(()=>/\s/.exec(this.curr()))}consumeMultiLineComment(){let t=this.pos.index;return this.consumeWhile(()=>this.curr()!=="*"||this.peek()!=="/"),this.advance(),this.advance(),this.buildToken("Comment",this.str.substring(t,this.pos.index))}consumeSingleLineComment(){return this.buildToken("Comment",this.consumeWhile(()=>this.curr()!==`
`))}consumeString(t){this.advance();let n=this.buildToken("String",this.consumeWhile(()=>this.prev()==="\\"||this.curr()!==t));return this.advance(),n}consumeBacktickSymbol(){this.advance();let t=this.buildToken("Symbol",this.consumeWhile(()=>this.curr()!=="`"));return this.advance(),t}consumeDateTime(){this.advance();let t=this.pos.index;this.consumeWhile(()=>/[\d-]/.exec(this.curr()));let n=!1,i=!1;if(this.curr()==="T"&&(n=!0,this.advance(),this.consumeWhile(()=>/[\d:]/.exec(this.curr())),this.curr()==="."&&/\d/.exec(this.peek())&&(this.advance(),this.consumeWhile(()=>/\d/.exec(this.curr()))),this.curr()==="Z"?(i=!0,this.advance()):(this.curr()==="+"||this.curr()==="-")&&(i=!0,this.advance(),this.consumeWhile(()=>/[\d:]/.exec(this.curr())))),this.pos.index===t)throw new Error("Invalid DateTime literal");let s=this.str.substring(t,this.pos.index);return s.endsWith("T")?s=s.substring(0,s.length-1):!s.startsWith("T")&&n&&!i&&(s+="Z"),this.buildToken("DateTime",s)}consumeNumber(){let t=this.pos.index,n="Number";return this.consumeWhile(()=>/\d/.exec(this.curr())),this.curr()==="."&&/\d/.exec(this.peek())&&(this.advance(),this.consumeWhile(()=>/\d/.exec(this.curr()))),this.curr()==="-"&&this.dateTimeLiterals?(this.pos.index=t-1,this.consumeDateTime()):(this.curr()===" "&&Gc(this.peekToken())&&(n="Quantity",this.consumeToken()),this.buildToken(n,this.str.substring(t,this.pos.index)))}consumeSymbol(){var n;let t=this.consumeWhile(()=>this.symbolRegex.exec(this.curr()));return((n=this.prevToken())==null?void 0:n.value)!=="."&&this.keywords.includes(t)?this.buildToken(t,t):this.buildToken("Symbol",t)}consumeOperator(){let t=this.curr(),n=this.peek(),i=t+n;return this.operators.includes(i)?(this.advance(),this.advance(),this.buildToken(i,i)):(this.advance(),this.buildToken(t,t))}consumeWhile(t){let n=this.pos.index;for(;this.pos.index<this.str.length&&t();)this.advance();return this.str.substring(n,this.pos.index)}curr(){return this.str[this.pos.index]}prev(){return this.str[this.pos.index-1]??""}peek(){return this.str[this.pos.index+1]??""}mark(){this.markStack.push({...this.pos})}reset(){let t=this.markStack.pop();if(!t)throw new Error("No mark to reset to");this.pos.index=t.index,this.pos.line=t.line,this.pos.column=t.column}advance(){this.pos.index++,this.curr()===`
`?(this.pos.line++,this.pos.column=0):this.pos.column++}buildToken(t,n){let i=this.markStack.pop();if(!i)throw new Error("No mark for token");return{id:t,value:n,...i}}};function Gc(e){return!!(e&&(e.id==="String"||e.id==="Symbol"&&Wc.includes(e.value)))}var Jc=["true","false"],or=["!=","!~","<=",">=","{}","->"];function Yc(e){return new Qc(e,Jc,or).tokenize()}var z={FunctionCall:0,Dot:1,Indexer:2,UnaryAdd:3,UnarySubtract:3,Multiply:4,Divide:4,IntegerDivide:4,Modulo:4,Add:5,Subtract:5,Ampersand:5,Is:6,As:6,Union:7,GreaterThan:8,GreaterThanOrEquals:8,LessThan:8,LessThanOrEquals:8,Equals:9,Equivalent:9,NotEquals:9,NotEquivalent:9,In:10,Contains:10,And:11,Xor:12,Or:12,Implies:13,Arrow:100,Semicolon:200},Zc={parse(e){var n;let t=e.consumeAndParse();if(!e.match(")"))throw new Error("Parse error: expected `)` got `"+((n=e.peek())==null?void 0:n.value)+"`");return t}},Kc={parse(e,t){let n=e.consumeAndParse();if(!e.match("]"))throw new Error("Parse error: expected `]`");return new ar(t,n)},precedence:z.Indexer},Xc={parse(e,t){if(!(t instanceof rn))throw new Error("Unexpected parentheses");let n=[];for(;!e.match(")");)n.push(e.consumeAndParse()),e.match(",");return new sr(t.name,n)},precedence:z.FunctionCall};function el(e){let t=e.split(" "),n=parseFloat(t[0]),i=t[1];return i!=null&&i.startsWith("'")&&i.endsWith("'")?i=i.substring(1,i.length-1):i="{"+i+"}",{value:n,unit:i}}function cr(){return new yo().registerPrefix("String",{parse:(e,t)=>new vt({type:b.string,value:t.value})}).registerPrefix("DateTime",{parse:(e,t)=>new vt({type:b.dateTime,value:Xt(t.value)})}).registerPrefix("Quantity",{parse:(e,t)=>new vt({type:b.Quantity,value:el(t.value)})}).registerPrefix("Number",{parse:(e,t)=>new vt({type:t.value.includes(".")?b.decimal:b.integer,value:parseFloat(t.value)})}).registerPrefix("true",{parse:()=>new vt({type:b.boolean,value:!0})}).registerPrefix("false",{parse:()=>new vt({type:b.boolean,value:!1})}).registerPrefix("Symbol",{parse:(e,t)=>new rn(t.value)}).registerPrefix("{}",{parse:()=>new Mc}).registerPrefix("(",Zc).registerInfix("[",Kc).registerInfix("(",Xc).prefix("+",z.UnaryAdd,(e,t)=>new _c("+",t,n=>n)).prefix("-",z.UnarySubtract,(e,t)=>new Ee("-",t,t,(n,i)=>-i)).infixLeft(".",z.Dot,(e,t,n)=>new rr(e,n)).infixLeft("/",z.Divide,(e,t,n)=>new Ee("/",e,n,(i,s)=>i/s)).infixLeft("*",z.Multiply,(e,t,n)=>new Ee("*",e,n,(i,s)=>i*s)).infixLeft("+",z.Add,(e,t,n)=>new Ee("+",e,n,(i,s)=>i+s)).infixLeft("-",z.Subtract,(e,t,n)=>new Ee("-",e,n,(i,s)=>i-s)).infixLeft("|",z.Union,(e,t,n)=>new xs(e,n)).infixLeft("=",z.Equals,(e,t,n)=>new Uc(e,n)).infixLeft("!=",z.NotEquals,(e,t,n)=>new Fc(e,n)).infixLeft("~",z.Equivalent,(e,t,n)=>new Bc(e,n)).infixLeft("!~",z.NotEquivalent,(e,t,n)=>new $c(e,n)).infixLeft("<",z.LessThan,(e,t,n)=>new Ee("<",e,n,(i,s)=>i<s)).infixLeft("<=",z.LessThanOrEquals,(e,t,n)=>new Ee("<=",e,n,(i,s)=>i<=s)).infixLeft(">",z.GreaterThan,(e,t,n)=>new Ee(">",e,n,(i,s)=>i>s)).infixLeft(">=",z.GreaterThanOrEquals,(e,t,n)=>new Ee(">=",e,n,(i,s)=>i>=s)).infixLeft("&",z.Ampersand,(e,t,n)=>new Oc(e,n)).infixLeft("and",z.And,(e,t,n)=>new qc(e,n)).infixLeft("as",z.As,(e,t,n)=>new nr(e,n)).infixLeft("contains",z.Contains,(e,t,n)=>new Lc(e,n)).infixLeft("div",z.Divide,(e,t,n)=>new Ee("div",e,n,(i,s)=>i/s|0)).infixLeft("in",z.In,(e,t,n)=>new Nc(e,n)).infixLeft("is",z.Is,(e,t,n)=>new ir(e,n)).infixLeft("mod",z.Modulo,(e,t,n)=>new Ee("mod",e,n,(i,s)=>i%s)).infixLeft("or",z.Or,(e,t,n)=>new Vc(e,n)).infixLeft("xor",z.Xor,(e,t,n)=>new zc(e,n)).infixLeft("implies",z.Implies,(e,t,n)=>new Hc(e,n))}var tl=cr();function vs(e){return new Ac(e,tl.construct(Yc(e)).consumeAndParse())}function Pt(e,t){let n=Array.isArray(t)?t:[t];for(let i=0;i<n.length;i++){let s=n[i];typeof s=="object"&&"type"in s&&"value"in s||(n[i]=nt(n[i]))}return lr(e,n).map(i=>i.value)}function lr(e,t,n={}){return vs(e).eval({variables:n},t).map(i=>{var s;return{type:i.type,value:(s=i.value)==null?void 0:s.valueOf()}})}var et=(e=>(e.BOOLEAN="BOOLEAN",e.NUMBER="NUMBER",e.QUANTITY="QUANTITY",e.TEXT="TEXT",e.REFERENCE="REFERENCE",e.CANONICAL="CANONICAL",e.DATE="DATE",e.DATETIME="DATETIME",e.PERIOD="PERIOD",e.UUID="UUID",e))(et||{});function Ht(e,t){var i,s;let n=(s=(i=Ue.types[e])==null?void 0:i.searchParamsDetails)==null?void 0:s[t.code];return n||(n=rl(e,t)),n}function nl(e,t,n){let i=Ue.types[e];i||(i={},Ue.types[e]=i),i.searchParamsDetails||(i.searchParamsDetails={}),i.searchParamsDetails[t]=n}function rl(e,t){let n=t.code,i=al(n),s=cl(e,t.expression),a={elementDefinitions:[],propertyTypes:new Set,array:!1};for(let c of s){let l=Nt(c),u=uc(()=>l.join("."));l.length===1&&l[0]instanceof me?a.propertyTypes.add("boolean"):u().endsWith("extension.value.code")||u().endsWith("extension.value.coding.code")?(a.array=!0,a.propertyTypes.add("code")):js(a,Nt(c),e,1),u().endsWith("extension.valueDateTime")&&(a.array=!1)}let o={columnName:i,type:ol(t,a.propertyTypes),elementDefinitions:a.elementDefinitions,array:a.array};return nl(e,n,o),o}function js(e,t,n,i){let s=t[i];if(s instanceof nr){e.propertyTypes.add(s.right.toString());return}if(s instanceof sr){il(e,s);return}let a=s.toString(),o=fn(n,a);if(!o)throw new Error(`Element definition not found for ${n} ${a}`);let c=!1,l=i+1;if(l<t.length&&t[l]instanceof ar&&(c=!0,l++),o.isArray&&!c&&(e.array=!0),l>=t.length){e.elementDefinitions.push(o);for(let u of o.type)e.propertyTypes.add(u.code);return}for(let u of o.type){let d=u.code;sl(d)&&(d=o.type[0].code),js(e,t,d,l)}}function il(e,t){if(t.name==="as"){e.propertyTypes.add(t.args[0].toString());return}if(t.name==="resolve"){e.propertyTypes.add("string");return}if(t.name==="where"&&t.args[0]instanceof ir){e.propertyTypes.add(t.args[0].right.toString());return}throw new Error(`Unhandled FHIRPath function: ${t.name}`)}function sl(e){return e==="Element"||e==="BackboneElement"}function al(e){return e.split("-").reduce((t,n,i)=>t+(i?De(n):n),"")}function ol(e,t){switch(e.type){case"date":return t.size===1&&t.has(b.date)?"DATE":"DATETIME";case"number":return"NUMBER";case"quantity":return"QUANTITY";case"reference":return t.has(b.canonical)?"CANONICAL":"REFERENCE";case"token":return t.size===1&&t.has(b.boolean)?"BOOLEAN":"TEXT";default:return"TEXT"}}function cl(e,t){let n=[],i=vs(t);return Ln(e,i.child,n),n}function Ln(e,t,n){t instanceof xs?(Ln(e,t.left,n),Ln(e,t.right,n)):t.toString().startsWith(e+".")&&n.push(t)}function Nt(e){if(e instanceof nr||e instanceof ar)return[Nt(e.left),e].flat();if(e instanceof me)return[e];if(e instanceof rr)return[Nt(e.left),Nt(e.right)].flat();if(e instanceof sr){if(e.name==="where"&&!(e.args[0]instanceof ir))return[];if(e.name==="last")return[]}return[e]}var ur=20,S=(e=>(e.EQUALS="eq",e.NOT_EQUALS="ne",e.GREATER_THAN="gt",e.LESS_THAN="lt",e.GREATER_THAN_OR_EQUALS="ge",e.LESS_THAN_OR_EQUALS="le",e.STARTS_AFTER="sa",e.ENDS_BEFORE="eb",e.APPROXIMATELY="ap",e.CONTAINS="contains",e.EXACT="exact",e.TEXT="text",e.NOT="not",e.ABOVE="above",e.BELOW="below",e.IN="in",e.NOT_IN="not-in",e.OF_TYPE="of-type",e.MISSING="missing",e.PRESENT="present",e.IDENTIFIER="identifier",e.ITERATE="iterate",e))(S||{}),bs={contains:"contains",exact:"exact",above:"above",below:"below",text:"text",not:"not",in:"in","not-in":"not-in","of-type":"of-type",missing:"missing",identifier:"identifier",iterate:"iterate"},dr={eq:"eq",ne:"ne",lt:"lt",le:"le",gt:"gt",ge:"ge",sa:"sa",eb:"eb",ap:"ap"};function ll(e,t){if(!e)throw new Error("Invalid search URL");let n="",i;if(typeof e=="string")if(e.includes("?")){let[o,c]=e.split("?");n=o,i=new URLSearchParams(c)}else n=e;else typeof e=="object"&&(n=e.pathname,i=e.searchParams);let s;n.includes("/")?s=n.split("/").filter(Boolean).pop():s=n;let a=[];return i&&a.push(...i.entries()),ul(s,a)}function ul(e,t){let n={resourceType:e};for(let[i,s]of t)dl(n,i,s);return n}function dl(e,t,n){var o,c;let i,s,a=t.indexOf(":");if(a>=0?(i=t.substring(0,a),s=t.substring(a+1)):(i=t,s=""),i!=="_"){if(i==="_has"||t.includes(".")){e.filters=Mt(e.filters,{code:t,operator:"eq",value:n});return}switch(i){case"_sort":hl(e,n);break;case"_count":e.count=parseInt(n,10);break;case"_offset":e.offset=parseInt(n,10);break;case"_total":e.total=n;break;case"_summary":n==="count"?(e.total="accurate",e.count=0):(n==="true"||n==="data"||n==="text")&&(e.summary=n);break;case"_include":{let l=ri(n);s==="iterate"&&(l.modifier="iterate"),e.include=Mt(e.include,l);break}case"_revinclude":{let l=ri(n);s==="iterate"&&(l.modifier="iterate"),e.revInclude=Mt(e.revInclude,l);break}case"_fields":case"_elements":e.fields=n.split(",");break;case"_type":e.types=n.split(",");break;case"_format":e.format=n;break;case"_pretty":e.pretty=n==="true";break;default:{let l=(c=(o=Ue.types[e.resourceType])==null?void 0:o.searchParams)==null?void 0:c[i];l?e.filters=Mt(e.filters,ml(l,s,n)):e.filters=Mt(e.filters,gl(i,s,n))}}}}function hl(e,t){for(let n of t.split(",")){let i,s=!1;n.startsWith("-")?(i=n.substring(1),s=!0):i=n,e.sortRules||(e.sortRules=[]),e.sortRules.push({code:i,descending:s})}}function ml(e,t,n){if(t==="missing")return{code:e.code,operator:"missing",value:n};switch(e.type){case"number":case"date":case"quantity":return fl(e,n);case"reference":case"string":case"token":case"uri":return pl(e,t,n);default:throw new Error("Unrecognized search parameter type: "+e.type)}}function fl(e,t){let{operator:n,value:i}=yl(t);return{code:e.code,operator:n,value:i}}function pl(e,t,n){return{code:e.code,operator:xl(t),value:n}}function gl(e,t,n){var s;let i="eq";if(t)i=t;else if(n.length>=2){let a=n.substring(0,2);a in dr&&(n.length===2||(s=n.at(2))!=null&&s.match(/\d/))&&(i=a,n=n.substring(a.length))}return{code:e,operator:i,value:n}}function yl(e){let t=e.substring(0,2),n=dr[t];return n?{operator:n,value:e.substring(2)}:{operator:"eq",value:e}}function xl(e){return bs[e]??"eq"}function ri(e){let t=e.split(":");if(t.includes("*"))throw new U(mt("'*' is not supported as a value for search inclusion parameters"));if(t.length===1)throw new U(mt(`Invalid include value '${e}': must be of the form ResourceType:search-parameter`));if(t.length===2)return{resourceType:t[0],searchParam:t[1]};if(t.length===3)return{resourceType:t[0],searchParam:t[1],targetType:t[2]};throw new U(mt(`Invalid include value '${e}'`))}function vl(e){let t=[];return e.filters&&e.filters.forEach(n=>t.push(jl(n))),e.sortRules&&e.sortRules.length>0&&t.push(bl(e.sortRules)),e.offset!==void 0&&t.push("_offset="+e.offset),e.count!==void 0&&t.push("_count="+e.count),e.total!==void 0&&t.push("_total="+e.total),e.include&&e.include.forEach(n=>t.push(ii("_include",n))),e.revInclude&&e.revInclude.forEach(n=>t.push(ii("_revinclude",n))),t.length===0?"":(Xn(t),"?"+t.join("&"))}function jl(e){let t=e.operator in bs?":"+e.operator:"",n=e.operator!=="eq"&&e.operator in dr?e.operator:"";return`${e.code}${t}=${n}${encodeURIComponent(e.value)}`}function bl(e){return"_sort="+e.map(t=>t.descending?"-"+t.code:t.code).join(",")}function ii(e,t){return e+(t.modifier?":"+t.modifier:"")+"="+t.resourceType+":"+t.searchParam+(t.targetType?":"+t.targetType:"")}function hr(e){let t=[],n="",i=!1;for(let s of e)i?(n+=s,i=!1):s==="\\"?i=!0:s===","?(t.push(n),n=""):n+=s;return t.push(n),t}function Cl(e,t){if(t.resourceType!==e.resourceType)return!1;if(t.filters){for(let n of t.filters)if(!wl(e,t,n))return!1}return!0}function wl(e,t,n){var s,a;let i=(a=(s=Ue.types[t.resourceType])==null?void 0:s.searchParams)==null?void 0:a[n.code];if(!i)return!1;if(n.operator==="missing"||n.operator==="present")return Sl(e,n,i);switch(i.type){case"reference":return kl(e,n,i);case"string":case"uri":return Cs(e,n,i);case"token":return El(e,n,i);case"date":return Rl(e,n,i);default:return!1}}function Sl(e,t,n){let i=Pt(n.expression,e).length>0;return(t.operator==="missing"&&t.value==="false"||t.operator==="present"&&t.value==="true")===i}function kl(e,t,n){let i=Pt(n.expression,e),s=pn(t.operator);if(t.value===""&&i.length===0)return t.operator==="eq";let a=i.map(o=>typeof o=="string"?o:o.reference);for(let o of hr(t.value)){let c=a.includes(o);if(!c&&t.code==="_compartment"&&(c=a.some(l=>l==null?void 0:l.endsWith("/"+o))),c)return!s}return s}function El(e,t,n){return Ht(e.resourceType,n).type==="BOOLEAN"?Tl(e,t,n):Cs(e,t,n,!0)}function Tl(e,t,n){let i=Pt(n.expression,e),s=t.value==="true",a=i.includes(s);return pn(t.operator)?!a:a}function Cs(e,t,n,i){var l,u,d,m;let s=(m=(d=(u=(l=Ht(e.resourceType,n).elementDefinitions)==null?void 0:l[0])==null?void 0:u.type)==null?void 0:d[0])==null?void 0:m.code,a=Pt(n.expression,e),o=hr(t.value),c=pn(t.operator);for(let f of a)for(let p of o){let g;if(s===b.Identifier?g=Pl(f,t.operator,p):s===b.CodeableConcept?g=Il(f,t.operator,p):g=Nn(f,t.operator,p,i),g)return!c}return c}function Nn(e,t,n,i){if(i&&n.includes("|")){let[a,o]=n.split("|");return Nn(e,t,a,!1)&&(!o||Nn(e,t,o,!1))}let s="";return e&&(typeof e=="string"?s=e:typeof e=="object"&&(s=JSON.stringify(e))),s.toLowerCase().includes(n.toLowerCase())}function Pl(e,t,n){var i,s,a;if(n.includes("|")){let[o,c]=n.split("|");return((i=e.system)==null?void 0:i.toLowerCase())===o.toLowerCase()&&((s=e.value)==null?void 0:s.toLowerCase())===c.toLowerCase()}return((a=e.value)==null?void 0:a.toLowerCase())===n.toLowerCase()}function Il(e,t,n){var i,s,a;if(n.includes("|")){let[o,c]=n.split("|");return((i=e.coding)==null?void 0:i.some(l=>{var u,d;return((u=l.system)==null?void 0:u.toLowerCase())===o.toLowerCase()&&((d=l.code)==null?void 0:d.toLowerCase())===c.toLowerCase()}))??!1}return((s=e.text)==null?void 0:s.toLowerCase())===n.toLowerCase()||(((a=e.coding)==null?void 0:a.some(o=>{var c;return((c=o.code)==null?void 0:c.toLowerCase())===n.toLowerCase()}))??!1)}function Rl(e,t,n){let i=Pt(n.expression,e),s=hr(t.value),a=pn(t.operator);for(let o of i)for(let c of s)if(Dl(o,t.operator,c))return!a;return a}function Dl(e,t,n){switch(t){case"sa":case"gt":return e>n;case"ge":return e>=n;case"eb":case"lt":return e<n;case"le":return e<=n;case"eq":case"ne":return e===n;default:return!1}}function pn(e){return e==="ne"||e==="not"}var Al={resourceType:"*"},Ml=["PasswordChangeRequest","UserSecurityRequest","Project","ProjectMembership","User"],ws=(e=>(e.READ="read",e.VREAD="vread",e.UPDATE="update",e.PATCH="patch",e.DELETE="delete",e.HISTORY="history",e.HISTORY_INSTANCE="history-instance",e.HISTORY_TYPE="history-type",e.HISTORY_SYSTEM="history-system",e.CREATE="create",e.SEARCH="search",e.SEARCH_TYPE="search-type",e.SEARCH_SYSTEM="search-system",e.SEARCH_COMPARTMENT="search-compartment",e.CAPABILITIES="capabilities",e.TRANSACTION="transaction",e.BATCH="batch",e.OPERATION="operation",e))(ws||{}),_l=["read","vread","history","history-instance"];function Ol(e,t,n){if(!n)return Al;if(n.resource){for(let i of n.resource)if(Ll(e,t,i))return i}}function Ll(e,t,n){var s,a;let i=e.resourceType;return!(!Nl(n.resourceType,i)||n.readonly&&!_l.includes(t)||n.compartment&&!((a=(s=e.meta)==null?void 0:s.compartment)!=null&&a.find(o=>{var c;return o.reference===((c=n.compartment)==null?void 0:c.reference)}))||n.criteria&&!Cl(e,ll(n.criteria)))}function Nl(e,t){return e===t||e==="*"&&!Ml.includes(t)}function Ul(e){if(typeof window<"u")return window.atob(e);if(typeof Buffer<"u")return Buffer.from(e,"base64").toString("binary");throw new Error("Unable to decode base64")}function Fl(e){if(typeof window<"u")return window.btoa(e);if(typeof Buffer<"u")return Buffer.from(e,"binary").toString("base64");throw new Error("Unable to encode base64")}function si(){let e=new Uint32Array(28);return crypto.getRandomValues(e),oc(e.buffer)}async function Bl(e){return crypto.subtle.digest("SHA-256",new TextEncoder().encode(e))}function $l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}var Ss=class{constructor(e=10){this.max=e,this.cache=new Map}clear(){this.cache.clear()}get(e){let t=this.cache.get(e);return t&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size>=this.max&&this.cache.delete(this.first()),this.cache.set(e,t)}delete(e){this.cache.delete(e)}keys(){return this.cache.keys()}first(){return this.cache.keys().next().value}},ve={CSS:"text/css",DICOM:"application/dicom",FAVICON:"image/vnd.microsoft.icon",FHIR_JSON:"application/fhir+json",FORM_URL_ENCODED:"application/x-www-form-urlencoded",HL7_V2:"x-application/hl7-v2+er7",HTML:"text/html",JAVASCRIPT:"text/javascript",JSON:"application/json",JSON_PATCH:"application/json-patch+json",PNG:"image/png",SCIM_JSON:"application/scim+json",SVG:"image/svg+xml",TEXT:"text/plain",TYPESCRIPT:"text/typescript",PING:"x-application/ping"},ql=class{constructor(){this.listeners={}}addEventListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}removeEventListener(e,t){let n=this.listeners[e];if(n){for(let i=0;i<n.length;i++)if(n[i]===t){n.splice(i,1);return}}}dispatchEvent(e){let t=this.listeners[e.type];if(t)for(let n of t)n.call(this,e);return!e.defaultPrevented}removeAllListeners(){this.listeners={}}},gn=class{constructor(){this.emitter=new ql}dispatchEvent(e){this.emitter.dispatchEvent(e)}addEventListener(e,t){this.emitter.addEventListener(e,t)}removeEventListener(e,t){this.emitter.removeEventListener(e,t)}removeAllListeners(){this.emitter.removeAllListeners()}},Un={"Patient-open":"Patient-open","Patient-close":"Patient-close","ImagingStudy-open":"ImagingStudy-open","ImagingStudy-close":"ImagingStudy-close","Encounter-open":"Encounter-open","Encounter-close":"Encounter-close","DiagnosticReport-open":"DiagnosticReport-open","DiagnosticReport-close":"DiagnosticReport-close","DiagnosticReport-select":"DiagnosticReport-select","DiagnosticReport-update":"DiagnosticReport-update",syncerror:"syncerror"},Vl=["Patient","Encounter","ImagingStudy","DiagnosticReport","OperationOutcome","Bundle"],mr=["DiagnosticReport-update"];function zl(e){return mr.includes(e)}function Hl(e){if(mr.includes(e))throw new U(G(`'context.version' is required for '${e}'.`))}var Wl={"Patient-open":{patient:{resourceType:"Patient"},encounter:{resourceType:"Encounter",optional:!0}},"Patient-close":{patient:{resourceType:"Patient"},encounter:{resourceType:"Encounter",optional:!0}},"ImagingStudy-open":{study:{resourceType:"ImagingStudy"},encounter:{resourceType:"Encounter",optional:!0},patient:{resourceType:"Patient",optional:!0}},"ImagingStudy-close":{study:{resourceType:"ImagingStudy"},encounter:{resourceType:"Encounter",optional:!0},patient:{resourceType:"Patient",optional:!0}},"Encounter-open":{encounter:{resourceType:"Encounter"},patient:{resourceType:"Patient"}},"Encounter-close":{encounter:{resourceType:"Encounter"},patient:{resourceType:"Patient"}},"DiagnosticReport-open":{report:{resourceType:"DiagnosticReport"},encounter:{resourceType:"Encounter",optional:!0},study:{resourceType:"ImagingStudy",optional:!0,manyAllowed:!0},patient:{resourceType:"Patient"}},"DiagnosticReport-close":{report:{resourceType:"DiagnosticReport"},encounter:{resourceType:"Encounter",optional:!0},study:{resourceType:"ImagingStudy",optional:!0,manyAllowed:!0},patient:{resourceType:"Patient"}},"DiagnosticReport-select":{report:{resourceType:"DiagnosticReport"},select:{resourceType:"*",isArray:!0}},"DiagnosticReport-update":{report:{resourceType:"DiagnosticReport"},patient:{resourceType:"Patient",optional:!0},study:{resourceType:"ImagingStudy",optional:!0},updates:{resourceType:"Bundle"}},syncerror:{operationoutcome:{resourceType:"OperationOutcome"}}};function Ql(e){return Vl.includes(e)}function ks(e){return!!e.endpoint}function ai(e){if(!fr(e))throw new U(G("subscriptionRequest must be an object conforming to SubscriptionRequest type."));let{channelType:t,mode:n,topic:i,events:s}=e,a={"hub.channel.type":t,"hub.mode":n,"hub.topic":i,"hub.events":s.join(",")};return ks(e)&&(a.endpoint=e.endpoint),new URLSearchParams(a).toString()}function fr(e){if(typeof e!="object")return!1;let{channelType:t,mode:n,topic:i,events:s}=e;if(!(t&&n&&i&&s)||typeof i!="string"||typeof s!="object"||!Array.isArray(s)||s.length<1||t!=="websocket"||n!=="subscribe"&&n!=="unsubscribe")return!1;for(let a of s)if(!Un[a])return!1;return!(ks(e)&&!(typeof e.endpoint=="string"&&e.endpoint.startsWith("ws")))}function oi(e,t,n,i){if(typeof t!="object")throw new U(G(`context[${n}] is invalid. Context must contain a single valid FHIR resource! Resource is not an object.`));if(!(t.id&&typeof t.id=="string"))throw new U(G(`context[${n}] is invalid. Resource must contain a valid string ID.`));if(!t.resourceType)throw new U(G(`context[${n}] is invalid. Resource must contain a resource type. No resource type found.`));let s=i.resourceType;if(s!=="*"){if(!Ql(t.resourceType))throw new U(G(`context[${n}] is invalid. Resource must contain a valid FHIRcast resource type. Resource type is not a known resource type.`));if(s&&t.resourceType!==s)throw new U(G(`context[${n}] is invalid. context[${n}] for the '${e}' event should contain resource of type ${s}.`))}}function Gl(e,t,n,i,s){if(s.set(t.key,(s.get(t.key)??0)+1),!i.isArray)oi(e,t.resource,n,i);else{let{resources:a}=t;if(!a)throw new U(G(`context[${n}] is invalid. context[${n}] for the '${e}' with key '${String(t.key)}' should contain an array of resources on the key 'resources'.`));for(let o of a)oi(e,o,n,i)}}function Jl(e,t){let n=new Map,i=Wl[e];for(let s=0;s<t.length;s++){let a=t[s].key;if(!i[a])throw new U(G(`Key '${a}' not found for event '${e}'. Make sure to add only valid keys.`));Gl(e,t[s],s,i[a],n)}for(let[s,a]of Object.entries(i)){if(!(a.optional||n.has(s)))throw new U(G(`Missing required key '${s}' on context for '${e}' event.`));if(!a.manyAllowed&&(n.get(s)||0)>1)throw new U(G(`${n.get(s)} context entries with key '${s}' found for the '${e}' event when schema only allows for 1.`))}}function ci(e,t,n,i){if(!(e&&typeof e=="string"))throw new U(G("Must provide a topic."));if(!Un[t])throw new U(G(`Must provide a valid FHIRcast event name. Supported events: ${Object.keys(Un).join(", ")}`));if(typeof n!="object")throw new U(G("context must be a context object or array of context objects."));if(mr.includes(t)&&!i)throw new U(G(`The '${t}' event must contain a 'context.versionId'.`));let s=Array.isArray(n)?n:[n];return Jl(t,s),{timestamp:new Date().toISOString(),id:$l(),event:{"hub.topic":e,"hub.event":t,context:s,...i?{"context.versionId":i}:{}}}}var Yl=class extends gn{constructor(e){if(super(),this.subRequest=e,!e.endpoint)throw new U(G("Subscription request should contain an endpoint."));if(!fr(e))throw new U(G("Subscription request failed validation."));let t=new WebSocket(e.endpoint);t.addEventListener("open",()=>{this.dispatchEvent({type:"connect"}),t.addEventListener("message",n=>{let i=JSON.parse(n.data);if(i["hub.topic"])return;let s=i;s.event["hub.event"]!=="heartbeat"&&(this.dispatchEvent({type:"message",payload:s}),t.send(JSON.stringify({id:i==null?void 0:i.id,timestamp:new Date().toISOString()})))}),t.addEventListener("close",()=>{this.dispatchEvent({type:"disconnect"})})}),this.websocket=t}disconnect(){this.websocket.close()}};function Zl(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),n=Ul(t),i=Array.from(n).reduce((a,o)=>{let c=("00"+o.charCodeAt(0).toString(16)).slice(-2);return`${a}%${c}`},""),s=decodeURIComponent(i);return JSON.parse(s)}function Kl(e){return e.split(".").length===3}function pr(e){let[t,n,i]=e.split(".");return Zl(n)}function Xl(e){try{return typeof pr(e).login_id=="string"}catch{return!1}}function eu(e){try{let t=pr(e).exp;return typeof t=="number"?t*1e3:void 0}catch{return}}var tu=class{constructor(e){this.medplum=e}async get(e){return this.medplum.get(`keyvalue/v1/${e}`)}async set(e,t){await this.medplum.put(`keyvalue/v1/${e}`,t,ve.TEXT)}async delete(e){await this.medplum.delete(`keyvalue/v1/${e}`)}},Es;Es=Symbol.toStringTag;var Te=class{constructor(e){this[Es]="ReadablePromise",this.status="pending",this.suspender=e.then(t=>(this.status="success",this.response=t,t),t=>{throw this.status="error",this.error=t,t})}isPending(){return this.status==="pending"}isOk(){return this.status==="success"}read(){switch(this.status){case"pending":throw this.suspender;case"error":throw this.error;default:return this.response}}then(e,t){return this.suspender.then(e,t)}catch(e){return this.suspender.catch(e)}finally(e){return this.suspender.finally(e)}},nu=class{constructor(e){this.storage=e??(typeof localStorage<"u"?localStorage:new ru)}clear(){this.storage.clear()}getString(e){return this.storage.getItem(e)??void 0}setString(e,t){t?this.storage.setItem(e,t):this.storage.removeItem(e)}getObject(e){let t=this.getString(e);return t?JSON.parse(t):void 0}setObject(e,t){this.setString(e,t?rt(t):void 0)}},ru=class{constructor(){this.data=new Map}get length(){return this.data.size}clear(){this.data.clear()}getItem(e){return this.data.get(e)??null}setItem(e,t){t?this.data.set(e,t):this.data.delete(e)}removeItem(e){this.data.delete(e)}key(e){return Array.from(this.data.keys())[e]}},iu=class extends gn{constructor(e){super(),this.bufferedAmount=-1/0,this.extensions="NOT_IMPLEMENTED",this.messageBuffer=[];let t=new WebSocket(e);t.addEventListener("open",()=>{if(this.messageBuffer.length){let n=this.messageBuffer;for(let i of n)t.send(i)}this.dispatchEvent(new Event("open"))}),t.addEventListener("error",n=>{this.dispatchEvent(n)}),t.addEventListener("message",n=>{this.dispatchEvent(n)}),t.addEventListener("close",n=>{this.dispatchEvent(n)}),this.ws=t}get readyState(){return this.ws.readyState}close(){this.ws.close()}send(e){if(this.ws.readyState!==WebSocket.OPEN){this.messageBuffer.push(e);return}try{this.ws.send(e)}catch(t){this.dispatchEvent(new ErrorEvent("error",{error:t,message:t.message})),this.messageBuffer.push(e)}}},Fn=class extends gn{constructor(...e){super(),this.criteria=new Set(e)}getCriteria(){return this.criteria}_addCriteria(e){this.criteria.add(e)}_removeCriteria(e){this.criteria.delete(e)}},su=class{constructor(e,t){this.criteria=e,this.emitter=new Fn(e),this.refCount=1,this.subscriptionProps=t?{...t}:void 0}},au=class{constructor(e,t,n){if(!(e instanceof Ts))throw new U(G("First arg of constructor should be a `MedplumClient`"));let i;try{i=new URL(t).toString()}catch{throw new U(G("Not a valid URL"))}let s=n!=null&&n.RobustWebSocket?new n.RobustWebSocket(i):new iu(i);this.medplum=e,this.ws=s,this.masterSubEmitter=new Fn,this.criteriaEntries=new Map,this.criteriaEntriesBySubscriptionId=new Map,this.wsClosed=!1,this.setupWebSocketListeners()}setupWebSocketListeners(){let e=this.ws;e.addEventListener("message",t=>{var n,i,s,a,o;try{let c=JSON.parse(t.data),l=(i=(n=c==null?void 0:c.entry)==null?void 0:n[0])==null?void 0:i.resource;if(l.type==="heartbeat"){(s=this.masterSubEmitter)==null||s.dispatchEvent({type:"heartbeat",payload:c});return}(a=this.masterSubEmitter)==null||a.dispatchEvent({type:"message",payload:c});let u=this.criteriaEntriesBySubscriptionId.get(Zn(l.subscription));if(!u){console.warn("Received notification for criteria the SubscriptionManager is not listening for");return}u.emitter.dispatchEvent({type:"message",payload:c})}catch(c){console.error(c);let l={type:"error",payload:c};(o=this.masterSubEmitter)==null||o.dispatchEvent(l);for(let u of this.getAllCriteriaEmitters())u.dispatchEvent(l)}}),e.addEventListener("error",()=>{var n;let t={type:"error",payload:new U(ko(new Error("WebSocket error")))};(n=this.masterSubEmitter)==null||n.dispatchEvent(t);for(let i of this.getAllCriteriaEmitters())i.dispatchEvent(t)}),e.addEventListener("close",()=>{var n;let t={type:"close"};this.wsClosed&&((n=this.masterSubEmitter)==null||n.dispatchEvent(t));for(let i of this.getAllCriteriaEmitters())i.dispatchEvent(t)})}emitConnect(e){var n;let t={type:"connect",payload:{subscriptionId:e.subscriptionId}};(n=this.masterSubEmitter)==null||n.dispatchEvent(t);for(let i of this.getAllCriteriaEmitters())i.dispatchEvent(t)}emitError(e,t){var i;let n={type:"error",payload:t};(i=this.masterSubEmitter)==null||i.dispatchEvent(n),e.emitter.dispatchEvent(n)}maybeEmitDisconnect(e){var n;let{subscriptionId:t}=e;if(t){let i={type:"disconnect",payload:{subscriptionId:t}};(n=this.masterSubEmitter)==null||n.dispatchEvent(i),e.emitter.dispatchEvent(i)}else console.warn("Called disconnect for `CriteriaEntry` before `subscriptionId` was present.")}async getTokenForCriteria(e){var a,o;let t=e==null?void 0:e.subscriptionId;t||(t=(await this.medplum.createResource({...e.subscriptionProps,resourceType:"Subscription",status:"active",reason:`WebSocket subscription for ${Z(this.medplum.getProfile())}`,channel:{type:"websocket"},criteria:e.criteria})).id);let{parameter:n}=await this.medplum.get(`fhir/R4/Subscription/${t}/$get-ws-binding-token`),i=(a=n==null?void 0:n.find(c=>c.name==="token"))==null?void 0:a.valueString,s=(o=n==null?void 0:n.find(c=>c.name==="websocket-url"))==null?void 0:o.valueUrl;if(!i)throw new U(G("Failed to get token"));if(!s)throw new U(G("Failed to get URL from $get-ws-binding-token"));return[t,i]}maybeGetCriteriaEntry(e,t){let n=this.criteriaEntries.get(e);if(n){if(!t)return n.bareCriteria;for(let i of n.criteriaWithProps)if(Qe(t,i.subscriptionProps))return i}}getAllCriteriaEmitters(){let e=[];for(let t of this.criteriaEntries.values()){t.bareCriteria&&e.push(t.bareCriteria.emitter);for(let n of t.criteriaWithProps)e.push(n.emitter)}return e}addCriteriaEntry(e){let{criteria:t,subscriptionProps:n}=e,i;this.criteriaEntries.has(t)?i=this.criteriaEntries.get(t):(i={criteriaWithProps:[]},this.criteriaEntries.set(t,i)),n?i.criteriaWithProps.push(e):i.bareCriteria=e}removeCriteriaEntry(e){var o;let{criteria:t,subscriptionProps:n,subscriptionId:i,token:s}=e;if(!this.criteriaEntries.has(t))return;let a=this.criteriaEntries.get(t);n?a.criteriaWithProps=a.criteriaWithProps.filter(c=>{let l=c.subscriptionProps;return!Qe(n,l)}):a.bareCriteria=void 0,!a.bareCriteria&&a.criteriaWithProps.length===0&&(this.criteriaEntries.delete(t),(o=this.masterSubEmitter)==null||o._removeCriteria(t)),i&&this.criteriaEntriesBySubscriptionId.delete(i),s&&this.ws.send(JSON.stringify({type:"unbind-from-token",payload:{token:s}}))}addCriteria(e,t){this.masterSubEmitter&&this.masterSubEmitter._addCriteria(e);let n=this.maybeGetCriteriaEntry(e,t);if(n)return n.refCount+=1,n.emitter;let i=new su(e,t);return this.addCriteriaEntry(i),this.getTokenForCriteria(i).then(([s,a])=>{i.subscriptionId=s,i.token=a,this.criteriaEntriesBySubscriptionId.set(s,i),this.emitConnect(i),this.ws.send(JSON.stringify({type:"bind-with-token",payload:{token:a}}))}).catch(s=>{console.error(s.message),this.emitError(i,s),this.removeCriteriaEntry(i)}),i.emitter}removeCriteria(e,t){let n=this.maybeGetCriteriaEntry(e,t);if(!n){console.warn("Criteria not known to `SubscriptionManager`. Possibly called remove too many times.");return}n.refCount-=1,!(n.refCount>0)&&(this.maybeEmitDisconnect(n),this.removeCriteriaEntry(n))}closeWebSocket(){this.wsClosed||(this.wsClosed=!0,this.ws.close())}getCriteriaCount(){return this.getAllCriteriaEmitters().length}getMasterEmitter(){return this.masterSubEmitter||(this.masterSubEmitter=new Fn(...Array.from(this.criteriaEntries.keys()))),this.masterSubEmitter}},ou=ve.FHIR_JSON+", */*; q=0.1",cu="https://api.medplum.com/",lu=1e3,uu=6e4,du=0,hu="Binary/",li={resourceType:"Device",id:"system",deviceName:[{type:"model-name",name:"System"}]},mu=(e=>(e.ClientCredentials="client_credentials",e.AuthorizationCode="authorization_code",e.RefreshToken="refresh_token",e.JwtBearer="urn:ietf:params:oauth:grant-type:jwt-bearer",e.TokenExchange="urn:ietf:params:oauth:grant-type:token-exchange",e))(mu||{}),fu=(e=>(e.AccessToken="urn:ietf:params:oauth:token-type:access_token",e.RefreshToken="urn:ietf:params:oauth:token-type:refresh_token",e.IdToken="urn:ietf:params:oauth:token-type:id_token",e.Saml1Token="urn:ietf:params:oauth:token-type:saml1",e.Saml2Token="urn:ietf:params:oauth:token-type:saml2",e))(fu||{}),pu=(e=>(e.ClientSecretBasic="client_secret_basic",e.ClientSecretPost="client_secret_post",e.ClientSecretJwt="client_secret_jwt",e.PrivateKeyJwt="private_key_jwt",e.None="none",e))(pu||{}),gu=(e=>(e.JwtBearer="urn:ietf:params:oauth:client-assertion-type:jwt-bearer",e))(gu||{}),Ts=class extends gn{constructor(e){if(super(),this.initComplete=!0,e!=null&&e.baseUrl&&!e.baseUrl.startsWith("http"))throw new Error("Base URL must start with http or https");this.options=e??{},this.fetch=(e==null?void 0:e.fetch)??yu(),this.storage=(e==null?void 0:e.storage)??new nu,this.createPdfImpl=e==null?void 0:e.createPdf,this.baseUrl=fs((e==null?void 0:e.baseUrl)??cu),this.fhirBaseUrl=Ve(this.baseUrl,(e==null?void 0:e.fhirUrlPath)??"fhir/R4"),this.authorizeUrl=Ve(this.baseUrl,(e==null?void 0:e.authorizeUrl)??"oauth2/authorize"),this.tokenUrl=Ve(this.baseUrl,(e==null?void 0:e.tokenUrl)??"oauth2/token"),this.logoutUrl=Ve(this.baseUrl,(e==null?void 0:e.logoutUrl)??"oauth2/logout"),this.clientId=(e==null?void 0:e.clientId)??"",this.clientSecret=(e==null?void 0:e.clientSecret)??"",this.onUnauthenticated=e==null?void 0:e.onUnauthenticated,this.cacheTime=(e==null?void 0:e.cacheTime)??(typeof window>"u"?du:uu),this.cacheTime>0?this.requestCache=new Ss((e==null?void 0:e.resourceCacheSize)??lu):this.requestCache=void 0,e!=null&&e.autoBatchTime?(this.autoBatchTime=e.autoBatchTime,this.autoBatchQueue=[]):(this.autoBatchTime=0,this.autoBatchQueue=void 0),e!=null&&e.accessToken&&this.setAccessToken(e.accessToken),this.storage.getInitPromise===void 0?(e!=null&&e.accessToken||this.attemptResumeActiveLogin().catch(console.error),this.initPromise=Promise.resolve(),this.dispatchEvent({type:"storageInitialized"})):(this.initComplete=!1,this.initPromise=this.storage.getInitPromise(),this.initPromise.then(()=>{e!=null&&e.accessToken||this.attemptResumeActiveLogin().catch(console.error),this.initComplete=!0,this.dispatchEvent({type:"storageInitialized"})}).catch(t=>{console.error(t),this.initComplete=!0,this.dispatchEvent({type:"storageInitFailed",payload:{error:t}})})),this.setupStorageListener()}get isInitialized(){return this.initComplete}getInitPromise(){return this.initPromise}async attemptResumeActiveLogin(){let e=this.getActiveLogin();e&&(this.setAccessToken(e.accessToken,e.refreshToken),await this.refreshProfile())}getBaseUrl(){return this.baseUrl}getAuthorizeUrl(){return this.authorizeUrl}getTokenUrl(){return this.tokenUrl}getLogoutUrl(){return this.logoutUrl}clear(){this.storage.clear(),typeof window<"u"&&sessionStorage.clear(),this.clearActiveLogin()}clearActiveLogin(){var e;this.storage.setString("activeLogin",void 0),(e=this.requestCache)==null||e.clear(),this.accessToken=void 0,this.refreshToken=void 0,this.refreshPromise=void 0,this.accessTokenExpires=void 0,this.sessionDetails=void 0,this.medplumServer=void 0,this.dispatchEvent({type:"change"})}invalidateUrl(e){var t;e=e.toString(),(t=this.requestCache)==null||t.delete(e)}invalidateAll(){var e;(e=this.requestCache)==null||e.clear()}invalidateSearches(e){let t=Ve(this.fhirBaseUrl,e);if(this.requestCache)for(let n of this.requestCache.keys())(n.endsWith(t)||n.includes(t+"?"))&&this.requestCache.delete(n)}get(e,t={}){e=e.toString();let n=this.getCacheEntry(e,t);if(n)return n.value;let i;e.startsWith(this.fhirBaseUrl)&&this.autoBatchQueue?i=new Promise((a,o)=>{this.autoBatchQueue.push({method:"GET",url:e.replace(this.fhirBaseUrl,""),options:t,resolve:a,reject:o}),this.autoBatchTimerId||(this.autoBatchTimerId=setTimeout(()=>this.executeAutoBatch(),this.autoBatchTime))}):i=this.request("GET",e,t);let s=new Te(i);return this.setCacheEntry(e,s),s}post(e,t,n,i={}){return e=e.toString(),this.setRequestBody(i,t),n&&this.setRequestContentType(i,n),this.invalidateUrl(e),this.request("POST",e,i)}put(e,t,n,i={}){return e=e.toString(),this.setRequestBody(i,t),n&&this.setRequestContentType(i,n),this.invalidateUrl(e),this.request("PUT",e,i)}patch(e,t,n={}){return e=e.toString(),this.setRequestBody(n,t),this.setRequestContentType(n,ve.JSON_PATCH),this.invalidateUrl(e),this.request("PATCH",e,n)}delete(e,t){return e=e.toString(),this.invalidateUrl(e),this.request("DELETE",e,t)}async startNewUser(e,t){let{codeChallengeMethod:n,codeChallenge:i}=await this.startPkce();return this.post("auth/newuser",{...e,clientId:e.clientId??this.clientId,codeChallengeMethod:n,codeChallenge:i},void 0,t)}async startNewProject(e,t){return this.post("auth/newproject",e,void 0,t)}async startNewPatient(e,t){return this.post("auth/newpatient",e,void 0,t)}async startLogin(e,t){return this.post("auth/login",{...await this.ensureCodeChallenge(e),clientId:e.clientId??this.clientId,scope:e.scope},void 0,t)}async startGoogleLogin(e,t){return this.post("auth/google",{...await this.ensureCodeChallenge(e),clientId:e.clientId??this.clientId,scope:e.scope},void 0,t)}async ensureCodeChallenge(e){return e.codeChallenge?e:{...e,...await this.startPkce()}}async signOut(){await this.post(this.logoutUrl,{}),this.clear()}async signInWithRedirect(e){let t=new URLSearchParams(window.location.search).get("code");if(!t){await this.requestAuthorization(e);return}return this.processCode(t)}signOutWithRedirect(){window.location.assign(this.logoutUrl)}async signInWithExternalAuth(e,t,n,i,s=!0){let a=i;s&&(a=await this.ensureCodeChallenge(i)),window.location.assign(this.getExternalAuthRedirectUri(e,t,n,a,s))}async exchangeExternalAccessToken(e,t){if(t=t??this.clientId,!t)throw new Error("MedplumClient is missing clientId");let n=new URLSearchParams;return n.set("grant_type","urn:ietf:params:oauth:grant-type:token-exchange"),n.set("subject_token_type","urn:ietf:params:oauth:token-type:access_token"),n.set("client_id",t),n.set("subject_token",e),this.fetchTokens(n)}getExternalAuthRedirectUri(e,t,n,i,s=!0){let a=new URL(e);if(a.searchParams.set("response_type","code"),a.searchParams.set("client_id",t),a.searchParams.set("redirect_uri",n),a.searchParams.set("scope",i.scope??"openid profile email"),a.searchParams.set("state",JSON.stringify(i)),s){let{codeChallenge:o,codeChallengeMethod:c}=i;if(!c)throw new Error("`LoginRequest` for external auth must include a `codeChallengeMethod`.");if(!o)throw new Error("`LoginRequest` for external auth must include a `codeChallenge`.");a.searchParams.set("code_challenge_method",c),a.searchParams.set("code_challenge",o)}return a.toString()}fhirUrl(...e){return new URL(Ve(this.fhirBaseUrl,e.join("/")))}fhirSearchUrl(e,t){let n=this.fhirUrl(e);return t&&(n.search=mc(t)),n}search(e,t,n){let i=this.fhirSearchUrl(e,t),s="search-"+i.toString(),a=this.getCacheEntry(s,n);if(a)return a.value;let o=new Te((async()=>{let c=await this.get(i,n);if(c.entry)for(let l of c.entry)this.cacheResource(l.resource);return c})());return this.setCacheEntry(s,o),o}searchOne(e,t,n){let i=this.fhirSearchUrl(e,t);i.searchParams.set("_count","1"),i.searchParams.sort();let s="searchOne-"+i.toString(),a=this.getCacheEntry(s,n);if(a)return a.value;let o=new Te(this.search(e,i.searchParams,n).then(c=>{var l,u;return(u=(l=c.entry)==null?void 0:l[0])==null?void 0:u.resource}));return this.setCacheEntry(s,o),o}searchResources(e,t,n){let i="searchResources-"+this.fhirSearchUrl(e,t).toString(),s=this.getCacheEntry(i,n);if(s)return s.value;let a=new Te(this.search(e,t,n).then(Pn));return this.setCacheEntry(i,a),a}async*searchResourcePages(e,t,n){var s,a;let i=this.fhirSearchUrl(e,t);for(;i;){let o=new URL(i).searchParams,c=await this.search(e,o,n),l=(s=c.link)==null?void 0:s.find(u=>u.relation==="next");if(!((a=c.entry)!=null&&a.length)&&!l)break;yield Pn(c),i=l!=null&&l.url?new URL(l.url):void 0}}searchValueSet(e,t,n){return this.valueSetExpand({url:e,filter:t},n)}valueSetExpand(e,t){let n=this.fhirUrl("ValueSet","$expand");return n.search=new URLSearchParams(e).toString(),this.get(n.toString(),t)}getCached(e,t){var i,s;let n=(s=(i=this.requestCache)==null?void 0:i.get(this.fhirUrl(e,t).toString()))==null?void 0:s.value;return n!=null&&n.isOk()?n.read():void 0}getCachedReference(e){let t=e.reference;if(!t)return;if(t==="system")return li;let[n,i]=t.split("/");if(!(!n||!i))return this.getCached(n,i)}readResource(e,t,n){return this.get(this.fhirUrl(e,t),n)}readReference(e,t){let n=e.reference;if(!n)return new Te(Promise.reject(new Error("Missing reference")));if(n==="system")return new Te(Promise.resolve(li));let[i,s]=n.split("/");return!i||!s?new Te(Promise.reject(new Error("Invalid reference"))):this.readResource(i,s,t)}requestSchema(e){if(ss(e))return Promise.resolve();let t=e+"-requestSchema",n=this.getCacheEntry(t,void 0);if(n)return n.value;let i=new Te((async()=>{let s=`{
      StructureDefinitionList(name: "${e}") {
        resourceType,
        name,
        kind,
        description,
        type,
        snapshot {
          element {
            id,
            path,
            definition,
            min,
            max,
            base {
              path,
              min,
              max
            },
            contentReference,
            type {
              code,
              profile,
              targetProfile
            },
            binding {
              strength,
              valueSet
            }
          }
        }
      }
      SearchParameterList(base: "${e}", _count: 100) {
        base,
        code,
        type,
        expression,
        target
      }
    }`.replace(/\s+/g," "),a=await this.graphql(s);Qr(a.data.StructureDefinitionList);for(let o of a.data.SearchParameterList)kc(o)})());return this.setCacheEntry(t,i),i}requestProfileSchema(e,t){if(!(t!=null&&t.expandProfile)&&os(e))return Promise.resolve([e]);let n=e+"-requestSchema"+(t!=null&&t.expandProfile?"-nested":""),i=this.getCacheEntry(n,void 0);if(i)return i.value;let s=new Te((async()=>{if(t!=null&&t.expandProfile){let a=this.fhirUrl("StructureDefinition","$expand-profile");a.search=new URLSearchParams({url:e}).toString();let o=await this.post(a.toString(),{});return Pn(o).map(c=>(is(c,c.url),c.url))}else{let a=await this.searchOne("StructureDefinition",{url:e,_sort:"-_lastUpdated"});return a?(Qr([a],e),[e]):(console.warn(`No StructureDefinition found for ${e}!`),[])}})());return this.setCacheEntry(n,s),s}readHistory(e,t,n){return this.get(this.fhirUrl(e,t,"_history"),n)}readVersion(e,t,n,i){return this.get(this.fhirUrl(e,t,"_history",n),i)}readPatientEverything(e,t){return this.get(this.fhirUrl("Patient",e,"$everything"),t)}createResource(e,t){if(!e.resourceType)throw new Error("Missing resourceType");return this.invalidateSearches(e.resourceType),this.post(this.fhirUrl(e.resourceType),e,void 0,t)}async createResourceIfNoneExist(e,t,n){return await this.searchOne(e.resourceType,t,n)??this.createResource(e,n)}async upsertResource(e,t,n){let i=this.fhirSearchUrl(e.resourceType,t),s=await this.put(i,e,void 0,n);return s||(s=e),this.cacheResource(s),this.invalidateUrl(this.fhirUrl(e.resourceType,e.id,"_history")),this.invalidateSearches(e.resourceType),s}async createAttachment(e,t,n,i,s){let a=hi(e,t,n,i),o=s??(typeof t=="object"?t:{}),c=await this.createBinary(a,o);return{contentType:a.contentType,url:c.url,title:a.filename}}createBinary(e,t,n,i,s){let a=hi(e,t,n,i),o=s??(typeof t=="object"?t:{}),{data:c,contentType:l,filename:u,securityContext:d,onProgress:m}=a,f=this.fhirUrl("Binary");return u&&f.searchParams.set("_filename",u),d!=null&&d.reference&&this.setRequestHeader(o,"X-Security-Context",d.reference),m?this.uploadwithProgress(f,c,l,m,o):this.post(f,c,l,o)}uploadwithProgress(e,t,n,i,s){return new Promise((a,o)=>{var d;let c=new XMLHttpRequest,l=()=>c.abort();(d=s==null?void 0:s.signal)==null||d.addEventListener("abort",l);let u=m=>{var f;(f=s==null?void 0:s.signal)==null||f.removeEventListener("abort",l),m instanceof Error?o(m):a(m)};if(c.responseType="json",c.onabort=()=>u(new Error("Request aborted")),c.onerror=()=>u(new Error("Request error")),i&&(c.upload.onprogress=m=>i(m),c.upload.onload=m=>i(m)),c.onload=()=>{c.status>=200&&c.status<300?u(c.response):u(new U(he(c.response||c.statusText)))},c.open("POST",e),c.withCredentials=!0,c.setRequestHeader("Authorization","Bearer "+this.accessToken),c.setRequestHeader("Cache-Control","no-cache, no-store, max-age=0"),c.setRequestHeader("Content-Type",n),c.setRequestHeader("X-Medplum","extended"),s==null?void 0:s.headers){let m=s.headers;for(let[f,p]of Object.entries(m))c.setRequestHeader(f,p)}c.send(t)})}async createPdf(e,t,n,i){if(!this.createPdfImpl)throw new Error("PDF creation not enabled");let s=ju(e,t,n,i),a=typeof t=="object"?t:{},{docDefinition:o,tableLayouts:c,fonts:l,...u}=s,d=await this.createPdfImpl(o,c,l),m={...u,data:d,contentType:"application/pdf"};return this.createBinary(m,a)}createComment(e,t,n){let i=this.getProfile(),s,a;return e.resourceType==="Encounter"&&(s=Le(e),a=e.subject),e.resourceType==="ServiceRequest"&&(s=e.encounter,a=e.subject),e.resourceType==="Patient"&&(a=Le(e)),this.createResource({resourceType:"Communication",status:"completed",basedOn:[Le(e)],encounter:s,subject:a,sender:i?Le(i):void 0,sent:new Date().toISOString(),payload:[{contentString:t}]},n)}async updateResource(e,t){if(!e.resourceType)throw new Error("Missing resourceType");if(!e.id)throw new Error("Missing id");let n=await this.put(this.fhirUrl(e.resourceType,e.id),e,void 0,t);return n||(n=e),this.cacheResource(n),this.invalidateUrl(this.fhirUrl(e.resourceType,e.id,"_history")),this.invalidateSearches(e.resourceType),n}async patchResource(e,t,n,i){let s=await this.patch(this.fhirUrl(e,t),n,i);return this.cacheResource(s),this.invalidateUrl(this.fhirUrl(e,t,"_history")),this.invalidateSearches(e),s}deleteResource(e,t,n){return this.deleteCacheEntry(this.fhirUrl(e,t).toString()),this.invalidateSearches(e),this.delete(this.fhirUrl(e,t),n)}validateResource(e,t){return this.post(this.fhirUrl(e.resourceType,"$validate"),e,void 0,t)}executeBot(e,t,n,i){let s;if(typeof e=="string"){let a=e;s=this.fhirUrl("Bot",a,"$execute")}else{let a=e;s=this.fhirUrl("Bot","$execute"),s.searchParams.set("identifier",a.system+"|"+a.value)}return this.post(s,t,n,i)}executeBatch(e,t){return this.post(this.fhirBaseUrl,e,void 0,t)}sendEmail(e,t){return this.post("email/v1/send",e,ve.JSON,t)}graphql(e,t,n,i){return this.post(this.fhirUrl("$graphql"),{query:e,operationName:t,variables:n},ve.JSON,i)}readResourceGraph(e,t,n,i){return this.get(`${this.fhirUrl(e,t)}/$graph?graph=${n}`,i)}pushToAgent(e,t,n,i,s,a){return this.post(this.fhirUrl("Agent",Zn(e),"$push"),{destination:typeof t=="string"?t:Z(t),body:n,contentType:i,waitForResponse:s},ve.FHIR_JSON,a)}getActiveLogin(){return this.storage.getObject("activeLogin")}async setActiveLogin(e){var t,n;(!((t=this.sessionDetails)!=null&&t.profile)||Z(this.sessionDetails.profile)!==((n=e.profile)==null?void 0:n.reference))&&this.clearActiveLogin(),this.setAccessToken(e.accessToken,e.refreshToken),this.storage.setObject("activeLogin",e),this.addLogin(e),this.refreshPromise=void 0,await this.refreshProfile()}getAccessToken(){return this.accessToken}setAccessToken(e,t){this.accessToken=e,this.refreshToken=t,this.sessionDetails=void 0,this.accessTokenExpires=eu(e),this.medplumServer=Xl(e)}getLogins(){return this.storage.getObject("logins")??[]}addLogin(e){let t=this.getLogins().filter(n=>{var i,s;return((i=n.profile)==null?void 0:i.reference)!==((s=e.profile)==null?void 0:s.reference)});t.push(e),this.storage.setObject("logins",t)}async refreshProfile(){return this.medplumServer?(this.profilePromise=new Promise((e,t)=>{this.dispatchEvent({type:"profileRefreshing"}),this.get("auth/me").then(n=>{var s,a;this.profilePromise=void 0;let i=((a=(s=this.sessionDetails)==null?void 0:s.profile)==null?void 0:a.id)!==n.profile.id;this.sessionDetails=n,i&&this.dispatchEvent({type:"change"}),this.dispatchEvent({type:"profileRefreshed"}),e(n.profile)}).catch(t)}),this.profilePromise):Promise.resolve(void 0)}isLoading(){return!this.isInitialized||!!this.profilePromise}isSuperAdmin(){var e;return!!((e=this.sessionDetails)!=null&&e.project.superAdmin)}isProjectAdmin(){var e;return!!((e=this.sessionDetails)!=null&&e.membership.admin)}getProject(){var e;return(e=this.sessionDetails)==null?void 0:e.project}getProjectMembership(){var e;return(e=this.sessionDetails)==null?void 0:e.membership}getProfile(){var e;return(e=this.sessionDetails)==null?void 0:e.profile}async getProfileAsync(){return this.profilePromise?this.profilePromise:this.sessionDetails?this.sessionDetails.profile:this.refreshProfile()}getUserConfiguration(){var e;return(e=this.sessionDetails)==null?void 0:e.config}getAccessPolicy(){var e;return(e=this.sessionDetails)==null?void 0:e.accessPolicy}async download(e,t={}){this.refreshPromise&&await this.refreshPromise;let n=e.toString();n.startsWith(hu)&&(e=this.fhirUrl(n));let i=t.headers;return i||(i={},t.headers=i),i.Accept||(i.Accept="*/*"),this.addFetchOptionsDefaults(t),(await this.fetchWithRetry(e.toString(),t)).blob()}async createMedia(e,t){let{additionalFields:n,...i}=e,s=await this.createResource({resourceType:"Media",status:"preparation",content:{contentType:e.contentType},...n});i.securityContext||(i.securityContext=Le(s));let a=await this.createAttachment(i,t);return this.updateResource({...s,status:"completed",content:a})}async uploadMedia(e,t,n,i,s){return this.createMedia({data:e,contentType:t,filename:n,additionalFields:i},s)}async bulkExport(e="",t,n,i){let s=e&&`${e}/`,a=this.fhirUrl(`${s}$export`);return t&&a.searchParams.set("_type",t),n&&a.searchParams.set("_since",n),this.startAsyncRequest(a.toString(),i)}async startAsyncRequest(e,t={}){this.addFetchOptionsDefaults(t);let n=t.headers;return n.Prefer="respond-async",this.request("POST",e,t)}get keyValue(){return this.keyValueClient||(this.keyValueClient=new tu(this)),this.keyValueClient}getCacheEntry(e,t){if(!this.requestCache||(t==null?void 0:t.cache)==="no-cache"||(t==null?void 0:t.cache)==="reload")return;let n=this.requestCache.get(e);if(!(!n||n.requestTime+this.cacheTime<Date.now()))return n}setCacheEntry(e,t){this.requestCache&&this.requestCache.set(e,{requestTime:Date.now(),value:t})}cacheResource(e){var t,n;e!=null&&e.id&&!((n=(t=e.meta)==null?void 0:t.tag)!=null&&n.some(i=>i.code==="SUBSETTED"))&&this.setCacheEntry(this.fhirUrl(e.resourceType,e.id).toString(),new Te(Promise.resolve(e)))}deleteCacheEntry(e){this.requestCache&&this.requestCache.delete(e)}async request(e,t,n={},i={}){var c;await this.refreshIfExpired(),n.method=e,this.addFetchOptionsDefaults(n);let s=await this.fetchWithRetry(t,n);if(s.status===401)return this.handleUnauthenticated(e,t,n);if(s.status===204||s.status===304)return;let a=(c=s.headers.get("content-type"))==null?void 0:c.includes("json");if(s.status===404&&!a)throw new U(So);let o=await this.parseBody(s,a);if(s.status===200&&n.followRedirectOnOk||s.status===201&&n.followRedirectOnCreated){let l=await di(s,o);if(l)return this.request("GET",l,{...n,body:void 0})}if(s.status===202&&n.pollStatusOnAccepted){let l=await di(s,o)??i.statusUrl;if(l)return this.pollStatus(l,n,i)}if(s.status>=400)throw new U(he(o));return o}async parseBody(e,t){let n;if(t)try{n=await e.json()}catch(i){throw console.error("Error parsing response",e.status,i),i}else n=await e.text();return n}async fetchWithRetry(e,t){e.startsWith("http")||(e=Ve(this.baseUrl,e));let n=(t==null?void 0:t.maxRetries)??2,i=200;for(let s=0;s<=n;s++){try{this.options.verbose&&this.logRequest(e,t);let a=await this.fetch(e,t);if(this.options.verbose&&this.logResponse(a),a.status<500||s===n)return a}catch(a){if(a.message==="Failed to fetch"&&s===0&&this.dispatchEvent({type:"offline"}),a.name==="AbortError"||s===n)throw a}await ti(i)}throw new Error("Unreachable")}logRequest(e,t){if(console.log(`> ${t.method} ${e}`),t.headers){let n=t.headers;for(let i of Xn(Object.keys(n)))console.log(`> ${i}: ${n[i]}`)}}logResponse(e){console.log(`< ${e.status} ${e.statusText}`),e.headers&&e.headers.forEach((t,n)=>console.log(`< ${n}: ${t}`))}async pollStatus(e,t,n){let i={...t,method:"GET",body:void 0,redirect:"follow"};if(n.pollCount===void 0)t.headers&&typeof t.headers=="object"&&"Prefer"in t.headers&&(i.headers={...t.headers},delete i.headers.Prefer),n.statusUrl=e,n.pollCount=1;else{let s=t.pollStatusPeriod??1e3;await ti(s),n.pollCount++}return this.request("GET",e,i,n)}async executeAutoBatch(){var i,s;let e=[...this.autoBatchQueue];if(this.autoBatchQueue.length=0,this.autoBatchTimerId=void 0,e.length===1){let a=e[0];try{a.resolve(await this.request(a.method,Ve(this.fhirBaseUrl,a.url),a.options))}catch(o){a.reject(new U(he(o)))}return}let t={resourceType:"Bundle",type:"batch",entry:e.map(a=>({request:{method:a.method,url:a.url},resource:a.options.body?JSON.parse(a.options.body):void 0}))},n=await this.post(this.fhirBaseUrl,t);for(let a=0;a<e.length;a++){let o=e[a],c=(i=n.entry)==null?void 0:i[a];(s=c==null?void 0:c.response)!=null&&s.outcome&&!es(c.response.outcome)?o.reject(new U(c.response.outcome)):o.resolve(c==null?void 0:c.resource)}}addFetchOptionsDefaults(e){this.setRequestHeader(e,"X-Medplum","extended"),this.setRequestHeader(e,"Accept",ou,!0),e.body&&this.setRequestHeader(e,"Content-Type",ve.FHIR_JSON,!0),this.accessToken?this.setRequestHeader(e,"Authorization","Bearer "+this.accessToken):this.basicAuth&&this.setRequestHeader(e,"Authorization","Basic "+this.basicAuth),e.cache||(e.cache="no-cache"),e.credentials||(e.credentials="include")}setRequestContentType(e,t){this.setRequestHeader(e,"Content-Type",t)}setRequestHeader(e,t,n,i=!1){e.headers||(e.headers={});let s=e.headers;i&&s[t]||(s[t]=n)}setRequestBody(e,t){typeof t=="string"||typeof Blob<"u"&&(t instanceof Blob||t.constructor.name==="Blob")||typeof File<"u"&&(t instanceof File||t.constructor.name==="File")||typeof Uint8Array<"u"&&(t instanceof Uint8Array||t.constructor.name==="Uint8Array")?e.body=t:t&&(e.body=JSON.stringify(t))}handleUnauthenticated(e,t,n){return this.refresh()?this.request(e,t,n):(this.clear(),this.onUnauthenticated&&this.onUnauthenticated(),Promise.reject(new Error("Unauthenticated")))}async startPkce(){let e=si();sessionStorage.setItem("pkceState",e);let t=si();sessionStorage.setItem("codeVerifier",t);let n=await Bl(t),i=cc(n).replaceAll("+","-").replaceAll("/","_").replaceAll("=","");return sessionStorage.setItem("codeChallenge",i),{codeChallengeMethod:"S256",codeChallenge:i}}async requestAuthorization(e){let t=await this.ensureCodeChallenge(e??{}),n=new URL(this.authorizeUrl);n.searchParams.set("response_type","code"),n.searchParams.set("state",sessionStorage.getItem("pkceState")),n.searchParams.set("client_id",t.clientId??this.clientId),n.searchParams.set("redirect_uri",t.redirectUri??ui()),n.searchParams.set("code_challenge_method",t.codeChallengeMethod),n.searchParams.set("code_challenge",t.codeChallenge),n.searchParams.set("scope",t.scope??"openid profile"),window.location.assign(n.toString())}processCode(e,t){let n=new URLSearchParams;if(n.set("grant_type","authorization_code"),n.set("code",e),n.set("client_id",(t==null?void 0:t.clientId)??this.clientId),n.set("redirect_uri",(t==null?void 0:t.redirectUri)??ui()),typeof sessionStorage<"u"){let i=sessionStorage.getItem("codeVerifier");i&&n.set("code_verifier",i)}return this.fetchTokens(n)}refreshIfExpired(){return!this.refreshPromise&&this.accessTokenExpires!==void 0&&this.accessTokenExpires<Date.now()&&this.refresh(),this.refreshPromise??Promise.resolve()}refresh(){if(this.refreshPromise)return this.refreshPromise;if(this.refreshToken){let e=new URLSearchParams;return e.set("grant_type","refresh_token"),e.set("client_id",this.clientId),e.set("refresh_token",this.refreshToken),this.refreshPromise=this.fetchTokens(e),this.refreshPromise}if(this.clientId&&this.clientSecret)return this.refreshPromise=this.startClientLogin(this.clientId,this.clientSecret),this.refreshPromise}async startClientLogin(e,t){this.clientId=e,this.clientSecret=t;let n=new URLSearchParams;return n.set("grant_type","client_credentials"),n.set("client_id",e),n.set("client_secret",t),this.fetchTokens(n)}async startJwtBearerLogin(e,t,n){this.clientId=e;let i=new URLSearchParams;return i.set("grant_type","urn:ietf:params:oauth:grant-type:jwt-bearer"),i.set("client_id",e),i.set("assertion",t),i.set("scope",n),this.fetchTokens(i)}async startJwtAssertionLogin(e){let t=new URLSearchParams;return t.append("grant_type","client_credentials"),t.append("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),t.append("client_assertion",e),this.fetchTokens(t)}setBasicAuth(e,t){this.clientId=e,this.clientSecret=t,this.basicAuth=Fl(e+":"+t)}async fhircastSubscribe(e,t){if(!(typeof e=="string"&&e!==""))throw new U(G("Invalid topic provided. Topic must be a valid string."));if(!(typeof t=="object"&&Array.isArray(t)&&t.length>0))throw new U(G("Invalid events provided. Events must be an array of event names containing at least one event."));let n={channelType:"websocket",mode:"subscribe",topic:e,events:t},i=(await this.post("/fhircast/STU3",ai(n),ve.FORM_URL_ENCODED))["hub.channel.endpoint"];if(!i)throw new Error("Invalid response!");return n.endpoint=i,n}async fhircastUnsubscribe(e){if(!fr(e))throw new U(G("Invalid topic or subscriptionRequest. SubscriptionRequest must be an object."));if(!(e.endpoint&&typeof e.endpoint=="string"&&e.endpoint.startsWith("ws")))throw new U(G("Provided subscription request must have an endpoint in order to unsubscribe."));e.mode="unsubscribe",await this.post("/fhircast/STU3",ai(e),ve.FORM_URL_ENCODED)}fhircastConnect(e){return new Yl(e)}async fhircastPublish(e,t,n,i){return zl(t)?this.post(`/fhircast/STU3/${e}`,ci(e,t,n,i),ve.JSON):(Hl(t),this.post(`/fhircast/STU3/${e}`,ci(e,t,n),ve.JSON))}async fhircastGetContext(e){return this.get(`/fhircast/STU3/${e}`)}async invite(e,t){return this.post("admin/projects/"+e+"/invite",t)}async fetchTokens(e){let t={method:"POST",headers:{"Content-Type":ve.FORM_URL_ENCODED},body:e.toString(),credentials:"include"},n=t.headers;this.basicAuth&&(n.Authorization=`Basic ${this.basicAuth}`);let i;try{i=await this.fetchWithRetry(this.tokenUrl,t)}catch(a){throw this.refreshPromise=void 0,a}if(!i.ok){this.clearActiveLogin();try{let a=await i.json();throw new U(mt(a.error_description))}catch(a){throw new U(mt("Failed to fetch tokens"),a)}}let s=await i.json();return await this.verifyTokens(s),this.getProfile()}async verifyTokens(e){let t=e.access_token;if(Kl(t)){let n=pr(t);if(Date.now()>=n.exp*1e3)throw this.clearActiveLogin(),new Error("Token expired");if(n.cid){if(n.cid!==this.clientId)throw this.clearActiveLogin(),new Error("Token was not issued for this audience")}else if(this.clientId&&n.client_id!==this.clientId)throw this.clearActiveLogin(),new Error("Token was not issued for this audience")}return this.setActiveLogin({accessToken:t,refreshToken:e.refresh_token,project:e.project,profile:e.profile})}setupStorageListener(){try{window.addEventListener("storage",e=>{(e.key===null||e.key==="activeLogin")&&window.location.reload()})}catch{}}getSubscriptionManager(){return this.subscriptionManager||(this.subscriptionManager=new au(this,hc(this.baseUrl,"/ws/subscriptions-r4"))),this.subscriptionManager}subscribeToCriteria(e,t){return this.getSubscriptionManager().addCriteria(e,t)}unsubscribeFromCriteria(e,t){this.subscriptionManager&&(this.subscriptionManager.removeCriteria(e,t),this.subscriptionManager.getCriteriaCount()===0&&this.subscriptionManager.closeWebSocket())}getMasterSubscriptionEmitter(){return this.getSubscriptionManager().getMasterEmitter()}};function yu(){if(!globalThis.fetch)throw new Error("Fetch not available in this environment");return globalThis.fetch.bind(globalThis)}function ui(){return typeof window>"u"?"":window.location.protocol+"//"+window.location.host+"/"}async function di(e,t){var s,a;let n=e.headers.get("content-location");if(n)return n;let i=e.headers.get("location");if(i)return i;if(Wn(t)&&((a=(s=t.issue)==null?void 0:s[0])!=null&&a.diagnostics))return t.issue[0].diagnostics}function Pn(e){var n;let t=((n=e.entry)==null?void 0:n.map(i=>i.resource))??[];return Object.assign(t,{bundle:e})}function xu(e){return Ie(e)&&"data"in e&&"contentType"in e}function hi(e,t,n,i){return xu(e)?e:{data:e,filename:t,contentType:n,onProgress:i}}function vu(e){return Ie(e)&&"docDefinition"in e}function ju(e,t,n,i){return vu(e)?e:{docDefinition:e,filename:t,tableLayouts:n,fonts:i}}function Ps({parentContext:e,path:t,elements:n,profileUrl:i,debugMode:s,accessPolicyResource:a}){if(t===(e==null?void 0:e.path))return;s??(s=(e==null?void 0:e.debugMode)??!1),a??(a=e==null?void 0:e.accessPolicyResource);let o=bu(t,n,e,!!s),c=On(t,".",2)[1];o=Cu(o,a,c),o=wu(o,a,c);let l=Object.create(null);for(let[d,m]of Object.entries(o))l[t+"."+d]=m;let u;if(e&&!e.isDefaultContext)u=e.getExtendedProps;else{let d=Object.create(null);u=m=>{let f=On(m,".",2)[1];if(f){if(!d[f]){let p=sn(f,a==null?void 0:a.hiddenFields);d[f]={hidden:p,readonly:p||sn(f,a==null?void 0:a.readonlyFields)}}return d[f]}}}return{path:t,elements:o,elementsByPath:l,profileUrl:i??(e==null?void 0:e.profileUrl),debugMode:s,getExtendedProps:u,accessPolicyResource:a}}function bu(e,t,n,i){let s=Object.create(null);if(n)for(let[o,c]of Object.entries(n.elementsByPath)){let l=lc(e,o);l!==void 0&&(s[l]=c)}let a=!1;if(t)for(let[o,c]of Object.entries(t))o in s||(s[o]=c,a=!0);return i&&console.assert(a,"Unnecessary ElementsContext; not using any newly provided elements"),s}function Cu(e,t,n){var s;if(!((s=t==null?void 0:t.hiddenFields)!=null&&s.length))return e;let i=n?n+".":"";return Object.fromEntries(Object.entries(e).filter(([a])=>!sn(i+a,t.hiddenFields)))}function wu(e,t,n){var a;if(!((a=t==null?void 0:t.readonlyFields)!=null&&a.length))return e;let i=Object.create(null),s=n?n+".":"";for(let[o,c]of Object.entries(e))sn(s+o,t.readonlyFields)?i[o]={...c,readonly:!0}:i[o]=c;return i}function sn(e,t){if(!(t!=null&&t.length))return!1;let n=e.split(".");for(let i=1;i<=n.length;i++){let s=n.slice(0,i).join(".");if(t.includes(s))return!0}return!1}function Su(e){return e.type!==void 0&&e.type.length>0}function ku(e,t,n,i){var a;let s=_o(e,t.path,{profileUrl:i});if(s){let o=((a=n.typeSchema)==null?void 0:a.elements)??n.elements;return s.some(c=>No(c,t,n,o))??!1}return console.assert(!1,"getNestedProperty[%s] in isDiscriminatorComponentMatch missed",t.path),!1}function Eu(e,t,n,i){var s,a;if(e)for(let o of t){let c={value:e,type:((s=o.typeSchema)==null?void 0:s.name)??((a=o.type)==null?void 0:a[0].code)};if(n.every(l=>{var u;return ku(c,l,o,((u=o.typeSchema)==null?void 0:u.url)??i)}))return o.name}}[...or];cr().registerInfix("->",{precedence:z.Arrow}).registerInfix(";",{precedence:z.Semicolon});[...or];cr();var Tu=(e=>(e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e))(Tu||{}),Pu=Object.create,Is=Object.defineProperty,Iu=Object.getOwnPropertyDescriptor,Rs=Object.getOwnPropertyNames,Ru=Object.getPrototypeOf,Du=Object.prototype.hasOwnProperty,Wt=(e,t)=>function(){return t||(0,e[Rs(e)[0]])((t={exports:{}}).exports,t),t.exports},Au=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Rs(t))!Du.call(e,s)&&s!==n&&Is(e,s,{get:()=>t[s],enumerable:!(i=Iu(t,s))||i.enumerable});return e},Mu=(e,t,n)=>(n=e!=null?Pu(Ru(e)):{},Au(Is(n,"default",{value:e,enumerable:!0}),e)),Ds=Wt({"../../node_modules/rfc6902/pointer.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Pointer=void 0;function t(s){return s.replace(/~1/g,"/").replace(/~0/g,"~")}function n(s){return s.replace(/~/g,"~0").replace(/\//g,"~1")}var i=function(){function s(a){a===void 0&&(a=[""]),this.tokens=a}return s.fromJSON=function(a){var o=a.split("/").map(t);if(o[0]!=="")throw new Error("Invalid JSON Pointer: ".concat(a));return new s(o)},s.prototype.toString=function(){return this.tokens.map(n).join("/")},s.prototype.evaluate=function(a){for(var o=null,c="",l=a,u=1,d=this.tokens.length;u<d;u++)o=l,c=this.tokens[u],!(c=="__proto__"||c=="constructor"||c=="prototype")&&(l=(o||{})[c]);return{parent:o,key:c,value:l}},s.prototype.get=function(a){return this.evaluate(a).value},s.prototype.set=function(a,o){var c=this.evaluate(a);c.parent&&(c.parent[c.key]=o)},s.prototype.push=function(a){this.tokens.push(a)},s.prototype.add=function(a){var o=this.tokens.concat(String(a));return new s(o)},s}();e.Pointer=i}}),As=Wt({"../../node_modules/rfc6902/util.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.clone=e.objectType=e.hasOwnProperty=void 0,e.hasOwnProperty=Object.prototype.hasOwnProperty;function t(s){return s===void 0?"undefined":s===null?"null":Array.isArray(s)?"array":typeof s}e.objectType=t;function n(s){return s!=null&&typeof s=="object"}function i(s){if(!n(s))return s;if(s.constructor==Array){for(var a=s.length,o=new Array(a),c=0;c<a;c++)o[c]=i(s[c]);return o}if(s.constructor==Date){var l=new Date(+s);return l}var u={};for(var d in s)e.hasOwnProperty.call(s,d)&&(u[d]=i(s[d]));return u}e.clone=i}}),Ms=Wt({"../../node_modules/rfc6902/diff.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.diffAny=e.diffObjects=e.diffArrays=e.intersection=e.subtract=e.isDestructive=void 0;var t=As();function n(m){var f=m.op;return f==="remove"||f==="replace"||f==="copy"||f==="move"}e.isDestructive=n;function i(m,f){var p={};for(var g in m)t.hasOwnProperty.call(m,g)&&m[g]!==void 0&&(p[g]=1);for(var x in f)t.hasOwnProperty.call(f,x)&&f[x]!==void 0&&delete p[x];return Object.keys(p)}e.subtract=i;function s(m){for(var f=m.length,p={},g=0;g<f;g++){var x=m[g];for(var C in x)t.hasOwnProperty.call(x,C)&&x[C]!==void 0&&(p[C]=(p[C]||0)+1)}for(var C in p)p[C]<f&&delete p[C];return Object.keys(p)}e.intersection=s;function a(m){return m.op==="add"}function o(m){return m.op==="remove"}function c(m,f){return{operations:m.operations.concat(f),cost:m.cost+1}}function l(m,f,p,g){g===void 0&&(g=d);var x={"0,0":{operations:[],cost:0}};function C(A,M){var I="".concat(A,",").concat(M),N=x[I];if(N===void 0){if(A>0&&M>0&&!g(m[A-1],f[M-1],p.add(String(A-1))).length)N=C(A-1,M-1);else{var Q=[];if(A>0){var J=C(A-1,M),K={op:"remove",index:A-1};Q.push(c(J,K))}if(M>0){var pe=C(A,M-1),ge={op:"add",index:A-1,value:f[M-1]};Q.push(c(pe,ge))}if(A>0&&M>0){var X=C(A-1,M-1),Be={op:"replace",index:A-1,original:m[A-1],value:f[M-1]};Q.push(c(X,Be))}var oe=Q.sort(function(k,q){return k.cost-q.cost})[0];N=oe}x[I]=N}return N}var j=isNaN(m.length)||m.length<=0?0:m.length,w=isNaN(f.length)||f.length<=0?0:f.length,y=C(j,w).operations,v=y.reduce(function(A,M){var I=A[0],N=A[1];if(a(M)){var Q=M.index+1+N,J=Q<j+N?String(Q):"-",K={op:M.op,path:p.add(J).toString(),value:M.value};return[I.concat(K),N+1]}else if(o(M)){var K={op:M.op,path:p.add(String(M.index+N)).toString()};return[I.concat(K),N-1]}else{var pe=p.add(String(M.index+N)),ge=g(M.original,M.value,pe);return[I.concat.apply(I,ge),N]}},[[],0])[0];return v}e.diffArrays=l;function u(m,f,p,g){g===void 0&&(g=d);var x=[];return i(m,f).forEach(function(C){x.push({op:"remove",path:p.add(C).toString()})}),i(f,m).forEach(function(C){x.push({op:"add",path:p.add(C).toString(),value:f[C]})}),s([m,f]).forEach(function(C){x.push.apply(x,g(m[C],f[C],p.add(C)))}),x}e.diffObjects=u;function d(m,f,p,g){if(g===void 0&&(g=d),m===f)return[];var x=(0,t.objectType)(m),C=(0,t.objectType)(f);return x=="array"&&C=="array"?l(m,f,p,g):x=="object"&&C=="object"?u(m,f,p,g):[{op:"replace",path:p.toString(),value:f}]}e.diffAny=d}}),_u=Wt({"../../node_modules/rfc6902/patch.js"(e){var t=e&&e.__extends||function(){var j=function(w,y){return j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var M in A)Object.prototype.hasOwnProperty.call(A,M)&&(v[M]=A[M])},j(w,y)};return function(w,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");j(w,y);function v(){this.constructor=w}w.prototype=y===null?Object.create(y):(v.prototype=y.prototype,new v)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.InvalidOperationError=e.test=e.copy=e.move=e.replace=e.remove=e.add=e.TestError=e.MissingError=void 0;var n=Ds(),i=As(),s=Ms(),a=function(j){t(w,j);function w(y){var v=j.call(this,"Value required at path: ".concat(y))||this;return v.path=y,v.name="MissingError",v}return w}(Error);e.MissingError=a;var o=function(j){t(w,j);function w(y,v){var A=j.call(this,"Test failed: ".concat(y," != ").concat(v))||this;return A.actual=y,A.expected=v,A.name="TestError",A}return w}(Error);e.TestError=o;function c(j,w,y){if(Array.isArray(j))if(w=="-")j.push(y);else{var v=parseInt(w,10);j.splice(v,0,y)}else j[w]=y}function l(j,w){if(Array.isArray(j)){var y=parseInt(w,10);j.splice(y,1)}else delete j[w]}function u(j,w){var y=n.Pointer.fromJSON(w.path).evaluate(j);return y.parent===void 0?new a(w.path):(c(y.parent,y.key,(0,i.clone)(w.value)),null)}e.add=u;function d(j,w){var y=n.Pointer.fromJSON(w.path).evaluate(j);return y.value===void 0?new a(w.path):(l(y.parent,y.key),null)}e.remove=d;function m(j,w){var y=n.Pointer.fromJSON(w.path).evaluate(j);if(y.parent===null)return new a(w.path);if(Array.isArray(y.parent)){if(parseInt(y.key,10)>=y.parent.length)return new a(w.path)}else if(y.value===void 0)return new a(w.path);return y.parent[y.key]=(0,i.clone)(w.value),null}e.replace=m;function f(j,w){var y=n.Pointer.fromJSON(w.from).evaluate(j);if(y.value===void 0)return new a(w.from);var v=n.Pointer.fromJSON(w.path).evaluate(j);return v.parent===void 0?new a(w.path):(l(y.parent,y.key),c(v.parent,v.key,y.value),null)}e.move=f;function p(j,w){var y=n.Pointer.fromJSON(w.from).evaluate(j);if(y.value===void 0)return new a(w.from);var v=n.Pointer.fromJSON(w.path).evaluate(j);return v.parent===void 0?new a(w.path):(c(v.parent,v.key,(0,i.clone)(y.value)),null)}e.copy=p;function g(j,w){var y=n.Pointer.fromJSON(w.path).evaluate(j);return(0,s.diffAny)(y.value,w.value,new n.Pointer).length?new o(y.value,w.value):null}e.test=g;var x=function(j){t(w,j);function w(y){var v=j.call(this,"Invalid operation: ".concat(y.op))||this;return v.operation=y,v.name="InvalidOperationError",v}return w}(Error);e.InvalidOperationError=x;function C(j,w){switch(w.op){case"add":return u(j,w);case"remove":return d(j,w);case"replace":return m(j,w);case"move":return f(j,w);case"copy":return p(j,w);case"test":return g(j,w)}return new x(w)}e.apply=C}}),Ou=Wt({"../../node_modules/rfc6902/index.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createTests=e.createPatch=e.applyPatch=e.Pointer=void 0;var t=Ds();Object.defineProperty(e,"Pointer",{enumerable:!0,get:function(){return t.Pointer}});var n=_u(),i=Ms();function s(u,d){return d.map(function(m){return(0,n.apply)(u,m)})}e.applyPatch=s;function a(u){function d(m,f,p){var g=u(m,f,p);return Array.isArray(g)?g:(0,i.diffAny)(m,f,p,d)}return d}function o(u,d,m){var f=new t.Pointer;return(m?a(m):i.diffAny)(u,d,f)}e.createPatch=o;function c(u,d){var m=t.Pointer.fromJSON(d).evaluate(u);if(m!==void 0)return{op:"test",path:d,value:m.value}}function l(u,d){var m=new Array;return d.filter(i.isDestructive).forEach(function(f){var p=c(u,f.path);if(p&&m.push(p),"from"in f){var g=c(u,f.from);g&&m.push(g)}}),m}e.createTests=l}}),_s=h.createContext(void 0);function gr(){return h.useContext(_s)}function L(){return gr().medplum}function Lu(){return gr().navigate}function yn(){return gr().profile}var mi=["change","storageInitialized","storageInitFailed","profileRefreshing","profileRefreshed"];function Nu(e){let t=e.medplum,n=e.navigate??Uu,[i,s]=h.useState({profile:t.getProfile(),loading:t.isLoading()});h.useEffect(()=>{function o(){s(c=>({...c,profile:t.getProfile(),loading:t.isLoading()}))}for(let c of mi)t.addEventListener(c,o);return()=>{for(let c of mi)t.removeEventListener(c,o)}},[t]);let a=h.useMemo(()=>({...i,medplum:t,navigate:n}),[i,t,n]);return r.jsx(_s.Provider,{value:a,children:e.children})}function Uu(e){window.location.assign(e)}var fi=new Map,Os=e=>h.useMemo(()=>{if(!e)return;let t=e.split("?")[0];if(!t)return e;let n;try{n=new URLSearchParams(new URL(e).search)}catch{return e}if(!n.has("Key-Pair-Id")||!n.has("Signature"))return e;let i=n.get("Expires");if(!i||i.length>13)return e;let s=fi.get(t);if(s){let a=new URLSearchParams(new URL(s).search).get("Expires");if(a&&parseInt(a,10)*1e3-5e3>Date.now())return s}return fi.set(t,e),e},[e]);function we(e,t){let n=L(),[i,s]=h.useState(()=>pi(n,e)),a=h.useCallback(o=>{Qe(o,i)||s(o)},[i]);return h.useEffect(()=>{let o=!0,c=pi(n,e);return!c&&pt(e)?n.readReference(e).then(l=>{o&&a(l)}).catch(l=>{o&&(a(void 0),t&&t(he(l)))}):a(c),()=>o=!1},[n,e,a,t]),i}function pi(e,t){if(t){if(Tt(t))return t;if(pt(t))return e.getCachedReference(t)}}function Ls(e,t){return Fu("searchResources",e,t)}function Fu(e,t,n){let i=L(),[s,a]=h.useState(),[o,c]=h.useState(!0),[l,u]=h.useState(),[d,m]=h.useState();return h.useEffect(()=>{let f=i.fhirSearchUrl(t,n).toString();f!==s&&(a(f),i[e](t,n).then(p=>{c(!1),u(p),m(wo)}).catch(p=>{c(!1),u(void 0),m(he(p))}))},[i,e,t,n,s]),[l,o,d]}var Bu=3e3;function $u(e,t,n){let i=L(),[s,a]=h.useState(),[o,c]=h.useState(n),l=h.useRef(!1),u=h.useRef(),d=h.useRef(),m=h.useRef(),f=h.useRef();f.current=t,h.useEffect(()=>{o!==n&&!Qe(o,n)&&c(n)},[o,n]),h.useEffect(()=>(u.current&&(clearTimeout(u.current),u.current=void 0),(d.current!==e||!Qe(m.current,o))&&a(i.subscribeToCriteria(e,o==null?void 0:o.subscriptionProps)),d.current=e,m.current=o,()=>{u.current=setTimeout(()=>{a(void 0),i.unsubscribeFromCriteria(e,o==null?void 0:o.subscriptionProps)},Bu)}),[i,e,o]);let p=h.useCallback(g=>{var x;(x=f.current)==null||x.call(f,g.payload)},[]);h.useEffect(()=>s?(l.current||(s.addEventListener("message",p),l.current=!0),()=>{l.current=!1,s.removeEventListener("message",p)}):()=>{},[s,p])}function qu(e){let t=e.value;return t?r.jsx(r.Fragment,{children:fc(t)}):null}var Vu=["meta","implicitRules","contained","extension","modifierExtension"],zu=["language","text"],Re=h.createContext({path:"",profileUrl:void 0,elements:Object.create(null),elementsByPath:Object.create(null),getExtendedProps:()=>({readonly:!1,hidden:!1}),accessPolicyResource:void 0,debugMode:!1,isDefaultContext:!0});Re.displayName="ElementsContext";function gi(e,t){return e.line&&e.line.length>t?e.line[t]:""}function yi(e,t,n){let i=e.line||[];for(;i.length<=t;)i.push("");return i[t]=n,{...e,line:i}}function Hu(e){let[t,n]=h.useState(e.defaultValue||{}),i=h.useRef();i.current=t;let{getExtendedProps:s}=h.useContext(Re),[a,o,c,l,u,d,m]=h.useMemo(()=>["use","type","line1","line2","city","state","postalCode"].map(v=>s(e.path+"."+v)),[s,e.path]);function f(v){n(v),e.onChange&&e.onChange(v)}function p(v){f({...i.current,use:v})}function g(v){f({...i.current,type:v})}function x(v){f(yi(i.current||{},0,v))}function C(v){f(yi(i.current||{},1,v))}function j(v){f({...i.current,city:v})}function w(v){f({...i.current,state:v})}function y(v){f({...i.current,postalCode:v})}return r.jsxs(D,{gap:"xs",wrap:"nowrap",grow:!0,children:[r.jsx(tt,{disabled:e.disabled||(a==null?void 0:a.readonly),"data-testid":"address-use",defaultValue:t.use,onChange:v=>p(v.currentTarget.value),data:["","home","work","temp","old","billing"]}),r.jsx(tt,{disabled:e.disabled||(o==null?void 0:o.readonly),"data-testid":"address-type",defaultValue:t.type,onChange:v=>g(v.currentTarget.value),data:["","postal","physical","both"]}),r.jsx(W,{disabled:e.disabled||(c==null?void 0:c.readonly),placeholder:"Line 1",defaultValue:gi(t,0),onChange:v=>x(v.currentTarget.value)}),r.jsx(W,{disabled:e.disabled||(l==null?void 0:l.readonly),placeholder:"Line 2",defaultValue:gi(t,1),onChange:v=>C(v.currentTarget.value)}),r.jsx(W,{disabled:e.disabled||(u==null?void 0:u.readonly),placeholder:"City",defaultValue:t.city,onChange:v=>j(v.currentTarget.value)}),r.jsx(W,{disabled:e.disabled||(d==null?void 0:d.readonly),placeholder:"State",defaultValue:t.state,onChange:v=>w(v.currentTarget.value)}),r.jsx(W,{disabled:e.disabled||(m==null?void 0:m.readonly),placeholder:"Postal Code",defaultValue:t.postalCode,onChange:v=>y(v.currentTarget.value)})]})}var Wu={outline:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},filled:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none"}},_=(e,t,n,i)=>{let s=h.forwardRef(({color:a="currentColor",size:o=24,stroke:c=2,title:l,className:u,children:d,...m},f)=>h.createElement("svg",{ref:f,...Wu[e],width:o,height:o,className:["tabler-icon",`tabler-icon-${t}`,u].join(" "),strokeWidth:c,stroke:a,...m},[l&&h.createElement("title",{key:"svg-title"},l),...i.map(([p,g])=>h.createElement(p,g)),...Array.isArray(d)?d:[d]]));return s.displayName=`${n}`,s},Qu=_("outline","adjustments-horizontal","IconAdjustmentsHorizontal",[["path",{d:"M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-0"}],["path",{d:"M4 6l8 0",key:"svg-1"}],["path",{d:"M16 6l4 0",key:"svg-2"}],["path",{d:"M8 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-3"}],["path",{d:"M4 12l2 0",key:"svg-4"}],["path",{d:"M10 12l10 0",key:"svg-5"}],["path",{d:"M17 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-6"}],["path",{d:"M4 18l11 0",key:"svg-7"}],["path",{d:"M19 18l1 0",key:"svg-8"}]]),yr=_("outline","alert-circle","IconAlertCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 8v4",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);_("outline","arrow-down","IconArrowDown",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M18 13l-6 6",key:"svg-1"}],["path",{d:"M6 13l6 6",key:"svg-2"}]]);var Gu=_("outline","arrow-right","IconArrowRight",[["path",{d:"M5 12l14 0",key:"svg-0"}],["path",{d:"M13 18l6 -6",key:"svg-1"}],["path",{d:"M13 6l6 6",key:"svg-2"}]]);_("outline","arrow-up","IconArrowUp",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M18 11l-6 -6",key:"svg-1"}],["path",{d:"M6 11l6 -6",key:"svg-2"}]]);var Ju=_("outline","bleach-off","IconBleachOff",[["path",{d:"M5 19h14m1.986 -1.977a2 2 0 0 0 -.146 -.773l-7.1 -12.25a2 2 0 0 0 -3.5 0l-.815 1.405m-1.488 2.568l-4.797 8.277a2 2 0 0 0 1.75 2.75",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),Yu=_("outline","bleach","IconBleach",[["path",{d:"M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75",key:"svg-0"}]]),Zu=_("outline","box-multiple","IconBoxMultiple",[["path",{d:"M7 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M17 17v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h2",key:"svg-1"}]]),Ku=_("outline","brackets-contain","IconBracketsContain",[["path",{d:"M7 4h-4v16h4",key:"svg-0"}],["path",{d:"M17 4h4v16h-4",key:"svg-1"}],["path",{d:"M8 16h.01",key:"svg-2"}],["path",{d:"M12 16h.01",key:"svg-3"}],["path",{d:"M16 16h.01",key:"svg-4"}]]),Xu=_("outline","bucket-off","IconBucketOff",[["path",{d:"M5.029 5.036c-.655 .58 -1.029 1.25 -1.029 1.964c0 2.033 3.033 3.712 6.96 3.967m3.788 -.21c3.064 -.559 5.252 -2.029 5.252 -3.757c0 -2.21 -3.582 -4 -8 -4c-1.605 0 -3.1 .236 -4.352 .643",key:"svg-0"}],["path",{d:"M4 7c0 .664 .088 1.324 .263 1.965l2.737 10.035c.5 1.5 2.239 2 5 2s4.5 -.5 5 -2c.1 -.3 .252 -.812 .457 -1.535m.862 -3.146c.262 -.975 .735 -2.76 1.418 -5.354a7.45 7.45 0 0 0 .263 -1.965",key:"svg-1"}],["path",{d:"M3 3l18 18",key:"svg-2"}]]),ed=_("outline","bucket","IconBucket",[["path",{d:"M12 7m-8 0a8 4 0 1 0 16 0a8 4 0 1 0 -16 0",key:"svg-0"}],["path",{d:"M4 7c0 .664 .088 1.324 .263 1.965l2.737 10.035c.5 1.5 2.239 2 5 2s4.5 -.5 5 -2c.333 -1 1.246 -4.345 2.737 -10.035a7.45 7.45 0 0 0 .263 -1.965",key:"svg-1"}]]),lt=_("outline","calendar","IconCalendar",[["path",{d:"M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z",key:"svg-0"}],["path",{d:"M16 3v4",key:"svg-1"}],["path",{d:"M8 3v4",key:"svg-2"}],["path",{d:"M4 11h16",key:"svg-3"}],["path",{d:"M11 15h1",key:"svg-4"}],["path",{d:"M12 15v3",key:"svg-5"}]]),xr=_("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);_("outline","checkbox","IconCheckbox",[["path",{d:"M9 11l3 3l8 -8",key:"svg-0"}],["path",{d:"M20 12v6a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h9",key:"svg-1"}]]);_("outline","chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]);_("outline","chevron-up","IconChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]);_("outline","circle-minus","IconCircleMinus",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 12l6 0",key:"svg-1"}]]);_("outline","circle-plus","IconCirclePlus",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M9 12h6",key:"svg-1"}],["path",{d:"M12 9v6",key:"svg-2"}]]);_("outline","cloud-upload","IconCloudUpload",[["path",{d:"M7 18a4.6 4.4 0 0 1 0 -9a5 4.5 0 0 1 11 2h1a3.5 3.5 0 0 1 0 7h-1",key:"svg-0"}],["path",{d:"M9 15l3 -3l3 3",key:"svg-1"}],["path",{d:"M12 12l0 9",key:"svg-2"}]]);var td=_("outline","columns","IconColumns",[["path",{d:"M4 6l5.5 0",key:"svg-0"}],["path",{d:"M4 10l5.5 0",key:"svg-1"}],["path",{d:"M4 14l5.5 0",key:"svg-2"}],["path",{d:"M4 18l5.5 0",key:"svg-3"}],["path",{d:"M14.5 6l5.5 0",key:"svg-4"}],["path",{d:"M14.5 10l5.5 0",key:"svg-5"}],["path",{d:"M14.5 14l5.5 0",key:"svg-6"}],["path",{d:"M14.5 18l5.5 0",key:"svg-7"}]]),nd=_("outline","copy","IconCopy",[["path",{d:"M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z",key:"svg-0"}],["path",{d:"M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1",key:"svg-1"}]]);_("outline","currency-dollar","IconCurrencyDollar",[["path",{d:"M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2",key:"svg-0"}],["path",{d:"M12 3v3m0 12v3",key:"svg-1"}]]);_("outline","dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]);_("outline","edit","IconEdit",[["path",{d:"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1",key:"svg-0"}],["path",{d:"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z",key:"svg-1"}],["path",{d:"M16 5l3 3",key:"svg-2"}]]);var Qt=_("outline","equal-not","IconEqualNot",[["path",{d:"M5 10h14",key:"svg-0"}],["path",{d:"M5 14h14",key:"svg-1"}],["path",{d:"M5 19l14 -14",key:"svg-2"}]]),Gt=_("outline","equal","IconEqual",[["path",{d:"M5 10h14",key:"svg-0"}],["path",{d:"M5 14h14",key:"svg-1"}]]);_("outline","file-alert","IconFileAlert",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M12 17l.01 0",key:"svg-2"}],["path",{d:"M12 11l0 3",key:"svg-3"}]]);var rd=_("outline","file-plus","IconFilePlus",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M12 11l0 6",key:"svg-2"}],["path",{d:"M9 14l6 0",key:"svg-3"}]]),id=_("outline","filter","IconFilter",[["path",{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z",key:"svg-0"}]]);_("outline","gender-female","IconGenderFemale",[["path",{d:"M12 9m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0",key:"svg-0"}],["path",{d:"M12 14v7",key:"svg-1"}],["path",{d:"M9 18h6",key:"svg-2"}]]);_("outline","gender-male","IconGenderMale",[["path",{d:"M10 14m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0",key:"svg-0"}],["path",{d:"M19 5l-5.4 5.4",key:"svg-1"}],["path",{d:"M19 5h-5",key:"svg-2"}],["path",{d:"M19 5v5",key:"svg-3"}]]);_("outline","logout","IconLogout",[["path",{d:"M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M9 12h12l-3 -3",key:"svg-1"}],["path",{d:"M18 15l3 -3",key:"svg-2"}]]);var Ns=_("outline","math-greater","IconMathGreater",[["path",{d:"M5 18l14 -6l-14 -6",key:"svg-0"}]]),Us=_("outline","math-lower","IconMathLower",[["path",{d:"M19 18l-14 -6l14 -6",key:"svg-0"}]]);_("outline","message","IconMessage",[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z",key:"svg-2"}]]);_("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);var sd=_("outline","refresh","IconRefresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]]);_("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);var xi=_("outline","settings","IconSettings",[["path",{d:"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z",key:"svg-0"}],["path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-1"}]]),vr=_("outline","sort-ascending","IconSortAscending",[["path",{d:"M4 6l7 0",key:"svg-0"}],["path",{d:"M4 12l7 0",key:"svg-1"}],["path",{d:"M4 18l9 0",key:"svg-2"}],["path",{d:"M15 9l3 -3l3 3",key:"svg-3"}],["path",{d:"M18 6l0 12",key:"svg-4"}]]),jr=_("outline","sort-descending","IconSortDescending",[["path",{d:"M4 6l9 0",key:"svg-0"}],["path",{d:"M4 12l7 0",key:"svg-1"}],["path",{d:"M4 18l7 0",key:"svg-2"}],["path",{d:"M15 15l3 3l3 -3",key:"svg-3"}],["path",{d:"M18 6l0 12",key:"svg-4"}]]);_("outline","square","IconSquare",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}]]);_("outline","stethoscope","IconStethoscope",[["path",{d:"M6 4h-1a2 2 0 0 0 -2 2v3.5h0a5.5 5.5 0 0 0 11 0v-3.5a2 2 0 0 0 -2 -2h-1",key:"svg-0"}],["path",{d:"M8 15a6 6 0 1 0 12 0v-3",key:"svg-1"}],["path",{d:"M11 3v2",key:"svg-2"}],["path",{d:"M6 3v2",key:"svg-3"}],["path",{d:"M20 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-4"}]]);_("outline","switch-horizontal","IconSwitchHorizontal",[["path",{d:"M16 3l4 4l-4 4",key:"svg-0"}],["path",{d:"M10 7l10 0",key:"svg-1"}],["path",{d:"M8 13l-4 4l4 4",key:"svg-2"}],["path",{d:"M4 17l9 0",key:"svg-3"}]]);var ad=_("outline","table-export","IconTableExport",[["path",{d:"M12.5 21h-7.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v7.5",key:"svg-0"}],["path",{d:"M3 10h18",key:"svg-1"}],["path",{d:"M10 3v18",key:"svg-2"}],["path",{d:"M16 19h6",key:"svg-3"}],["path",{d:"M19 16l3 3l-3 3",key:"svg-4"}]]),od=_("outline","trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);_("outline","user-square","IconUserSquare",[["path",{d:"M9 10a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-0"}],["path",{d:"M6 21v-1a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v1",key:"svg-1"}],["path",{d:"M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14z",key:"svg-2"}]]);var cd=_("outline","x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]),ld=class extends h.Component{constructor(e){super(e),this.state={lastLocation:window.location.toString()}}static getDerivedStateFromError(e){return{error:e,lastLocation:window.location.toString()}}componentDidUpdate(e,t){window.location.toString()!==this.state.lastLocation&&this.setState({lastLocation:window.location.toString(),error:void 0})}shouldComponentUpdate(e,t){return!!(this.props.children!==e.children||t.error&&!this.state.error||this.state.lastLocation!==window.location.toString())}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){return this.state.error?r.jsx(Ft,{icon:r.jsx(yr,{size:16}),title:"Something went wrong",color:"red",children:be(this.state.error)}):this.props.children}};function Fs(e){var t,n,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=Fs(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function ud(){for(var e,t,n=0,i="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=Fs(e))&&(i&&(i+=" "),i+=t);return i}var xn=ud;function it(e){e.preventDefault(),e.stopPropagation()}function Bs(e){if(vi(e))return!0;if(e instanceof HTMLTableCellElement){let t=e.children;if(t.length===1&&vi(t[0]))return!0}return!1}function vi(e){return e instanceof HTMLInputElement&&e.type==="checkbox"}function vn(e){let t=Lu(),{to:n,suffix:i,label:s,onClick:a,children:o,...c}=e,l=dd(n);return i&&(l+="/"+i),r.jsx(Y,{href:l,"aria-label":s,onClick:u=>{it(u),a?a(u):n&&t(l)},...c,children:o})}function dd(e){if(e){if(typeof e=="string")return hd(e);if(Tt(e))return md(e);if(pt(e))return fd(e)}return"#"}function hd(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:"/"+e}function md(e){return`/${e.resourceType}/${e.id}`}function fd(e){return`/${e.reference}`}function pd(e){let t=e.split(" ").filter(Boolean);return t.length>1?t[0][0]+t[t.length-1][0]:t.length===1?t[0][0]:""}function Ge(e){let t=we(e.value),n=t?Et(t):e.alt??"",i=pd(n),s=(t&&Yo(t))??e.src,a=Os(s??void 0),o=e.radius??"xl",c={...e,value:void 0,link:void 0};return e.link?r.jsx(vn,{to:t,children:r.jsx(en,{src:a,alt:n,radius:o,...c,children:i})}):r.jsx(en,{src:a,alt:n,radius:o,...c,children:i})}function gd(e){let t=e.value;return t?r.jsx(r.Fragment,{children:Vt(t,e.options)}):null}var yd={selectedItems:"selected-items"};function $s(e){let t=zi({onDropdownClose:()=>t.resetSelectedOption(),onDropdownOpen:()=>t.updateSelectedOptionIndex("active")}),{name:n,label:i,description:s,error:a,defaultValue:o,toOption:c,loadOptions:l,itemComponent:u,onChange:d,onCreate:m,creatable:f,clearable:p,required:g,placeholder:x,leftSection:C,maxValues:j,optionsDropdownMaxHeight:w=320,...y}=e,v=y.disabled,A=xd(o),[M,I]=h.useState(""),[N,Q]=h.useState(),[J,K]=h.useState(),[pe,ge]=h.useState(),[X,Be]=h.useState(A.map(c)),[oe,k]=h.useState([]),q=u??vd,ne=h.useRef();ne.current=M;let le=h.useRef(),gt=h.useRef(),yt=h.useRef();yt.current=N;let Dt=h.useRef();Dt.current=J;let Mr=h.useRef();Mr.current=pe;let Ma=h.useRef();Ma.current=oe;let _r=h.useCallback(()=>{if(Q(void 0),ne.current===gt.current&&l===le.current)return;gt.current=ne.current,le.current=l;let H=new AbortController;K(H),l(ne.current??"",H.signal).then(ee=>{H.signal.aborted||(k(ee.map(c)),K(void 0),Mr.current?(ee.length>0&&d(ee.slice(0,1)),ge(!1)):ee.length>0&&t.openDropdown())}).catch(ee=>{H.signal.aborted||ee.message.includes("aborted")||Ne({color:"red",message:be(ee)})})},[t,l,d,c]),Or=h.useCallback(H=>{(oe&&oe.length>0||f)&&t.openDropdown(),t.updateSelectedOptionIndex(),I(H.currentTarget.value),Dt.current&&(Dt.current.abort(),K(void 0)),yt.current!==void 0&&window.clearTimeout(yt.current);let ee=window.setTimeout(()=>_r(),100);Q(ee)},[t,oe,f,_r]),Lr=h.useCallback(H=>{let ee=X.some($e=>$e.value===H),ke=ee?X.filter($e=>$e.value!==H):[...X],At=oe==null?void 0:oe.find($e=>$e.value===H);if(!At&&f!==!1&&m){let $e=m(H);At=c($e)}if(At){if(j===0){d([At.resource]),X.length>0&&Be([]);return}ee||ke.push(At)}if(j!==void 0)for(;ke.length>j;)ke.shift();d(ke.map($e=>$e.resource)),Be(ke)},[f,oe,X,j,d,m,c]),_a=h.useMemo(()=>{if(!v)return H=>{v||(j===1&&(I(""),k([]),t.closeDropdown()),gt.current=void 0,Lr(H==="$create"?M:H))}},[Lr,t,v,j,M]),kn=h.useCallback(H=>{let ee=X.filter(ke=>ke.value!==H.value);d(ee.map(ke=>ke.resource)),Be(ee)},[X,d]),Oa=h.useCallback(H=>{H.key==="Enter"?(N||J)&&ge(!0):H.key==="Backspace"&&M.length===0&&(it(H),kn(X[X.length-1]))},[J,kn,M.length,X,N]);h.useEffect(()=>()=>{Dt.current&&Dt.current.abort()},[]);let La=!v&&p&&X.length>0&&r.jsx(de.ClearButton,{title:"Clear all",size:16,onClear:()=>{I(""),Be([]),d([]),t.closeDropdown()}});return r.jsxs(de,{store:t,onOptionSubmit:_a,withinPortal:!0,shadow:"xl",...y,children:[r.jsx(de.DropdownTarget,{children:r.jsx(Fr,{label:i,description:s,error:a,className:e.className,leftSection:C,rightSection:J?r.jsx(un,{size:16}):La,required:g,disabled:v,children:r.jsxs(Br.Group,{"data-testid":yd.selectedItems,children:[X.map(H=>r.jsx(Br,{withRemoveButton:!v,onRemove:()=>kn(H),children:H.label},H.value)),!v&&(j===void 0||j===0||X.length<j)&&r.jsx(de.EventsTarget,{children:r.jsx(Fr.Field,{role:"searchbox",name:n,value:M,placeholder:x,onFocus:Or,onBlur:()=>{t.closeDropdown(),I("")},onKeyDown:Oa,onChange:Or})})]})})}),r.jsx(de.Dropdown,{children:r.jsx(de.Options,{children:r.jsxs($a,{type:"scroll",mah:w,children:[oe.map(H=>{let ee=X.some(ke=>ke.value===H.value);return r.jsx(de.Option,{value:H.value,active:ee,children:r.jsx(q,{...H,active:ee})},H.value)}),f&&M.trim().length>0&&r.jsxs(de.Option,{value:"$create",children:["+ Create ",M]}),!f&&M.trim().length>0&&oe.length===0&&r.jsx(de.Empty,{children:"Nothing found"})]})})})]})}function xd(e){return e?Array.isArray(e)?e:[e]:[]}function vd(e){return r.jsxs(D,{gap:"xs",children:[e.active&&r.jsx(xr,{size:12}),r.jsx("span",{children:e.label})]})}h.forwardRef(({resource:e,active:t,...n},i)=>{var a;let s;return e.resourceType==="Patient"?s=e.birthDate:e.resourceType==="ServiceRequest"&&(s=(a=e.subject)==null?void 0:a.display),r.jsx("div",{ref:i,...n,children:r.jsxs(D,{wrap:"nowrap",children:[r.jsx(Ge,{value:e}),r.jsxs("div",{children:[r.jsx(T,{children:Et(e)}),r.jsx(T,{size:"xs",c:"dimmed",children:s})]})]})})});function jd(e){let t={};for(let n of Array.from(e.elements))n instanceof HTMLInputElement?bd(t,n):n instanceof HTMLTextAreaElement?t[n.name]=n.value:n instanceof HTMLSelectElement&&Cd(t,n);return t}function bd(e,t){t.disabled||(t.type==="checkbox"||t.type==="radio")&&!t.checked||(e[t.name]=t.value)}function Cd(e,t){e[t.name]=t.value}function Ae(e){return r.jsx("form",{style:e.style,"data-testid":e.testid,onSubmit:t=>{t.preventDefault();let n=jd(t.target);e.onSubmit&&e.onSubmit(n)},children:e.children})}function qs(e){return typeof e.code=="string"?e.code:JSON.stringify(e)}function wd(e){return typeof e.display=="string"?e.display:qs(e)}function Sd(e){return{value:qs(e),label:wd(e),resource:e}}function kd(e){return{code:e,display:e}}function Vs(e){let t=L(),{binding:n,creatable:i,clearable:s,expandParams:a,withHelpText:o,...c}=e,l=h.useCallback(async(u,d)=>{var p;if(!n)return[];let m=(p=(await t.valueSetExpand({...a,url:n,filter:u},{signal:d})).expansion)==null?void 0:p.contains,f=[];for(let g of m)g.code&&!f.some(x=>x.code===g.code)&&f.push(g);return f},[t,a,n]);return r.jsx($s,{...c,creatable:i??!0,clearable:s??!0,toOption:Sd,loadOptions:l,onCreate:kd,itemComponent:o?Ed:void 0})}var Ed=h.forwardRef(({label:e,resource:t,active:n,...i},s)=>r.jsx("div",{ref:s,...i,children:r.jsxs(D,{wrap:"nowrap",gap:"xs",children:[n&&r.jsx(xr,{size:12}),r.jsxs("div",{children:[r.jsx(T,{children:e}),r.jsx(T,{size:"xs",c:"dimmed",children:`${t.system}#${t.code}`})]})]})}));function Td(e){let{defaultValue:t,onChange:n,withHelpText:i,...s}=e,[a,o]=h.useState(t);function c(l){let u=l[0],d=Id(u);o(d),n&&n(d)}return r.jsx(Vs,{defaultValue:Pd(a),onChange:c,withHelpText:i??!0,...s})}function Pd(e){return e?{code:e}:void 0}function Id(e){return e==null?void 0:e.code}function Rd(e){let[t,n]=h.useState(e.defaultValue),i=e.onChange,s=h.useCallback(a=>{n(a),i&&i(a)},[i]);return r.jsx(Td,{disabled:e.disabled,"data-autofocus":e.autoFocus,"data-testid":e.testId,defaultValue:t,onChange:s,name:e.name,placeholder:e.placeholder,binding:"https://medplum.com/fhir/ValueSet/resource-types",creatable:!1,maxValues:e.maxValues??1,clearable:!1,withHelpText:!1})}function br(e){let{contentType:t,url:n,title:i}=e.value??{},s=Os(n);return s?r.jsxs("div",{"data-testid":"attachment-display",children:[(t==null?void 0:t.startsWith("image/"))&&r.jsx("img",{"data-testid":"attachment-image",style:{maxWidth:e.maxWidth},src:s,alt:i}),(t==null?void 0:t.startsWith("video/"))&&r.jsx("video",{"data-testid":"attachment-video",style:{maxWidth:e.maxWidth},controls:!0,children:r.jsx("source",{type:t,src:s})}),((t==null?void 0:t.startsWith("text/"))||t==="application/json"||t==="application/pdf")&&r.jsx("div",{"data-testid":"attachment-iframe",style:{maxWidth:e.maxWidth,minHeight:400},children:r.jsx("iframe",{width:"100%",height:"400",src:s+"#navpanes=0",allowFullScreen:!0,frameBorder:0,seamless:!0})}),r.jsx("div",{"data-testid":"download-link",style:{padding:"2px 16px 16px 16px"},children:r.jsx(Y,{href:n,"data-testid":"attachment-details",target:"_blank",rel:"noopener noreferrer",download:Dd(i),children:i||"Download"})})]}):null}function Dd(e){return e!=null&&e.includes(".")?e:void 0}var ji={root:"DescriptionList_root",compact:"DescriptionList_compact"};function Ad(e){let{children:t,compact:n}=e;return r.jsx("dl",{className:xn(ji.root,{[ji.compact]:n}),children:t})}function an(e){return r.jsxs(r.Fragment,{children:[r.jsx("dt",{children:e.term}),r.jsx("dd",{children:e.children})]})}function Md(e){var i;let t=(i=e.values)==null?void 0:i.map((s,a)=>r.jsx("div",{children:r.jsx(br,{value:s,maxWidth:e.maxWidth})},"attatchment-"+a)),n;if(e.includeDescriptionListEntry){if(e.property===void 0)throw new Error("props.property is required when includeDescriptionListEntry is true");if(!Ye(e.path))throw new Error("props.path is required when includeDescriptionListEntry is true");let s=e.path.split(".").pop();n=r.jsx(an,{term:nn(s),children:t})}else n=r.jsx(r.Fragment,{children:t});return n}function _d(e){let t=L(),n=h.useRef(null);function i(o){var c;it(o),(c=n.current)==null||c.click()}function s(o){it(o);let c=o.target.files;c&&Array.from(c).forEach(a)}function a(o){!o||!o.name||(e.onUploadStart&&e.onUploadStart(),t.createAttachment({data:o,contentType:o.type||"application/octet-stream",filename:o.name,securityContext:e.securityContext,onProgress:e.onUploadProgress}).then(c=>e.onUpload(c)).catch(c=>{e.onUploadError&&e.onUploadError(he(c))}))}return r.jsxs(r.Fragment,{children:[r.jsx("input",{disabled:e.disabled,type:"file","data-testid":"upload-file-input",style:{display:"none"},ref:n,onChange:o=>s(o)}),e.children({onClick:i,disabled:e.disabled})]})}function Od(e){let[t,n]=h.useState(e.defaultValue);function i(s){n(s),e.onChange&&e.onChange(s)}return t?r.jsxs(r.Fragment,{children:[r.jsx(br,{value:t,maxWidth:200}),r.jsx(O,{disabled:e.disabled,onClick:s=>{it(s),i(void 0)},children:"Remove"})]}):r.jsx(_d,{disabled:e.disabled,securityContext:e.securityContext,onUpload:i,children:s=>r.jsx(O,{...s,children:"Upload..."})})}function Ut(e){return r.jsx(r.Fragment,{children:wt(e.value)})}function Ld(e){return r.jsx(r.Fragment,{children:at(e.value)})}function zs(e){let t=e.value;if(!t)return null;let n=[];return t.value&&n.push(t.value),(t.use||t.system)&&(n.push(" ["),t.use&&n.push(t.use),t.use&&t.system&&n.push(" "),t.system&&n.push(t.system),n.push("]")),r.jsx(r.Fragment,{children:n.join("").trim()})}function Nd(e){var n;let t=e.value;return t?r.jsxs(r.Fragment,{children:[t.name,t.name&&": ",(n=t.telecom)==null?void 0:n.map(i=>r.jsx(zs,{value:i},`telecom-${t.name}-${i.value}`))]}):null}function Ud(e){var t,n;return r.jsxs("div",{children:[(t=e.value)==null?void 0:t.system,": ",(n=e.value)==null?void 0:n.value]})}function Fd(e){return r.jsx(r.Fragment,{children:Cc(e.value)})}function on(e){return r.jsx(r.Fragment,{children:Xe(e.value)})}function Cr(e){return r.jsx(r.Fragment,{children:bc(e.value)})}function Bd(e){let t=e.value;return t?r.jsxs(r.Fragment,{children:[r.jsx(on,{value:t.numerator}),"/",r.jsx(on,{value:t.denominator})]}):null}function Bn(e){if(!e.value)return null;let t=e.value.display||e.value.reference||rt(e.value);return e.link!==!1&&e.value.reference?r.jsx(vn,{to:e.value,children:t}):r.jsx(r.Fragment,{children:t})}function $d(e,t,n,i){if(!Ye(n==null?void 0:n.slices))return[e];let s=new Array(t.length+1);for(let a=0;a<s.length;a++)s[a]=[];for(let a of e){let o=Eu(a,t,n.discriminator,i),c=o?t.findIndex(l=>l.name===o):-1;c===-1&&(c=t.length),s[c].push(a)}return s}async function qd({medplum:e,property:t}){return new Promise((n,i)=>{var c,l;if(!t.slicing){n([]);return}let s=[],a=[],o=[];for(let u of t.slicing.slices){if(!Su(u)){console.debug("Unsupported slice definition",u);continue}let d;Ye(u.elements)||(d=(l=(c=u.type[0])==null?void 0:c.profile)==null?void 0:l[0]),s.push(u),a.push(d),d?o.push(e.requestProfileSchema(d)):o.push(Promise.resolve([]))}Promise.all(o).then(()=>{for(let u=0;u<s.length;u++){let d=s[u],m=a[u];if(m){let f=hn(m);d.typeSchema=f}}n(s)}).catch(i)})}function Hs(e,t,n){return t!==void 0?r.jsx(e,{value:t,children:n}):n}function Vd(e){var o,c;let{slice:t,property:n}=e,i=((o=t.typeSchema)==null?void 0:o.elements)??t.elements,s=h.useContext(Re),a=h.useMemo(()=>{var l;if(Ye(i))return Ps({parentContext:s,elements:i,path:e.path,profileUrl:(l=t.typeSchema)==null?void 0:l.url})},[s,e.path,(c=t.typeSchema)==null?void 0:c.url,i]);return Hs(Re.Provider,a,r.jsx(r.Fragment,{children:e.value.map((l,u)=>r.jsx("div",{children:r.jsx(ot,{property:n,path:e.path,arrayElement:!0,elementDefinitionType:t.type[0],propertyType:t.type[0].code,value:l,ignoreMissingValues:e.ignoreMissingValues,link:e.link})},`${u}-${e.value.length}`))}))}function zd(e){var p;let{property:t,propertyType:n}=e,i=L(),s=h.useMemo(()=>Array.isArray(e.values)?e.values:[],[e.values]),[a,o]=h.useState(!0),[c,l]=h.useState([]),[u,d]=h.useState(()=>[s]),m=h.useContext(Re);if(h.useEffect(()=>{qd({medplum:i,property:t}).then(g=>{l(g);let x=$d(s,g,t.slicing,m.profileUrl);d(x),o(!1)}).catch(g=>{console.error(g),o(!1)})},[i,t,m.profileUrl,d,s]),a)return r.jsx("div",{children:"Loading..."});let f;if(((p=t.type[0])==null?void 0:p.code)!=="Extension"){let g=u[c.length],x=g.map((C,j)=>r.jsx("div",{children:r.jsx(ot,{path:e.path,arrayElement:!0,property:t,propertyType:n,value:C,ignoreMissingValues:e.ignoreMissingValues,link:e.link})},`${j}-${g.length}`));if(e.includeDescriptionListEntry){if(!Ye(e.path))throw new Error("props.path is required when includeDescriptionListEntry is true");let C=e.path.split(".").pop();f=r.jsx(an,{term:nn(C),children:x})}else f=r.jsx(r.Fragment,{children:x})}return r.jsxs(r.Fragment,{children:[c.map((g,x)=>{if(!e.path)throw Error(`Displaying a resource property with slices of type ${e.propertyType} requires path`);let C=r.jsx(Vd,{path:e.path,slice:g,property:t,value:u[x],ignoreMissingValues:e.ignoreMissingValues,link:e.link},g.name);return e.includeDescriptionListEntry&&(C=r.jsx(an,{term:nn(g.name),children:C},g.name)),C}),f]})}function wr(e,t,n){let i=ie(e,t,{profileUrl:n});return i?Array.isArray(i)?[i.map(s=>s.value),i[0].type]:[i.value,i.type]:[void 0,"undefined"]}function Hd(e){var u;let{elementDefinitionType:t}=e,n=L(),i=h.useContext(Re),[s,a]=h.useState(as("Extension")),o=h.useMemo(()=>{if(Ye(t==null?void 0:t.profile))return t.profile[0]},[t]),[c,l]=h.useState(o!==void 0);if(h.useEffect(()=>{o&&(l(!0),n.requestProfileSchema(o).then(()=>{let d=hn(o);l(!1),d&&a(d)}).catch(d=>{l(!1),console.warn(d)}))},[n,o]),o&&(c||!os(o)))return r.jsx("div",{children:"Loading..."});if(((u=s.elements["value[x]"])==null?void 0:u.max)!==0){let[d,m]=wr({type:"Extension",value:e.value},"value[x]",o??i.profileUrl);return r.jsx(ot,{propertyType:m,value:d})}return r.jsx(cn,{path:e.path,value:{type:s.name,value:e.value},compact:e.compact,ignoreMissingValues:e.ignoreMissingValues,link:e.link,profileUrl:o})}function ot(e){var s;let{property:t,propertyType:n,value:i}=e;if((s=t==null?void 0:t.path)!=null&&s.endsWith(".id"))return r.jsxs(B,{component:"div",style:{display:"flex",gap:3,alignItems:"center"},children:[i,!re(i)&&r.jsx(Ua,{value:i,timeout:2e3,children:({copied:a,copy:o})=>r.jsx($i,{label:a?"Copied":"Copy",withArrow:!0,position:"right",children:r.jsx($n,{variant:"subtle",color:a?"teal":"gray",onClick:o,children:a?r.jsx(xr,{size:"1rem"}):r.jsx(nd,{size:"1rem"})})})})]});if(t&&(t.isArray||t.max>1)&&!e.arrayElement)return n===b.Attachment?r.jsx(Md,{values:i,maxWidth:e.maxWidth,includeDescriptionListEntry:e.includeArrayDescriptionListEntry,property:t,path:e.path}):r.jsx(zd,{path:e.path,property:t,propertyType:n,values:i,includeDescriptionListEntry:e.includeArrayDescriptionListEntry,ignoreMissingValues:e.ignoreMissingValues,link:e.link});switch(n){case b.boolean:return r.jsx(r.Fragment,{children:i===void 0?"":(!!i).toString()});case b.SystemString:case b.string:return r.jsx("div",{style:{whiteSpace:"pre-wrap"},children:i});case b.code:case b.date:case b.decimal:case b.id:case b.integer:case b.positiveInt:case b.unsignedInt:case b.uri:case b.url:return r.jsx(r.Fragment,{children:i});case b.canonical:return r.jsx(Bn,{value:{reference:i},link:e.link});case b.dateTime:case b.instant:return r.jsx(r.Fragment,{children:Ce(i)});case b.markdown:return r.jsx("pre",{children:i});case b.Address:return r.jsx(qu,{value:i});case b.Annotation:return r.jsx(r.Fragment,{children:i==null?void 0:i.text});case b.Attachment:return r.jsx(br,{value:i,maxWidth:e.maxWidth});case b.CodeableConcept:return r.jsx(Ut,{value:i});case b.Coding:return r.jsx(Ld,{value:i});case b.ContactDetail:return r.jsx(Nd,{value:i});case b.ContactPoint:return r.jsx(zs,{value:i});case b.HumanName:return r.jsx(gd,{value:i});case b.Identifier:return r.jsx(Ud,{value:i});case b.Money:return r.jsx(Fd,{value:i});case b.Period:return r.jsx(r.Fragment,{children:gc(i)});case b.Quantity:case b.Duration:return r.jsx(on,{value:i});case b.Range:return r.jsx(Cr,{value:i});case b.Ratio:return r.jsx(Bd,{value:i});case b.Reference:return r.jsx(Bn,{value:i,link:e.link});case b.Timing:return r.jsx(r.Fragment,{children:gs(i)});case b.Dosage:case b.UsageContext:if(!e.path)throw Error(`Displaying property of type ${e.propertyType} requires path`);return r.jsx(cn,{path:e.path,value:{type:n,value:i},compact:!0,ignoreMissingValues:e.ignoreMissingValues});case b.Extension:if(!e.path)throw Error(`Displaying property of type ${e.propertyType} requires path`);return r.jsx(Hd,{path:e.path,value:i,compact:!0,ignoreMissingValues:e.ignoreMissingValues,elementDefinitionType:e.elementDefinitionType});default:if(!t)throw Error(`Displaying property of type ${e.propertyType} requires element schema`);if(!e.path)throw Error(`Displaying property of type ${e.propertyType} requires path`);return r.jsx(cn,{path:e.path,value:{type:t.type[0].code,value:i},compact:!0,ignoreMissingValues:e.ignoreMissingValues})}}var Ws=["extension","modifierExtension"],Wd=Vu.filter(e=>!Ws.includes(e));function cn(e){let t=e.value,{value:n,type:i}=t,s=h.useContext(Re),a=e.profileUrl??(s==null?void 0:s.profileUrl),o=h.useMemo(()=>Gn(i,a),[a,i]),c=h.useMemo(()=>{if(o)return Ps({parentContext:s,elements:o.elements,path:e.path,profileUrl:o.url,accessPolicyResource:e.accessPolicyResource})},[o,s,e.path,e.accessPolicyResource]);if(re(n))return null;if(!o)return r.jsxs("div",{children:[i,"not implemented"]});if(typeof n=="object"&&"name"in n&&Object.keys(n).length===1&&typeof n.name=="string")return r.jsx("div",{children:n.name});let l=c??s;return Hs(Re.Provider,c,r.jsx(Ad,{compact:e.compact,children:Object.entries(l.elements).map(([u,d])=>{var x;if(Ws.includes(u)&&re((x=d.slicing)==null?void 0:x.slices)||Wd.includes(u)||zu.includes(u)&&d.path.split(".").length===2||u.includes("."))return null;let[m,f]=wr(t,u,l.profileUrl);if((e.ignoreMissingValues||d.max===0)&&re(m)||e.path.endsWith(".extension")&&(u==="url"||u==="id"))return null;let p=d.max>1||d.isArray,g=r.jsx(ot,{property:d,propertyType:f,path:e.path+"."+u,value:m,ignoreMissingValues:e.ignoreMissingValues,includeArrayDescriptionListEntry:p,link:e.link},u);return p?g:r.jsx(an,{term:nn(u),children:g},u)})}))}var Qs="Read Only";function Gs(e,t){return e?r.jsx($i.Floating,{label:e,children:t}):t}var Js={dimmed:"FormSection_dimmed"};function Qd(e){let{debugMode:t}=h.useContext(Re),n;return t&&e.fhirPath?n=`${e.title} - ${e.fhirPath}`:n=e.title,Gs(e!=null&&e.readonly?Qs:void 0,r.jsxs(D,{wrap:"nowrap","data-testid":e.testId,children:[r.jsx("div",{children:e.children}),r.jsx("div",{children:r.jsx(Qi.Wrapper,{id:e.htmlFor,label:n,classNames:{label:e!=null&&e.readonly?Js.dimmed:void 0},description:e.description,withAsterisk:e.withAsterisk,children:null})})]}))}function He(e,t){var n,i,s;return(s=(i=(n=e==null?void 0:e.issue)==null?void 0:n.filter(a=>{var o;return Ys((o=a.expression)==null?void 0:o[0],t)}))==null?void 0:i.map(a=>{var o;return(o=a.details)==null?void 0:o.text}))==null?void 0:s.join(`
`)}function Sr(e,t){var n;return(n=e==null?void 0:e.issue)==null?void 0:n.filter(i=>{var s;return Ys((s=i.expression)==null?void 0:s[0],t)})}var Zt=/\[\d+\]/;function Ys(e,t){let n=typeof e=="string"&&Zt.test(e),i=typeof t=="string"&&Zt.test(t);if(n!==i&&(e=e==null?void 0:e.replace(Zt,""),t=t==null?void 0:t.replace(Zt,"")),e===t)return!0;if(!e||!t)return!1;let s=e.indexOf(".");if(s>=0&&e.substring(s+1)===t)return!0;let a=t.indexOf(".");return a>=0&&t.substring(a+1)===e}function Gd(e){let{debugMode:t}=h.useContext(Re),n;return t&&e.fhirPath?n=`${e.title} - ${e.fhirPath}`:n=e.title,Gs(e!=null&&e.readonly?Qs:void 0,r.jsx(Qi.Wrapper,{id:e.htmlFor,label:n,classNames:{label:e!=null&&e.readonly?Js.dimmed:void 0},description:e.description,withAsterisk:e.withAsterisk,error:He(e.outcome,e.errorExpression??e.htmlFor),"data-testid":e.testId,children:e.children}))}function Jd(e){let{defaultValue:t,onChange:n,withHelpText:i,...s}=e,[a,o]=h.useState(t);function c(l){let u=l[0],d=u&&Zd(u);o(d),n&&n(d)}return r.jsx(Vs,{defaultValue:a&&Yd(a),maxValues:1,onChange:c,withHelpText:i??!0,...s})}function Yd(e){return{system:e.system,code:e.code,display:e.display}}function Zd(e){return{system:e.system,code:e.code,display:e.display}}function Kd(e){if(!e)return"";let t=new Date(e);return zt(t)?t.toLocaleDateString("sv")+"T"+t.toLocaleTimeString("sv"):""}function Xd(e){if(!e)return"";let t=new Date(e);return zt(t)?t.toISOString():""}function Zs(e){return r.jsx(W,{id:e.name,name:e.name,label:e.label,"data-autofocus":e.autoFocus,"data-testid":e["data-testid"]??e.name,placeholder:e.placeholder,required:e.required,disabled:e.disabled,type:eh(),defaultValue:Kd(e.defaultValue),autoFocus:e.autoFocus,error:He(e.outcome,e.name),onChange:t=>{if(e.onChange){let n=t.currentTarget.value;e.onChange(Xd(n))}}})}function eh(){return"datetime-local"}function Ks(e){let[t,n]=h.useState(e.defaultValue),{getExtendedProps:i}=h.useContext(Re),[s,a,o]=h.useMemo(()=>["comparator","value","unit"].map(l=>i(e.path+"."+l)),[i,e.path]);function c(l){n(l),e.onChange&&e.onChange(l)}return r.jsxs(D,{gap:"xs",grow:!0,wrap:"nowrap",children:[r.jsx(tt,{disabled:e.disabled||(s==null?void 0:s.readonly),style:{width:80},"data-testid":e.name+"-comparator",defaultValue:t==null?void 0:t.comparator,data:["","<","<=",">=",">"],onChange:l=>c({...t,comparator:l.currentTarget.value})}),r.jsx(W,{disabled:e.disabled||(a==null?void 0:a.readonly),id:e.name,name:e.name,required:e.required,"data-autofocus":e.autoFocus,"data-testid":e.name+"-value",type:"number",placeholder:"Value",defaultValue:t==null?void 0:t.value,autoFocus:e.autoFocus,step:"any",onWheel:l=>{e.disableWheel&&l.currentTarget.blur()},onChange:l=>{c({...t,value:th(l.currentTarget.value)})}}),r.jsx(W,{disabled:e.disabled||(o==null?void 0:o.readonly),placeholder:"Unit","data-testid":e.name+"-unit",defaultValue:t==null?void 0:t.unit,onChange:l=>c({...t,unit:l.currentTarget.value})})]})}function th(e){if(e)return parseFloat(e)}var nh={Device:"device-name",Observation:"code",Subscription:"criteria",User:"email:contains"},rh=["AccessPolicy","Account","ActivityDefinition","Bot","CapabilityStatement","CareTeam","ClientApplication","CodeSystem","CompartmentDefinition","ConceptMap","EffectEvidenceSynthesis","Endpoint","EventDefinition","Evidence","EvidenceVariable","ExampleScenario","GraphDefinition","Group","HealthcareService","ImplementationGuide","InsurancePlan","Library","Location","Measure","MedicinalProduct","MessageDefinition","NamingSystem","OperationDefinition","Organization","Patient","Person","PlanDefinition","Practitioner","Project","Questionnaire","RelatedPerson","ResearchDefinition","ResearchElementDefinition","RiskEvidenceSynthesis","SearchParameter","StructureDefinition","StructureMap","TerminologyCapabilities","TestScript","UserConfiguration","ValueSet"];function ih(e){return{value:Z(e),label:Et(e),resource:e}}function sh(e){let t=L(),{resourceType:n,searchCriteria:i}=e,[s,a]=h.useState(),o=we(e.defaultValue,a),c=e.onChange,l=h.useCallback(async(d,m)=>{let f=oh(n),p=new URLSearchParams({[f]:d??"",_count:"10",...i});return await t.searchResources(n,p,{signal:m})},[t,n,i]),u=h.useCallback(d=>{c&&c(d[0])},[c]);return Ye(e.defaultValue)&&!s&&!o?null:r.jsx($s,{disabled:e.disabled,name:e.name,required:e.required,itemComponent:ah,defaultValue:o,placeholder:e.placeholder,maxValues:1,toOption:ih,loadOptions:l,onChange:u,clearable:!0})}var ah=h.forwardRef(({label:e,resource:t,active:n,...i},s)=>r.jsx("div",{ref:s,...i,children:r.jsxs(D,{wrap:"nowrap",children:[r.jsx(Ge,{value:t}),r.jsxs("div",{children:[r.jsx(T,{children:e}),r.jsx(T,{size:"xs",c:"dimmed",children:t.birthDate||t.id})]})]})}));function oh(e){return nh[e]??(rh.includes(e)?"name":"_id")}function Xs(e){let{onChange:t}=e,n=L(),[i,s]=h.useState(e.defaultValue),[a,o]=h.useState(()=>ch(e.targetTypes)),[c,l]=h.useState(()=>lh(e.defaultValue,a)),u=h.useRef(new Ss),d=h.useMemo(()=>(c==null?void 0:c.type)==="profile"?{...e.searchCriteria,_profile:c.value}:e.searchCriteria,[e.searchCriteria,c]);h.useEffect(()=>{let p=!1,g=a==null?void 0:a.map(x=>{if(!dh(x))return Promise.resolve(x);p=!0;let C=x.value,j=u.current.get(C);if(j)return j;let w=uh(n,x.value).then(v=>{let A={...x};return v?Ye(v.type)?(A.resourceType=v.type,A.name=v.name,A.title=v.title):(console.error(`StructureDefinition.type missing for ${x.value}`),A.error="StructureDefinition.type missing"):(console.error(`StructureDefinition not found for ${x.value}`),A.error="StructureDefinition not found"),A}).catch(v=>(console.error(v),{...x,error:v})),y=new Te(w);return u.current.set(C,y),y});!g||!p||Promise.all(g).then(x=>{if(o(x),!c)return;let C=x.findIndex(j=>j.value===c.value||j.resourceType===c.resourceType);if(C===-1){console.debug(`defaultValue had unexpected resourceType: ${c.resourceType}`);return}l(x[C])}).catch(console.error)},[n,c,a]);let m=h.useCallback(p=>{let g=p?Le(p):void 0;s(g),t&&t(g)},[t]),f=h.useMemo(()=>a?a.map(p=>({value:p.value,label:p.type==="profile"?p.title??p.name??p.resourceType??p.value:p.value})):[],[a]);return r.jsxs(D,{gap:"xs",grow:!0,wrap:"nowrap",children:[a&&a.length>1&&r.jsx(tt,{disabled:e.disabled,"data-autofocus":e.autoFocus,"data-testid":"reference-input-resource-type-select",defaultValue:c==null?void 0:c.resourceType,autoFocus:e.autoFocus,onChange:p=>{let g=p.currentTarget.value,x=a.find(C=>C.value===g);l(x)},data:f}),!a&&r.jsx(Rd,{disabled:e.disabled,autoFocus:e.autoFocus,testId:"reference-input-resource-type-input",defaultValue:c==null?void 0:c.resourceType,onChange:p=>{l(p?{type:"resourceType",value:p,resourceType:p}:void 0)},name:e.name+"-resourceType",placeholder:"Resource Type"}),r.jsx(sh,{resourceType:c==null?void 0:c.resourceType,name:e.name+"-id",required:e.required,placeholder:e.placeholder,defaultValue:i,searchCriteria:d,onChange:m,disabled:e.disabled})]})}function ch(e){if(!e||e.length===0||e.length===1&&e[0]==="Resource")return;let t=[];for(let n of e)n.includes("/")?t.push({type:"profile",value:n}):t.push({type:"resourceType",value:n,resourceType:n});return t}function lh(e,t){var i;let n=(i=e==null?void 0:e.reference)==null?void 0:i.split("/")[0];if(n)return(t==null?void 0:t.find(a=>a.resourceType===n))||{type:"resourceType",value:n,resourceType:n};if(t&&t.length>0)return t[0]}async function uh(e,t){let n=hn(t);if(n)return{type:n.type,name:n.name,title:n.title};let i=`{
      StructureDefinitionList(url: "${t}", _sort: "_lastUpdated", _count: 1) {
        type,
        name,
        title,
      }
    }`.replace(/\s+/g," ");return(await e.graphql(i)).data.StructureDefinitionList[0]}function dh(e){return e.type==="profile"&&!(e!=null&&e.error)&&re(e.resourceType)}var hh={table:"CalendarInput_table"};function mh(e){return e.toLocaleString("default",{month:"long"})+" "+e.getFullYear()}function ea(){let e=new Date;return e.setDate(1),e.setHours(0,0,0,0),e}function fh(e){let{onChangeMonth:t,onClick:n}=e,[i,s]=h.useState(ea);function a(c){s(l=>{let u=new Date(l.getTime());return u.setMonth(l.getMonth()+c),t(u),u})}let o=h.useMemo(()=>ph(i,e.slots),[i,e.slots]);return r.jsxs("div",{children:[r.jsxs(D,{justify:"space-between",gap:"xs",grow:!0,wrap:"nowrap",children:[r.jsx("p",{style:{flex:1},children:mh(i)}),r.jsxs(D,{justify:"flex-end",gap:"xs",children:[r.jsx(O,{variant:"outline","aria-label":"Previous month",onClick:()=>a(-1),children:"<"}),r.jsx(O,{variant:"outline","aria-label":"Next month",onClick:()=>a(1),children:">"})]})]}),r.jsxs("table",{className:hh.table,children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"SUN"}),r.jsx("th",{children:"MON"}),r.jsx("th",{children:"TUE"}),r.jsx("th",{children:"WED"}),r.jsx("th",{children:"THU"}),r.jsx("th",{children:"FRI"}),r.jsx("th",{children:"SAT"})]})}),r.jsx("tbody",{children:o.map((c,l)=>r.jsx("tr",{children:c.map((u,d)=>r.jsx("td",{children:u&&r.jsx(O,{variant:"light",disabled:!u.available,onClick:()=>n(u.date),children:u.date.getDate()})},"day-"+d))},"week-"+l))})]})]})}function ph(e,t){let n=new Date(e.getFullYear(),e.getMonth()),i=[],s=[];for(let a=0;a<n.getDay();a++)s.push(void 0);for(;n.getMonth()===e.getMonth();)s.push({date:new Date(n.getTime()),available:gh(n,t)}),n.getDay()===6&&(i.push(s),s=[]),n.setDate(n.getDate()+1);if(n.getDay()!==0){for(let a=n.getDay();a<7;a++)s.push(void 0);i.push(s)}return i}function gh(e,t){for(let n of t){let i=new Date(n.start);if(i.getFullYear()===e.getFullYear()&&i.getMonth()===e.getMonth()&&i.getDate()===e.getDate())return!0}return!1}var yh={root:"Container_root"};function ta(e){let{children:t,...n}=e;return r.jsx(se,{className:yh.root,...n,children:t})}var bi={noteBody:"NoteDisplay_noteBody",noteCite:"NoteDisplay_noteCite",noteRoot:"NoteDisplay_noteRoot"};function na({value:e}){return e?r.jsx(F,{justify:"flex-start",gap:"xs",children:e.map(t=>{var n;return t.text&&r.jsx(Ba,{classNames:{cite:bi.noteCite,root:bi.noteRoot},cite:((n=t.authorReference)==null?void 0:n.display)||t.authorString,icon:null,children:t.text},`note-${t.text}`)})}):null}function jn(e){let{value:t,link:n,...i}=e,[s,a]=h.useState(),o=we(t,a),c;if(s&&!es(s))c=`[${be(s)}]`;else if(o)c=Et(o);else return null;return n?r.jsx(vn,{to:t,...i,children:c}):r.jsx(T,{component:"span",...i,children:c})}function In(e){return r.jsxs(D,{gap:"xs",children:[r.jsx(Ge,{size:24,radius:12,value:e.value,link:e.link}),r.jsx(jn,{value:e.value,link:e.link})]})}var xh={draft:"blue",active:"blue","on-hold":"yellow",revoked:"red",completed:"green","entered-in-error":"red",unknown:"gray",retired:"gray",registered:"blue",preliminary:"blue",final:"green",amended:"yellow",corrected:"yellow",cancelled:"red",requested:"blue",received:"blue",accepted:"blue",rejected:"red",ready:"blue","in-progress":"blue",failed:"red",proposed:"blue",pending:"blue",booked:"blue",arrived:"blue",fulfilled:"green",noshow:"red","checked-in":"blue",waitlist:"gray",routine:"gray",urgent:"red",asap:"red",stat:"red","not-done":"red",connected:"green",disconnected:"red"};function kr(e){return r.jsx(qi,{color:xh[e.status],children:e.status})}var ra={table:"DiagnosticReportDisplay_table",criticalRow:"DiagnosticReportDisplay_criticalRow",noteBody:"DiagnosticReportDisplay_noteBody",noteCite:"DiagnosticReportDisplay_noteCite",noteRoot:"DiagnosticReportDisplay_noteRoot"};ia.defaultProps={hideObservationNotes:!1,hideSpecimenInfo:!1};function ia(e){var o;let t=L(),n=we(e.value),[i,s]=h.useState();if(h.useEffect(()=>{n!=null&&n.specimen&&Promise.allSettled(n.specimen.map(c=>t.readReference(c))).then(c=>c.filter(l=>l.status==="fulfilled").map(l=>l.value)).then(s).catch(console.error)},[t,n]),!n)return null;let a=(i==null?void 0:i.flatMap(c=>c.note||[]))||[];if(n.presentedForm&&n.presentedForm.length>0){let c=n.presentedForm[0];(o=c.contentType)!=null&&o.startsWith("text/plain")&&c.data&&a.push({text:window.atob(c.data)})}return r.jsxs(F,{children:[r.jsx($,{children:"Diagnostic Report"}),r.jsx(vh,{value:n}),i&&!e.hideSpecimenInfo&&jh(i),n.result&&r.jsx(bh,{hideObservationNotes:e.hideObservationNotes,value:n.result}),a.length>0&&r.jsx(na,{value:a})]})}function vh({value:e}){var t,n;return r.jsxs(D,{mt:"md",gap:30,children:[e.subject&&r.jsxs("div",{children:[r.jsx(T,{size:"xs",tt:"uppercase",c:"dimmed",children:"Subject"}),r.jsx(In,{value:e.subject,link:!0})]}),(t=e.resultsInterpreter)==null?void 0:t.map(i=>r.jsxs("div",{children:[r.jsx(T,{size:"xs",tt:"uppercase",c:"dimmed",children:"Interpreter"}),r.jsx(In,{value:i,link:!0})]},i.reference)),(n=e.performer)==null?void 0:n.map(i=>r.jsxs("div",{children:[r.jsx(T,{size:"xs",tt:"uppercase",c:"dimmed",children:"Performer"}),r.jsx(In,{value:i,link:!0})]},i.reference)),e.issued&&r.jsxs("div",{children:[r.jsx(T,{size:"xs",tt:"uppercase",c:"dimmed",children:"Issued"}),r.jsx(T,{children:Ce(e.issued)})]}),e.status&&r.jsxs("div",{children:[r.jsx(T,{size:"xs",tt:"uppercase",c:"dimmed",children:"Status"}),r.jsx(T,{children:De(e.status)})]})]})}function jh(e){return r.jsxs(F,{gap:"xs",children:[r.jsx($,{order:2,size:"h6",children:"Specimens"}),r.jsx(Nr,{type:"ordered",children:e==null?void 0:e.map(t=>{var n;return r.jsx(Nr.Item,{ml:"sm",children:r.jsxs(D,{gap:20,children:[r.jsxs(D,{gap:5,children:[r.jsx(T,{fw:500,children:"Collected:"})," ",Ce((n=t.collection)==null?void 0:n.collectedDateTime)]}),r.jsxs(D,{gap:5,children:[r.jsx(T,{fw:500,children:"Received:"})," ",Ce(t.receivedTime)]})]})},`specimen-${t.id}`)})})]})}function bh(e){return r.jsxs("table",{className:ra.table,children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"Test"}),r.jsx("th",{children:"Value"}),r.jsx("th",{children:"Reference Range"}),r.jsx("th",{children:"Interpretation"}),r.jsx("th",{children:"Category"}),r.jsx("th",{children:"Performer"}),r.jsx("th",{children:"Status"})]})}),r.jsx("tbody",{children:r.jsx(sa,{value:e.value,ancestorIds:e.ancestorIds,hideObservationNotes:e.hideObservationNotes})})]})}function sa(e){var t;return r.jsx(r.Fragment,{children:(t=e.value)==null?void 0:t.map(n=>r.jsx(Ch,{value:n,ancestorIds:e.ancestorIds,hideObservationNotes:e.hideObservationNotes},`obs-${pt(n)?n.reference:n.id}`))})}function Ch(e){var s,a;let t=we(e.value);if(!t||(s=e.ancestorIds)!=null&&s.includes(t.id))return null;let n=!e.hideObservationNotes&&t.note,i=kh(t);return r.jsxs(r.Fragment,{children:[r.jsxs("tr",{className:xn({[ra.criticalRow]:i}),children:[r.jsx("td",{rowSpan:n?2:1,children:r.jsx(vn,{to:t,children:r.jsx(Ut,{value:t.code})})}),r.jsx("td",{children:r.jsx(wh,{value:t})}),r.jsx("td",{children:r.jsx(Sh,{value:t.referenceRange})}),r.jsx("td",{children:t.interpretation&&t.interpretation.length>0&&r.jsx(Ut,{value:t.interpretation[0]})}),r.jsx("td",{children:t.category&&t.category.length>0&&r.jsx(r.Fragment,{children:t.category.map(o=>r.jsx("div",{children:r.jsx(Ut,{value:o})},`category-${wt(o)}`))})}),r.jsx("td",{children:(a=t.performer)==null?void 0:a.map(o=>r.jsx(Bn,{value:o},o.reference))}),r.jsx("td",{children:t.status&&r.jsx(kr,{status:t.status})})]}),t.hasMember&&r.jsx(sa,{value:t.hasMember,ancestorIds:e.ancestorIds?[...e.ancestorIds,t.id]:[t.id],hideObservationNotes:e.hideObservationNotes}),n&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,children:r.jsx(na,{value:t.note})})})]})}function wh(e){let t=e.value;return r.jsx(r.Fragment,{children:mn(t)})}function Sh(e){let t=e.value&&e.value.length>0&&e.value[0];return t?t.text?r.jsx(r.Fragment,{children:t.text}):r.jsx(Cr,{value:t}):null}function kh(e){var n,i,s,a;let t=(a=(s=(i=(n=e.interpretation)==null?void 0:n[0])==null?void 0:i.coding)==null?void 0:s[0])==null?void 0:a.code;return t==="AA"||t==="LL"||t==="HH"||t==="A"}var Ci={paper:"Panel_paper",fill:"Panel_fill"};function Eh(e){let{width:t,fill:n,className:i,children:s,...a}=e,o=t?{maxWidth:t}:void 0;return r.jsx(qn,{className:xn(Ci.paper,n&&Ci.fill,i),style:o,shadow:"sm",radius:"sm",withBorder:!0,...a,children:s})}Mu(Ou());function bn(e){let{profileUrl:t}=e,n=L(),i=n.getAccessPolicy(),s=we(e.value),[a,o]=h.useState();h.useEffect(()=>{if(s)if(t)n.requestProfileSchema(t,{expandProfile:!0}).then(()=>{let l=hn(t);l?o(l.name):console.error(`Schema not found for ${t}`)}).catch(l=>{console.error("Error in requestProfileSchema",l)});else{let l=s.resourceType;n.requestSchema(l).then(()=>{o(l)}).catch(console.error)}},[n,t,s]);let c=h.useMemo(()=>s&&Ol(s,ws.READ,i),[i,s]);return!a||!s?null:r.jsx(cn,{path:s.resourceType,value:{type:a,value:e.forceUseInput?e.value:s},profileUrl:t,ignoreMissingValues:e.ignoreMissingValues,accessPolicyResource:c})}function Ze(e){let{children:t,...n}=e;return r.jsx(ta,{children:r.jsx(Eh,{...n,children:t})})}function Th(e){let t;try{t=Pt(e.path,e.resource)}catch(n){return console.warn("FhirPathDisplay:",n),null}if(t.length>1)throw new Error(`Component "path" for "FhirPathDisplay" must resolve to a single element.        Received ${t.length} elements        [${JSON.stringify(t,null,2)}]`);return r.jsx(ot,{value:t[0]||"",propertyType:e.propertyType})}function Ph(e){return r.jsxs(kt,{title:"Export",closeButtonProps:{"aria-label":"Close"},opened:e.visible,onClose:e.onCancel,children:[r.jsxs(B,{display:"flex",style:{justifyContent:"space-between"},children:[e.exportCsv&&r.jsx(wi,{text:"CSV",exportLogic:e.exportCsv,onCancel:e.onCancel}),e.exportTransactionBundle&&r.jsx(wi,{text:"Transaction Bundle",exportLogic:e.exportTransactionBundle,onCancel:e.onCancel})]}),r.jsx(T,{style:{marginTop:"10px",marginLeft:"2px"},children:"Limited to 1000 records"})]})}function wi(e){return r.jsx(O,{onClick:()=>{e.exportLogic(),e.onCancel()},children:`Export as ${e.text}`})}var Ih={string:[S.EQUALS,S.NOT,S.CONTAINS,S.EXACT],fulltext:[S.EQUALS,S.NOT,S.CONTAINS,S.EXACT],token:[S.EQUALS,S.NOT],reference:[S.EQUALS,S.NOT],numeric:[S.EQUALS,S.NOT_EQUALS,S.GREATER_THAN,S.LESS_THAN,S.GREATER_THAN_OR_EQUALS,S.LESS_THAN_OR_EQUALS],quantity:[S.EQUALS,S.NOT_EQUALS,S.GREATER_THAN,S.LESS_THAN,S.GREATER_THAN_OR_EQUALS,S.LESS_THAN_OR_EQUALS],date:[S.EQUALS,S.NOT_EQUALS,S.GREATER_THAN,S.LESS_THAN,S.GREATER_THAN_OR_EQUALS,S.LESS_THAN_OR_EQUALS,S.STARTS_AFTER,S.ENDS_BEFORE,S.APPROXIMATELY],datetime:[S.EQUALS,S.NOT_EQUALS,S.GREATER_THAN,S.LESS_THAN,S.GREATER_THAN_OR_EQUALS,S.LESS_THAN_OR_EQUALS,S.STARTS_AFTER,S.ENDS_BEFORE,S.APPROXIMATELY]},Rh={eq:"equals",ne:"not equals",gt:"greater than",lt:"less than",ge:"greater than or equals",le:"less than or equals",sa:"starts after",eb:"ends before",ap:"approximately",contains:"contains",exact:"exact",text:"text",not:"not",above:"above",below:"below",in:"in","not-in":"not in","of-type":"of type",missing:"missing",present:"present",identifier:"identifier",iterate:"iterate"};function Er(e,t){return{...e,filters:t,offset:0,name:void 0}}function aa(e,t){return Er(e,(e.filters??[]).filter(n=>n.code!==t))}function Cn(e,t,n,i,s){let a=[];return e.filters&&a.push(...e.filters),a.push({code:t,operator:n,value:i??""}),Er(e,a)}function Dh(e,t){if(!e.filters)return e;let n=[...e.filters];return n.splice(t,1),{...e,filters:n,name:void 0}}function Ah(e,t){return Tr(e,t,-1)}function Mh(e,t){return Tr(e,t,0)}function _h(e,t){return Tr(e,t,1)}function Tr(e,t,n){let i=new Date;i.setDate(i.getDate()+n),i.setHours(0,0,0,0);let s=new Date(i.getTime());return s.setDate(s.getDate()+1),s.setTime(s.getTime()-1),Ir(e,t,i,s)}function Oh(e,t){return Pr(e,t,-1)}function Lh(e,t){return Pr(e,t,0)}function Nh(e,t){return Pr(e,t,1)}function Pr(e,t,n){let i=new Date;i.setMonth(i.getMonth()+n),i.setDate(1),i.setHours(0,0,0,0);let s=new Date(i.getTime());return s.setMonth(s.getMonth()+1),s.setDate(1),s.setHours(0,0,0,0),s.setTime(s.getTime()-1),Ir(e,t,i,s)}function Uh(e,t){let n=new Date;return n.setMonth(0),n.setDate(1),n.setHours(0,0,0,0),Ir(e,t,n,new Date)}function Ir(e,t,n,i){return e=aa(e,t),e=Si(e,t,S.GREATER_THAN_OR_EQUALS,n),e=Si(e,t,S.LESS_THAN_OR_EQUALS,i),e}function Si(e,t,n,i){return Cn(e,t,n,i.toISOString())}function ki(e,t,n=!0){return Cn(e,t,S.MISSING,n.toString())}function Fh(e,t){return e.offset===t?e:{...e,offset:t,name:void 0}}function Bh(e,t){let n=e.count??ur,i=(t-1)*n;return Fh(e,i)}function $h(e,t,n){return t===qh(e)&&n!==void 0&&n===Vh(e)?e:{...e,sortRules:[{code:t,descending:!!n}],name:void 0}}function qh(e){let t=e.sortRules;if(!t||t.length===0)return;let n=t[0].code;return n.startsWith("-")?n.substr(1):n}function Vh(e){let t=e.sortRules;return!t||t.length===0?!1:!!t[0].descending}function zh(e){return Ih[e.type]}function Rr(e){return Rh[e]??""}function st(e){let t=e;return t.includes(".")&&(t=t.split(".").pop()),t==="versionId"?"Version ID":(t=t.replace("[x]",""),t=t.replace(/([A-Z])/g," $1"),t=t.replace(/[-_]/g," "),t=t.replace(/\s+/g," "),t=t.trim(),t.toLowerCase()==="id"?"ID":t.split(/\s/).map(De).join(" "))}function Hh(e,t){var i,s;let n=t.name;return n==="id"?e.id:n==="meta.versionId"?(i=e.meta)==null?void 0:i.versionId:n==="_lastUpdated"?Ce((s=e.meta)==null?void 0:s.lastUpdated):t.elementDefinition&&`${e.resourceType}.${t.name}`===t.elementDefinition.path?Wh(e,t.elementDefinition):t.searchParams&&t.searchParams.length===1&&t.name===t.searchParams[0].code?Qh(e,t.searchParams[0]):null}function Wh(e,t){var a,o,c;let n=((c=(o=(a=t.path)==null?void 0:a.split("."))==null?void 0:o.pop())==null?void 0:c.replaceAll("[x]",""))??"",[i,s]=wr({type:e.resourceType,value:e},n);return i?r.jsx(ot,{path:t.path,property:t,propertyType:s,value:i,maxWidth:200,ignoreMissingValues:!0,link:!1}):null}function Qh(e,t){let n=lr(t.expression,[{type:e.resourceType,value:e}]);return!n||n.length===0?null:r.jsx(r.Fragment,{children:n.map((i,s)=>r.jsx(ot,{propertyType:i.type,value:i.value,maxWidth:200,ignoreMissingValues:!0,link:!1},`${s}-${n.length}`))})}function Gh(e){let t=h.useRef(!1),[n,i]=h.useState({search:JSON.parse(rt(e.search))}),[s,a]=h.useState(!1);h.useEffect(()=>{i({search:e.search})},[e.search]);let o=h.useMemo(()=>{if(!e.visible)return[];let l=e.search.resourceType,u=as(l),d=tr(l);return Xn(Jh(u,d)).map(m=>({value:m,label:st(m)}))},[e.visible,e.search.resourceType]);if(!e.visible)return null;function c(l){i({search:{...n.search,fields:l}})}return r.jsx(kt,{title:"Fields",closeButtonProps:{"aria-label":"Close"},opened:e.visible,onClose:()=>{e.onCancel()},size:"auto",withOverlay:!0,closeOnClickOutside:!1,overlayProps:{onMouseDownCapture:()=>{t.current=s},onClick:()=>{t.current||e.onCancel(),t.current=!1},children:r.jsx("div",{"data-testid":"overlay-child"})},children:r.jsxs(F,{children:[r.jsx(Bi,{style:{width:550},placeholder:"Select fields to display",data:o,value:n.search.fields??[],onChange:c,onDropdownOpen:()=>a(!0),onDropdownClose:()=>a(!1),maxDropdownHeight:"250px",clearButtonProps:{"aria-label":"Clear selection"},clearable:!0,searchable:!0}),r.jsx(D,{justify:"flex-end",children:r.jsx(O,{onClick:()=>e.onOk(n.search),children:"OK"})})]})})}function Jh(e,t){let n=[],i=new Set,s=new Set;for(let a of Object.keys(e.elements))n.push(a),i.add(a.toLowerCase()),s.add(st(a));if(t)for(let a of Object.keys(t)){let o=st(a);!i.has(a)&&!s.has(o)&&(n.push(a),i.add(a),s.add(o))}return n}function oa(e){var s;let{resourceType:t,filter:n}=e,i=(s=Ue.types[t].searchParams)==null?void 0:s[n.code];if(i){if(i.type==="reference"&&(n.operator===S.EQUALS||n.operator===S.NOT_EQUALS))return r.jsx(jn,{value:{reference:n.value}});let a=Ht(t,i);if(n.code==="_lastUpdated"||a.type===et.DATETIME)return r.jsx(r.Fragment,{children:Ce(n.value)})}return r.jsx(r.Fragment,{children:n.value})}function ca(e){let t=Ht(e.resourceType,e.searchParam),n="filter-value";switch(t.type){case et.REFERENCE:return r.jsx(Xs,{name:n,defaultValue:e.defaultValue?{reference:e.defaultValue}:void 0,targetTypes:e.searchParam.target,autoFocus:e.autoFocus,onChange:i=>{i?e.onChange(i.reference):e.onChange("")}});case et.BOOLEAN:return r.jsx(Bt,{name:n,"data-autofocus":e.autoFocus,"data-testid":n,defaultChecked:e.defaultValue==="true",autoFocus:e.autoFocus,onChange:i=>e.onChange(i.currentTarget.checked.toString())});case et.DATE:return r.jsx(W,{type:"date",name:n,"data-autofocus":e.autoFocus,"data-testid":n,defaultValue:e.defaultValue,autoFocus:e.autoFocus,onChange:i=>e.onChange(i.currentTarget.value)});case et.DATETIME:return r.jsx(Zs,{name:n,defaultValue:e.defaultValue,autoFocus:e.autoFocus,onChange:e.onChange});case et.NUMBER:return r.jsx(W,{type:"number",name:n,"data-autofocus":e.autoFocus,"data-testid":n,defaultValue:e.defaultValue,autoFocus:e.autoFocus,onChange:i=>e.onChange(i.currentTarget.value)});case et.QUANTITY:return r.jsx(Ks,{name:n,path:"",defaultValue:Yh(e.defaultValue),autoFocus:e.autoFocus,onChange:i=>{i?e.onChange(`${i.value}`):e.onChange("")}});default:return r.jsx(W,{name:n,"data-autofocus":e.autoFocus,"data-testid":n,defaultValue:e.defaultValue,autoFocus:e.autoFocus,onChange:i=>e.onChange(i.currentTarget.value),placeholder:"Search value"})}}function Yh(e){if(e){let[t,n,i]=e.split("|");if(t)return{value:parseFloat(t),system:n,unit:i}}}function Zh(e){let[t,n]=h.useState(JSON.parse(rt(e.search))),[i,s]=h.useState(-1),a=h.useRef(t);a.current=t,h.useEffect(()=>{n(JSON.parse(rt(e.search)))},[e.search]);function o(d){n(Cn(a.current,d.code,d.operator,d.value))}if(!e.visible)return null;let c=e.search.resourceType,l=tr(c)??{},u=t.filters||[];return r.jsxs(kt,{title:"Filters",closeButtonProps:{"aria-label":"Close"},size:900,opened:e.visible,onClose:e.onCancel,children:[r.jsx("div",{children:r.jsxs("table",{children:[r.jsxs("colgroup",{children:[r.jsx("col",{style:{width:200}}),r.jsx("col",{style:{width:200}}),r.jsx("col",{style:{width:380}}),r.jsx("col",{style:{width:120}})]}),r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"Field"}),r.jsx("th",{children:"Operation"}),r.jsx("th",{children:"Value"}),r.jsx("th",{children:"Actions"})]})}),r.jsxs("tbody",{children:[u.map((d,m)=>m===i?r.jsx(Ei,{resourceType:c,searchParams:l,defaultValue:d,okText:"Save",onOk:f=>{let p=[...u];p[m]=f,n(Er(a.current,p)),s(-1)},onCancel:()=>s(-1)},`filter-${d.code}-${d.operator}-${d.value}-input`):r.jsx(Kh,{resourceType:c,filter:d,onEdit:()=>s(m),onDelete:()=>n(Dh(a.current,m))},`filter-${d.code}-${d.operator}-${d.value}-display`)),r.jsx(Ei,{resourceType:c,searchParams:l,okText:"Add",onOk:o})]})]})}),r.jsx(D,{justify:"flex-end",mt:"xl",children:r.jsx(O,{onClick:()=>e.onOk(a.current),children:"OK"})})]})}function Kh(e){let{filter:t}=e;return r.jsxs("tr",{children:[r.jsx("td",{children:st(t.code)}),r.jsx("td",{children:Rr(t.operator)}),r.jsx("td",{children:r.jsx(oa,{resourceType:e.resourceType,filter:t})}),r.jsxs("td",{children:[r.jsx(O,{size:"compact-md",variant:"outline",onClick:e.onEdit,children:"Edit"}),r.jsx(O,{size:"compact-md",variant:"outline",onClick:e.onDelete,children:"Delete"})]})]})}function Ei(e){let[t,n]=h.useState(e.defaultValue??{}),i=h.useRef(t);i.current=t;function s(u){n({...i.current,code:u})}function a(u){n({...i.current,operator:u})}function o(u){n({...i.current,value:u})}let c=e.searchParams[t.code],l=c&&zh(c);return r.jsxs("tr",{children:[r.jsx("td",{children:r.jsx(tt,{"data-testid":"filter-field",defaultValue:i.current.code,onChange:u=>s(u.currentTarget.value),data:["",...Object.keys(e.searchParams).map(u=>({value:u,label:st(u)}))]})}),r.jsx("td",{children:l&&r.jsx(tt,{"data-testid":"filter-operation",defaultValue:t.operator,onChange:u=>a(u.currentTarget.value),data:["",...l.map(u=>({value:u,label:Rr(u)}))]})}),r.jsx("td",{children:c&&t.operator&&r.jsx(ca,{resourceType:e.resourceType,searchParam:c,defaultValue:t.value,onChange:o})}),r.jsxs("td",{children:[t.code&&t.operator&&r.jsx(O,{size:"compact-md",variant:"outline",onClick:()=>{e.onOk(i.current),n({})},children:e.okText}),e.onCancel&&r.jsx(O,{size:"compact-md",variant:"outline",onClick:e.onCancel,children:"Cancel"})]})]})}function Xh(e){let[t,n]=h.useState(e.defaultValue??"");if(!e.visible||!e.searchParam||!e.filter)return null;function i(){e.onOk({...e.filter,value:t})}return r.jsx(kt,{title:e.title,size:"xl",opened:e.visible,onClose:e.onCancel,children:r.jsx(Ae,{onSubmit:i,children:r.jsxs(Oe,{children:[r.jsx(Oe.Col,{span:10,children:r.jsx(ca,{resourceType:e.resourceType,searchParam:e.searchParam,defaultValue:t,autoFocus:!0,onChange:n})}),r.jsx(Oe.Col,{span:2,children:r.jsx(O,{onClick:i,fullWidth:!0,children:"OK"})})]})})})}function em(e){if(!e.searchParams)return null;function t(a,o){s($h(e.search,a.code,o))}function n(a){s(aa(e.search,a.code))}function i(a,o){e.onPrompt(a,{code:a.code,operator:o,value:""})}function s(a){e.onChange(a)}return e.searchParams.length===1?r.jsx(tm,{search:e.search,searchParam:e.searchParams[0],onSort:t,onPrompt:i,onChange:s,onClear:n}):r.jsx(E.Dropdown,{children:e.searchParams.map(a=>r.jsx(E.Item,{children:st(a.code)},a.code))})}function tm(e){switch(e.searchParam.type){case"date":return r.jsx(nm,{...e});case"number":case"quantity":return r.jsx(rm,{...e});case"reference":return r.jsx(im,{...e});case"string":return r.jsx(sm,{...e});case"token":case"uri":return r.jsx(am,{...e});default:return r.jsxs(r.Fragment,{children:["Unknown search param type: ",e.searchParam.type]})}}function nm(e){let{searchParam:t}=e,n=t.code;return r.jsxs(E.Dropdown,{children:[r.jsx(E.Item,{leftSection:r.jsx(vr,{size:14}),onClick:()=>e.onSort(t,!1),children:"Sort Oldest to Newest"}),r.jsx(E.Item,{leftSection:r.jsx(jr,{size:14}),onClick:()=>e.onSort(t,!0),children:"Sort Newest to Oldest"}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(Gt,{size:14}),onClick:()=>e.onPrompt(t,S.EQUALS),children:"Equals..."}),r.jsx(E.Item,{leftSection:r.jsx(Qt,{size:14}),onClick:()=>e.onPrompt(t,S.NOT_EQUALS),children:"Does not equal..."}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(Us,{size:14}),onClick:()=>e.onPrompt(t,S.ENDS_BEFORE),children:"Before..."}),r.jsx(E.Item,{leftSection:r.jsx(Ns,{size:14}),onClick:()=>e.onPrompt(t,S.STARTS_AFTER),children:"After..."}),r.jsx(E.Item,{leftSection:r.jsx(Ku,{size:14}),onClick:()=>e.onPrompt(t,S.EQUALS),children:"Between..."}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(lt,{size:14}),onClick:()=>e.onChange(_h(e.search,n)),children:"Tomorrow"}),r.jsx(E.Item,{leftSection:r.jsx(lt,{size:14}),onClick:()=>e.onChange(Mh(e.search,n)),children:"Today"}),r.jsx(E.Item,{leftSection:r.jsx(lt,{size:14}),onClick:()=>e.onChange(Ah(e.search,n)),children:"Yesterday"}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(lt,{size:14}),onClick:()=>e.onChange(Nh(e.search,n)),children:"Next Month"}),r.jsx(E.Item,{leftSection:r.jsx(lt,{size:14}),onClick:()=>e.onChange(Lh(e.search,n)),children:"This Month"}),r.jsx(E.Item,{leftSection:r.jsx(lt,{size:14}),onClick:()=>e.onChange(Oh(e.search,n)),children:"Last Month"}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(lt,{size:14}),onClick:()=>e.onChange(Uh(e.search,n)),children:"Year to date"}),r.jsx(Jt,{...e})]})}function rm(e){let{searchParam:t}=e;return r.jsxs(E.Dropdown,{children:[r.jsx(E.Item,{leftSection:r.jsx(vr,{size:14}),onClick:()=>e.onSort(t,!1),children:"Sort Smallest to Largest"}),r.jsx(E.Item,{leftSection:r.jsx(jr,{size:14}),onClick:()=>e.onSort(t,!0),children:"Sort Largest to Smallest"}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(Gt,{size:14}),onClick:()=>e.onPrompt(t,S.EQUALS),children:"Equals..."}),r.jsx(E.Item,{leftSection:r.jsx(Qt,{size:14}),onClick:()=>e.onPrompt(t,S.NOT_EQUALS),children:"Does not equal..."}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(Ns,{size:14}),onClick:()=>e.onPrompt(t,S.GREATER_THAN),children:"Greater than..."}),r.jsx(E.Item,{leftSection:r.jsx(xi,{size:14}),onClick:()=>e.onPrompt(t,S.GREATER_THAN_OR_EQUALS),children:"Greater than or equal to..."}),r.jsx(E.Item,{leftSection:r.jsx(Us,{size:14}),onClick:()=>e.onPrompt(t,S.LESS_THAN),children:"Less than..."}),r.jsx(E.Item,{leftSection:r.jsx(xi,{size:14}),onClick:()=>e.onPrompt(t,S.LESS_THAN_OR_EQUALS),children:"Less than or equal to..."}),r.jsx(Jt,{...e})]})}function im(e){let{searchParam:t}=e;return r.jsxs(E.Dropdown,{children:[r.jsx(E.Item,{leftSection:r.jsx(Gt,{size:14}),onClick:()=>e.onPrompt(t,S.EQUALS),children:"Equals..."}),r.jsx(E.Item,{leftSection:r.jsx(Qt,{size:14}),onClick:()=>e.onPrompt(t,S.NOT),children:"Does not equal..."}),r.jsx(Jt,{...e})]})}function sm(e){let{searchParam:t}=e;return r.jsxs(E.Dropdown,{children:[r.jsx(E.Item,{leftSection:r.jsx(vr,{size:14}),onClick:()=>e.onSort(t,!1),children:"Sort A to Z"}),r.jsx(E.Item,{leftSection:r.jsx(jr,{size:14}),onClick:()=>e.onSort(t,!0),children:"Sort Z to A"}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(Gt,{size:14}),onClick:()=>e.onPrompt(t,S.EQUALS),children:"Equals..."}),r.jsx(E.Item,{leftSection:r.jsx(Qt,{size:14}),onClick:()=>e.onPrompt(t,S.NOT),children:"Does not equal..."}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(ed,{size:14}),onClick:()=>e.onPrompt(t,S.CONTAINS),children:"Contains..."}),r.jsx(E.Item,{leftSection:r.jsx(Xu,{size:14}),onClick:()=>e.onPrompt(t,S.EQUALS),children:"Does not contain..."}),r.jsx(Jt,{...e})]})}function am(e){let{searchParam:t}=e;return r.jsxs(E.Dropdown,{children:[r.jsx(E.Item,{leftSection:r.jsx(Gt,{size:14}),onClick:()=>e.onPrompt(t,S.EQUALS),children:"Equals..."}),r.jsx(E.Item,{leftSection:r.jsx(Qt,{size:14}),onClick:()=>e.onPrompt(t,S.NOT),children:"Does not equal..."}),r.jsx(Jt,{...e})]})}function Jt(e){let{searchParam:t}=e,n=t.code;return r.jsxs(r.Fragment,{children:[r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(Yu,{size:14}),onClick:()=>e.onChange(ki(e.search,n)),children:"Missing"}),r.jsx(E.Item,{leftSection:r.jsx(Ju,{size:14}),onClick:()=>e.onChange(ki(e.search,n,!1)),children:"Not missing"}),r.jsx(E.Divider,{}),r.jsx(E.Item,{leftSection:r.jsx(cd,{size:14}),onClick:()=>e.onClear(t),children:"Clear filters"})]})}var _t={root:"SearchControl_root",table:"SearchControl_table",tr:"SearchControl_tr",th:"SearchControl_th",control:"SearchControl_control",icon:"SearchControl_icon"};function om(e){let t=e.resourceType,n=[];for(let i of e.fields||["id","_lastUpdated"])n.push(cm(t,i));return n}function cm(e,t){var s;if(t==="_lastUpdated")return{name:"_lastUpdated",searchParams:[{resourceType:"SearchParameter",base:["Resource"],code:"_lastUpdated",name:"_lastUpdated",type:"date",expression:"Resource.meta.lastUpdated"}]};if(t==="meta.versionId")return{name:"meta.versionId",searchParams:[{resourceType:"SearchParameter",base:["Resource"],code:"_versionId",name:"_versionId",type:"token",expression:"Resource.meta.versionId"}]};let n=fn(e,t),i=Tc(e,t.toLowerCase());if(n&&i)return{name:t,elementDefinition:n,searchParams:[i]};if(n){let a=tr(e),o;if(a){let c=new RegExp(`${e}\\.${t.replaceAll("[x]","")}([^\\w-]|$)`);o=Object.values(a).filter(l=>!!l.expression&&c.test(l==null?void 0:l.expression)),o.length===0&&(o=void 0)}return{name:t,elementDefinition:n,searchParams:o}}if(i){let a=Ht(e,i);return{name:t,elementDefinition:(s=a.elementDefinitions)==null?void 0:s[0],searchParams:[i]}}return{name:t}}var lm=class extends Event{constructor(e){super("change"),this.definition=e}},um=class extends Event{constructor(e){super("load"),this.response=e}},ln=class extends Event{constructor(e,t){super("click"),this.resource=e,this.browserEvent=t}};function dm(e){var ge,X,Be,oe;let t=L(),[n,i]=h.useState(),[s,a]=h.useState(),{search:o,onLoad:c}=e,[l,u]=h.useState({selected:{},fieldEditorVisible:!1,filterEditorVisible:!1,exportDialogVisible:!1,filterDialogVisible:!1}),d=h.useRef(l);d.current=l;let m=o.total??"accurate",f=h.useCallback(k=>{a(void 0),t.search(o.resourceType,vl({...o,total:m,fields:void 0}),k).then(q=>{u({...d.current,searchResponse:q}),c&&c(new um(q))}).catch(q=>{u({...d.current,searchResponse:void 0}),a(q)})},[t,o,m,c]),p=h.useCallback(()=>{u({...d.current,searchResponse:void 0}),f({cache:"reload"})},[f]);h.useEffect(()=>{f()},[f]);function g(k,q){k.stopPropagation();let ne=k.target.checked,le={...d.current.selected};ne?le[q]=!0:delete le[q],u({...d.current,selected:le})}function x(k){k.stopPropagation();let q=k.target.checked,ne={},le=d.current.searchResponse;q&&(le!=null&&le.entry)&&le.entry.forEach(gt=>{var yt;(yt=gt.resource)!=null&&yt.id&&(ne[gt.resource.id]=!0)}),u({...d.current,selected:ne})}function C(){var q,ne;let k=d.current;if(!((q=k.searchResponse)!=null&&q.entry)||k.searchResponse.entry.length===0)return!1;for(let le of k.searchResponse.entry)if((ne=le.resource)!=null&&ne.id&&!k.selected[le.resource.id])return!1;return!0}function j(k){e.onChange&&e.onChange(new lm(k))}function w(k,q){if(Bs(k.target)||k.button===2)return;it(k);let ne=k.button===1||k.ctrlKey||k.metaKey;!ne&&e.onClick&&e.onClick(new ln(q,k)),ne&&e.onAuxClick&&e.onAuxClick(new ln(q,k))}function y(){return!!(e.onExport??e.onExportCsv??e.onExportTransactionBundle)}if(h.useEffect(()=>{i(e.search.resourceType),t.requestSchema(e.search.resourceType).catch(console.error).finally(()=>i(void 0))},[t,e.search.resourceType]),!ss(e.search.resourceType)||n===e.search.resourceType)return r.jsx(fe,{style:{width:"100%",height:"100%"},children:r.jsx(un,{})});let v=e.checkboxesEnabled,A=om(o),M=o.resourceType,I=l.searchResponse,N=(ge=I==null?void 0:I.entry)==null?void 0:ge.map(k=>k.resource),Q="subtle",J="gray",K=16,pe=window.innerWidth<768;return r.jsxs("div",{className:_t.root,"data-testid":"search-control",children:[!e.hideToolbar&&r.jsxs(D,{justify:"space-between",mb:"xl",children:[r.jsxs(D,{gap:2,children:[r.jsx(O,{size:"compact-md",variant:Q,color:J,leftSection:r.jsx(td,{size:K}),onClick:()=>u({...d.current,fieldEditorVisible:!0}),children:"Fields"}),r.jsx(O,{size:"compact-md",variant:Q,color:J,leftSection:r.jsx(id,{size:K}),onClick:()=>u({...d.current,filterEditorVisible:!0}),children:"Filters"}),e.onNew&&r.jsx(O,{size:"compact-md",variant:Q,color:J,leftSection:r.jsx(rd,{size:K}),onClick:e.onNew,children:"New..."}),!pe&&y()&&r.jsx(O,{size:"compact-md",variant:Q,color:J,leftSection:r.jsx(ad,{size:K}),onClick:e.onExport?e.onExport:()=>u({...d.current,exportDialogVisible:!0}),children:"Export..."}),!pe&&e.onDelete&&r.jsx(O,{size:"compact-md",variant:Q,color:J,leftSection:r.jsx(od,{size:K}),onClick:()=>e.onDelete(Object.keys(l.selected)),children:"Delete..."}),!pe&&e.onBulk&&r.jsx(O,{size:"compact-md",variant:Q,color:J,leftSection:r.jsx(Zu,{size:K}),onClick:()=>e.onBulk(Object.keys(l.selected)),children:"Bulk..."})]}),r.jsxs(D,{gap:2,children:[I&&r.jsxs(T,{size:"xs",c:"dimmed","data-testid":"count-display",children:[la(o,I).toLocaleString(),"-",pm(o,I).toLocaleString(),I.total!==void 0&&` of ${o.total==="estimate"?"~":""}${(X=I.total)==null?void 0:X.toLocaleString()}`]}),r.jsx($n,{variant:Q,color:J,title:"Refresh",onClick:p,children:r.jsx(sd,{size:K})})]})]}),r.jsxs(P,{className:_t.table,children:[r.jsxs(P.Thead,{children:[r.jsxs(P.Tr,{children:[v&&r.jsx(P.Th,{children:r.jsx("input",{type:"checkbox",value:"checked","aria-label":"all-checkbox","data-testid":"all-checkbox",checked:C(),onChange:k=>x(k)})}),A.map(k=>r.jsx(P.Th,{children:r.jsxs(E,{shadow:"md",width:240,position:"bottom-end",children:[r.jsx(E.Target,{children:r.jsx(dt,{className:_t.control,p:2,children:r.jsxs(D,{justify:"space-between",wrap:"nowrap",children:[r.jsx(T,{fw:500,children:st(k.name)}),r.jsx(fe,{className:_t.icon,children:r.jsx(Qu,{size:14,stroke:1.5})})]})})}),r.jsx(em,{search:e.search,searchParams:k.searchParams,onPrompt:(q,ne)=>{u({...d.current,filterDialogVisible:!0,filterDialogSearchParam:q,filterDialogFilter:ne})},onChange:q=>{j(q)}})]})},k.name))]}),!e.hideFilters&&r.jsxs(P.Tr,{children:[v&&r.jsx(P.Th,{}),A.map(k=>r.jsx(P.Th,{children:k.searchParams&&r.jsx(hm,{resourceType:M,searchParams:k.searchParams,filters:e.search.filters})},k.name))]})]}),r.jsx(P.Tbody,{children:N==null?void 0:N.map(k=>k&&r.jsxs(P.Tr,{className:_t.tr,"data-testid":"search-control-row",onClick:q=>w(q,k),onAuxClick:q=>w(q,k),children:[v&&r.jsx(P.Td,{children:r.jsx("input",{type:"checkbox",value:"checked","data-testid":"row-checkbox","aria-label":`Checkbox for ${k.id}`,checked:!!l.selected[k.id],onChange:q=>g(q,k.id)})}),A.map(q=>r.jsx(P.Td,{children:Hh(k,q)},q.name))]},k.id))})]}),(N==null?void 0:N.length)===0&&r.jsx(ta,{children:r.jsx(fe,{style:{height:150},children:r.jsx(T,{size:"xl",c:"dimmed",children:"No results"})})}),I&&r.jsx(fe,{m:"md",p:"md",children:r.jsx(Na,{value:mm(o),total:fm(o,I),onChange:k=>j(Bh(o,k)),getControlProps:k=>{switch(k){case"previous":return{"aria-label":"Previous page"};case"next":return{"aria-label":"Next page"};default:return{}}}})}),s&&r.jsx("div",{"data-testid":"search-error",children:r.jsx("pre",{style:{textAlign:"left"},children:JSON.stringify(s,void 0,2)})}),r.jsx(Gh,{search:e.search,visible:d.current.fieldEditorVisible,onOk:k=>{j(k),u({...d.current,fieldEditorVisible:!1})},onCancel:()=>{u({...d.current,fieldEditorVisible:!1})}}),r.jsx(Zh,{search:e.search,visible:d.current.filterEditorVisible,onOk:k=>{j(k),u({...d.current,filterEditorVisible:!1})},onCancel:()=>{u({...d.current,filterEditorVisible:!1})}}),r.jsx(Ph,{visible:d.current.exportDialogVisible,exportCsv:e.onExportCsv,exportTransactionBundle:e.onExportTransactionBundle,onCancel:()=>{u({...d.current,exportDialogVisible:!1})}}),r.jsx(Xh,{visible:d.current.filterDialogVisible,title:(Be=l.filterDialogSearchParam)!=null&&Be.code?st(l.filterDialogSearchParam.code):"",resourceType:M,searchParam:l.filterDialogSearchParam,filter:l.filterDialogFilter,defaultValue:"",onOk:k=>{j(Cn(e.search,k.code,k.operator,k.value)),u({...d.current,filterDialogVisible:!1})},onCancel:()=>{u({...d.current,filterDialogVisible:!1})}},(oe=l.filterDialogSearchParam)==null?void 0:oe.code)]})}h.memo(dm);function hm(e){let t=(e.filters??[]).filter(n=>e.searchParams.find(i=>i.code===n.code));return t.length===0?r.jsx("span",{children:"no filters"}):r.jsx(r.Fragment,{children:t.map(n=>r.jsxs("div",{children:[Rr(n.operator),"",r.jsx(oa,{resourceType:e.resourceType,filter:n})]},`filter-${n.code}-${n.operator}-${n.value}`))})}function mm(e){return Math.floor((e.offset??0)/(e.count??ur))+1}function fm(e,t){let n=e.count??ur,i=ua(e,t);return Math.ceil(i/n)}function la(e,t){return Math.min(ua(e,t),(e.offset??0)+1)}function pm(e,t){var n;return Math.max(la(e,t)+(((n=t.entry)==null?void 0:n.length)??0)-1,0)}function ua(e,t){var i,s;let n=t.total;return n===void 0&&(n=(e.offset??0)+(((i=t.entry)==null?void 0:i.length)??0)+((s=t.link)!=null&&s.some(a=>a.relation==="next")?1:0)),n}function gm(e){let t=L(),[n,i]=h.useState(!1),[s,a]=h.useState(),{query:o,fields:c}=e,[l,u]=h.useState(),[d,m]=h.useState({}),f=h.useRef();f.current=l;let p=h.useRef({});p.current=d,h.useEffect(()=>{a(void 0),t.graphql(o).then(u).catch(y=>a(he(y)))},[t,o]);function g(y,v){y.stopPropagation();let A=y.target.checked,M={...p.current};A?M[v]=!0:delete M[v],m(M)}function x(y){var I;y.stopPropagation();let v=y.target.checked,A={},M=(I=f.current)==null?void 0:I.data.ResourceList;v&&M&&M.forEach(N=>{N.id&&(A[N.id]=!0)}),m(A)}function C(){var v;let y=(v=f.current)==null?void 0:v.data.ResourceList;if(!y||y.length===0)return!1;for(let A of y)if(A.id&&!p.current[A.id])return!1;return!0}function j(y,v){Bs(y.target)||(it(y),y.button!==1&&e.onClick&&e.onClick(new ln(v,y)),y.button===1&&e.onAuxClick&&e.onAuxClick(new ln(v,y)))}if(h.useEffect(()=>{t.requestSchema(e.resourceType).then(()=>i(!0)).catch(console.log)},[t,e.resourceType]),!n)return r.jsx(un,{});let w=e.checkboxesEnabled;return r.jsxs("div",{onContextMenu:y=>it(y),"data-testid":"search-control",children:[r.jsxs(P,{children:[r.jsx(P.Thead,{children:r.jsxs(P.Tr,{children:[w&&r.jsx(P.Th,{children:r.jsx("input",{type:"checkbox",value:"checked","aria-label":"all-checkbox","data-testid":"all-checkbox",checked:C(),onChange:y=>x(y)})}),c.map(y=>r.jsx(P.Th,{children:y.name},y.name))]})}),r.jsx(P.Tbody,{children:l==null?void 0:l.data.ResourceList.map(y=>y&&r.jsxs(P.Tr,{"data-testid":"search-control-row",onClick:v=>j(v,y),onAuxClick:v=>j(v,y),children:[w&&r.jsx(P.Td,{children:r.jsx("input",{type:"checkbox",value:"checked","data-testid":"row-checkbox","aria-label":`Checkbox for ${y.id}`,checked:!!d[y.id],onChange:v=>g(v,y.id)})}),c.map(v=>r.jsx(P.Td,{children:r.jsx(Th,{propertyType:v.propertyType,path:v.fhirPath,resource:y})},v.name))]},y.id))})]}),(l==null?void 0:l.data.ResourceList.length)===0&&r.jsx("div",{"data-testid":"empty-search",children:"No results"}),s&&r.jsx("div",{"data-testid":"search-error",children:r.jsx("pre",{style:{textAlign:"left"},children:JSON.stringify(s,void 0,2)})}),e.onBulk&&r.jsx(O,{onClick:()=>e.onBulk(Object.keys(p.current)),children:"Bulk..."})]})}h.memo(gm);function wn(e){return r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 491 491",style:{width:e.size,height:e.size},children:[r.jsx("title",{children:"Medplum Logo"}),r.jsx("path",{fill:e.fill??"#ad7136",d:"M282 67c6-16 16-29 29-40L289 0c-22 17-37 41-43 68l17 23 19-24z"}),r.jsx("path",{fill:e.fill??"#946af9",d:"M311 63c-17 0-33 4-48 11-16-7-32-11-49-11-87 0-158 96-158 214s71 214 158 214c17 0 33-4 49-11 15 7 31 11 48 11 87 0 158-96 158-214S398 63 311 63z"}),r.jsx("path",{fill:e.fill??"#7857c5",d:"M231 489l-17 2c-87 0-158-96-158-214S127 63 214 63l17 1c-39 12-70 102-70 213s31 201 70 212z"}),r.jsx("path",{fill:e.fill??"#40bc26",d:"M207 220a176 176 0 01-177 43A176 176 0 01251 43l1 5c17 59 2 125-45 172z"}),r.jsx("path",{fill:e.fill??"#33961e",d:"M252 48A421 421 0 0057 270l-27-7A176 176 0 01251 43l1 5z"})]})}function Sn(e){var n;let t=((n=e.outcome)==null?void 0:n.issue)||e.issues;return!t||t.length===0?null:r.jsx(Ft,{icon:r.jsx(yr,{size:16}),color:"red",children:t.map(i=>{var s;return r.jsx("div",{"data-testid":"text-field-error",children:ns(i)},(s=i.details)==null?void 0:s.text)})})}var ym=(e=>(e.group="group",e.display="display",e.question="question",e.boolean="boolean",e.decimal="decimal",e.integer="integer",e.date="date",e.dateTime="dateTime",e.time="time",e.string="string",e.text="text",e.url="url",e.choice="choice",e.openChoice="open-choice",e.attachment="attachment",e.reference="reference",e.quantity="quantity",e))(ym||{});function xm(e,t){if(!e.enableWhen)return!0;let n=e.enableBehavior??"any";for(let i of e.enableWhen){let s=da(t,i.question);if(i.operator==="exists"&&!i.answerBoolean&&!(s!=null&&s.length)){if(n==="any")return!0;continue}let{anyMatch:a,allMatch:o}=bm(i,s,n);if(n==="any"&&a)return!0;if(n==="all"&&!o)return!1}return n!=="any"}function vm(e,t,n){return e.map(i=>{var o;let s=(o=n.answerOption)==null?void 0:o.find(c=>at(c.valueCoding)===i||c[t]===i),a=ie({type:"QuestionnaireItemAnswerOption",value:s},"value");return{[t]:a==null?void 0:a.value}})}function da(e,t){if(e)for(let n of e){if(n.linkId===t)return n.answer;if(n.item){let i=da(n.item,t);if(i)return i}}}function jm(e,t,n){if(n==="exists")return!!e===t.value;if(e){let i=n==="="||n==="!="?n==null?void 0:n.replace("=","~"):n,[{value:s}]=lr(`%actualAnswer ${i} %expectedAnswer`,[e],{"%actualAnswer":e,"%expectedAnswer":t});return s}else return!1}function bm(e,t,n){let i=t||[],s=ie({type:"QuestionnaireItemEnableWhen",value:e},"answer[x]"),a=!1,o=!0;for(let c of i){let l=ie({type:"QuestionnaireResponseItemAnswer",value:c},"value[x]"),{operator:u}=e;if(jm(l,s,u)?a=!0:o=!1,n==="any"&&a)break}return{anyMatch:a,allMatch:o}}function Cm(e){var n,i;let t=qt(e,"http://hl7.org/fhir/StructureDefinition/questionnaire-referenceResource");if(t){if(t.valueCode!==void 0)return[t.valueCode];if(t.valueCodeableConcept)return(i=(n=t.valueCodeableConcept)==null?void 0:n.coding)==null?void 0:i.map(s=>s.code)}}function wm(e,t,n){let i=qt(e,"http://hl7.org/fhir/StructureDefinition/questionnaire-referenceFilter");if(!(i!=null&&i.valueString))return;let s=i.valueString;t!=null&&t.reference&&(s=s.replaceAll("$subj",t.reference)),n!=null&&n.reference&&(s=s.replaceAll("$encounter",n.reference));let a={},o=s.split("&");for(let c of o){let[l,u]=On(c,"=",2);a[l]=u}return a}function Sm(e){return{resourceType:"QuestionnaireResponse",questionnaire:Z(e),item:ha(e.item),status:"in-progress"}}function ha(e){return(e==null?void 0:e.map(ma))??[]}function ma(e){var t;return{id:Em(),linkId:e.linkId,text:e.text,item:ha(e.item),answer:((t=e.initial)==null?void 0:t.map(Tm))??[]}}var km=1;function Em(){return"id-"+km++}function Tm(e){return{...e}}function Pm(e){return e.value.display||e.value.reference||rt(e.value)}function Im(e){var n,i,s,a,o;let t=(n=e==null?void 0:e.item)==null?void 0:n[0];return t&&((o=(a=(s=(i=qt(t,"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl"))==null?void 0:i.valueCodeableConcept)==null?void 0:s.coding)==null?void 0:a[0])==null?void 0:o.code)==="page"?e.item.length:1}var fa=h.createContext({});function Ti(e){let t=h.useContext(fa),n=e.item,i=e.response;function s(u){var m,f,p,g;let d;Array.isArray(u)?d=u:e.index>=(((f=(m=e.response)==null?void 0:m.answer)==null?void 0:f.length)??0)?d=(((p=e.response)==null?void 0:p.answer)??[]).concat([u]):d=(((g=e.response)==null?void 0:g.answer)??[]).map((x,C)=>C===e.index?u:x)??[],e.onChange({id:i==null?void 0:i.id,linkId:i==null?void 0:i.linkId,text:n.text,answer:d})}let a=n.type;if(!a)return null;let o=n.linkId;if(!o)return null;let c=n.initial&&n.initial.length>0?n.initial[0]:void 0,l=Dr(i,e.index)??ie({type:"QuestionnaireItemInitial",value:c},"value");switch(a){case"display":return r.jsx("p",{children:e.item.text},e.item.linkId);case"boolean":return r.jsx(Qd,{title:e.item.text,htmlFor:e.item.linkId,children:r.jsx(Bt,{id:e.item.linkId,name:e.item.linkId,defaultChecked:l==null?void 0:l.value,onChange:u=>s({valueBoolean:u.currentTarget.checked})})},e.item.linkId);case"decimal":return r.jsx(W,{type:"number",step:"any",id:o,name:o,required:n.required,defaultValue:l==null?void 0:l.value,onChange:u=>s({valueDecimal:u.currentTarget.valueAsNumber})});case"integer":return r.jsx(W,{type:"number",step:1,id:o,name:o,required:n.required,defaultValue:l==null?void 0:l.value,onChange:u=>s({valueInteger:u.currentTarget.valueAsNumber})});case"date":return r.jsx(W,{type:"date",id:o,name:o,required:n.required,defaultValue:l==null?void 0:l.value,onChange:u=>s({valueDate:u.currentTarget.value})});case"dateTime":return r.jsx(Zs,{name:o,required:n.required,defaultValue:l==null?void 0:l.value,onChange:u=>s({valueDateTime:u})});case"time":return r.jsx(W,{type:"time",id:o,name:o,required:n.required,defaultValue:l==null?void 0:l.value,onChange:u=>s({valueTime:u.currentTarget.value})});case"string":case"url":return r.jsx(W,{id:o,name:o,required:n.required,defaultValue:l==null?void 0:l.value,onChange:u=>s({valueString:u.currentTarget.value})});case"text":return r.jsx(qa,{id:o,name:o,required:n.required,defaultValue:l==null?void 0:l.value,onChange:u=>s({valueString:u.currentTarget.value})});case"attachment":return r.jsx(D,{py:4,children:r.jsx(Od,{path:"",name:o,defaultValue:l==null?void 0:l.value,onChange:u=>s({valueAttachment:u})})});case"reference":return r.jsx(Xs,{name:o,required:n.required,targetTypes:Cm(n),searchCriteria:wm(n,t.subject,t.encounter),defaultValue:l==null?void 0:l.value,onChange:u=>s({valueReference:u})});case"quantity":return r.jsx(Ks,{path:"",name:o,required:n.required,defaultValue:l==null?void 0:l.value,onChange:u=>s({valueQuantity:u}),disableWheel:!0});case"choice":case"open-choice":return Om(n)&&!n.answerValueSet?r.jsx(Rm,{name:o,item:n,initial:c,response:i,onChangeAnswer:u=>s(u)}):r.jsx(Dm,{name:o,item:n,initial:c,response:i,onChangeAnswer:u=>s(u)});default:return null}}function Rm(e){var l;let{name:t,item:n,initial:i,response:s}=e;if(!((l=n.answerOption)!=null&&l.length))return r.jsx(pa,{});let a=ie({type:"QuestionnaireItemInitial",value:i},"value"),o=[""];for(let u of n.answerOption){let d=ie({type:"QuestionnaireItemAnswerOption",value:u},"value");o.push(Pi(d))}let c=Dr(s)??a;if(n.repeats){let{propertyName:u,data:d}=Lm(e.item),m=Mm(s);return r.jsx(Bi,{data:d,placeholder:"Select items",searchable:!0,defaultValue:m||[Pi(a)],onChange:f=>{let p=vm(f,u,n);e.onChangeAnswer(p)}})}return r.jsx(tt,{id:t,name:t,onChange:u=>{let d=u.currentTarget.selectedIndex;if(d===0){e.onChangeAnswer({});return}let m=n.answerOption[d-1],f=ie({type:"QuestionnaireItemAnswerOption",value:m},"value"),p="value"+De(f.type);e.onChangeAnswer({[p]:f.value})},defaultValue:at(c==null?void 0:c.value)||(c==null?void 0:c.value),data:o})}function Dm(e){var o;let{name:t,item:n,initial:i,onChangeAnswer:s,response:a}=e;return!((o=n.answerOption)!=null&&o.length)&&!n.answerValueSet?r.jsx(pa,{}):n.answerValueSet?r.jsx(Jd,{path:"",name:t,binding:n.answerValueSet,onChange:c=>s({valueCoding:c}),creatable:n.type==="open-choice"}):r.jsx(Am,{name:(a==null?void 0:a.id)??t,item:n,initial:i,response:a,onChangeAnswer:s})}function Am(e){let{name:t,item:n,initial:i,onChangeAnswer:s,response:a}=e,o=fn("QuestionnaireItemAnswerOption","value[x]"),c=ie({type:"QuestionnaireItemInitial",value:i},"value"),l=[],u;if(n.answerOption)for(let f=0;f<n.answerOption.length;f++){let p=n.answerOption[f],g=`${t}-option-${f}`,x=ie({type:"QuestionnaireItemAnswerOption",value:p},"value");x!=null&&x.value&&(c&&rt(x)===rt(c)&&(u=g),l.push([g,x]))}let d=Dr(a),m=_m(l,d);return r.jsx($r.Group,{name:t,value:m??u,onChange:f=>{let p=l.find(g=>g[0]===f);if(p){let g=p[1],x="value"+De(g.type);s({[x]:g.value})}},children:l.map(([f,p])=>r.jsx($r,{id:f,value:f,py:4,label:r.jsx(ot,{property:o,propertyType:p.type,value:p.value})},f))})}function pa(){return r.jsx(W,{disabled:!0,placeholder:"No Answers Defined"})}function ga(e){return ie({type:"QuestionnaireItemAnswer",value:e},"value")}function Dr(e,t=0){let n=e.answer;return ga((n==null?void 0:n[t])??{})}function Mm(e){let t=e.answer;return t?t.map(n=>ga(n)).map(n=>at(n==null?void 0:n.value)||(n==null?void 0:n.value)):[]}function _m(e,t){var n;return(n=e.find(i=>Qe(i[1].value,t==null?void 0:t.value)))==null?void 0:n[0]}function Pi(e){if(e)return e.type==="CodeableConcept"?wt(e.value):e.type==="Coding"?at(e.value):e.type==="Reference"?Pm(e):e.value.toString()}function Om(e){var t;return!!((t=e.extension)!=null&&t.some(n=>{var i,s,a;return n.url==="http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl"&&((a=(s=(i=n.valueCodeableConcept)==null?void 0:i.coding)==null?void 0:s[0])==null?void 0:a.code)==="drop-down"}))}function Lm(e){var a;if(((a=e.answerOption)==null?void 0:a.length)===0)return{propertyName:"",data:[]};let t=e.answerOption[0],n=ie({type:"QuestionnaireItemAnswerOption",value:t},"value"),i="value"+De(n.type),s=(e.answerOption??[]).map(o=>({value:Ii(o,i),label:Ii(o,i)}));return{propertyName:i,data:s}}function Ii(e,t){var n;return at(e.valueCoding)||((n=e[t])==null?void 0:n.toString())}function ya(e){let{item:t,response:n,onChange:i}=e,[s,a]=h.useState(Nm(t,n??{linkId:t.linkId}));if(!e.checkForQuestionEnabled(t)||!n)return null;if(t.type==="display")return r.jsx("p",{children:t.text},t.linkId);let o=(t==null?void 0:t.repeats)&&t.type!=="choice"&&t.type!=="open-choice";return t.type==="boolean"?r.jsx(Ti,{item:t,response:n,onChange:c=>i([c]),index:0},t.linkId):r.jsxs(Gd,{htmlFor:e.item.linkId,title:e.item.text,withAsterisk:e.item.required,children:[[...Array(s)].map((c,l)=>r.jsx(Ti,{item:t,response:n,onChange:u=>i([u]),index:l},`${t.linkId}-${l}`)),o&&r.jsx(Y,{onClick:()=>a(c=>c+1),children:"Add Item"})]},e.item.linkId)}function Nm(e,t){if(e.type==="choice"||e.type==="open-choice")return 1;let n=t.answer;return n!=null&&n.length?n.length:1}function xa(e){let[t,n]=h.useState(e.response);if(t.length===0)return null;function i(a,o){let c=t.map((l,u)=>u===o?a[0]:l);n(c),e.onChange(c)}function s(){let a=ma(e.item);n([...t,a])}return r.jsxs(r.Fragment,{children:[t.map((a,o)=>r.jsx(va,{item:e.item,response:a,checkForQuestionEnabled:e.checkForQuestionEnabled,onChange:c=>i(c,o)},a.id)),e.item.repeats&&r.jsx(Y,{onClick:s,children:`Add Group: ${e.item.text}`})]})}function va(e){var a;let{response:t,checkForQuestionEnabled:n,onChange:i}=e;function s(o){var u,d;let c=(d=(u=t.item)==null?void 0:u.map(m=>o.find(f=>f.id===m.id)??m))==null?void 0:d.concat(o.slice(1)),l={...t,item:c};i([l])}return e.checkForQuestionEnabled(e.item)?r.jsxs("div",{children:[e.item.text&&r.jsx($,{order:3,mb:"md",children:e.item.text}),r.jsx(F,{children:(a=e.item.item)==null?void 0:a.map(o=>{var c,l,u;return o.type==="group"?o.repeats?r.jsx(xa,{item:o,response:((c=t.item)==null?void 0:c.filter(d=>d.linkId===o.linkId))??[],checkForQuestionEnabled:n,onChange:s},o.linkId):r.jsx(va,{item:o,checkForQuestionEnabled:n,response:((l=t.item)==null?void 0:l.find(d=>d.linkId===o.linkId))??{linkId:o.linkId},onChange:s},o.linkId):r.jsx(ya,{item:o,response:(u=t.item)==null?void 0:u.find(d=>d.linkId===o.linkId),onChange:s,checkForQuestionEnabled:n},o.linkId)})})]},e.item.linkId):null}function Um(e){let{items:t,response:n,activePage:i,onChange:s,nextStep:a,prevStep:o,numberOfPages:c,renderPages:l,submitButtonText:u,checkForQuestionEnabled:d}=e,m=t.map(f=>{var x;let p=((x=n==null?void 0:n.item)==null?void 0:x.filter(C=>C.linkId===f.linkId))??[],g=f.type==="group"?r.jsx(xa,{item:f,response:p,onChange:s,checkForQuestionEnabled:d},f.linkId):r.jsx(ya,{item:f,response:p==null?void 0:p[0],onChange:s,checkForQuestionEnabled:d},f.linkId);return l?r.jsx(Ur.Step,{label:f.text,children:g},f.linkId):g});return r.jsxs(r.Fragment,{children:[l&&r.jsx(Ur,{active:i??0,allowNextStepsSelect:!1,p:6,children:m}),!l&&r.jsx(F,{children:m}),r.jsx(Fm,{activePage:i??0,numberOfPages:c,nextStep:a,prevStep:o,submitButtonText:u})]})}function Fm(e){let t=e.activePage>0,n=e.activePage<e.numberOfPages-1,i=e.activePage===e.numberOfPages-1;return r.jsxs(D,{justify:"flex-end",mt:"xl",gap:"xs",children:[t&&r.jsx(O,{onClick:e.prevStep,children:"Back"}),n&&r.jsx(O,{onClick:s=>{s.currentTarget.closest("form").reportValidity()&&e.nextStep()},children:"Next"}),i&&r.jsx(O,{type:"submit",children:e.submitButtonText??"Submit"})]})}function ja(e){let t=L(),n=t.getProfile(),[i,s]=h.useState(!1),a=we(e.questionnaire),[o,c]=h.useState(),[l,u]=h.useState(0);h.useEffect(()=>{t.requestSchema("Questionnaire").then(()=>t.requestSchema("QuestionnaireResponse")).then(()=>s(!0)).catch(console.log)},[t]),h.useEffect(()=>{c(a?Sm(a):void 0)},[a]);function d(x){let C=(o==null?void 0:o.item)??[],j={resourceType:"QuestionnaireResponse",status:"in-progress",item:ba(C,Array.isArray(x)?x:[x])};c(j)}function m(x){return xm(x,(o==null?void 0:o.item)??[])}if(!i||!a||!o)return null;let f=Im(a),p=()=>u(x=>x+1),g=()=>u(x=>x-1);return r.jsx(fa.Provider,{value:{subject:e.subject,encounter:e.encounter},children:r.jsxs(Ae,{testid:"questionnaire-form",onSubmit:()=>{e.onSubmit&&o&&e.onSubmit({...o,questionnaire:Z(a),subject:e.subject,source:Le(n),authored:new Date().toISOString(),status:"completed"})},children:[a.title&&r.jsx($,{children:a.title}),r.jsx(Um,{items:a.item??[],response:o,onChange:d,renderPages:f>1,activePage:l,numberOfPages:f,submitButtonText:e.submitButtonText,checkForQuestionEnabled:m,nextStep:p,prevStep:g})]})})}function Bm(e,t){let n=ba(e.item??[],t.item??[]);return{...t,item:n.length>0?n:void 0,answer:t.answer&&t.answer.length>0?t.answer:e.answer}}function ba(e,t){let n=[],i=new Set;for(let s of e){let a=s.id,o=t.find(c=>c.id===a);o?(n.push(Bm(s,o)),i.add(o.id)):n.push(s)}for(let s of t)i.has(s.id)||n.push(s);return n}var Rn={container:"Scheduler_container",info:"Scheduler_info",selection:"Scheduler_selection"};function $m(e){var p;let t=we(e.schedule),n=we(e.questionnaire),[i,s]=h.useState(ea()),[a,o]=h.useState(),[c,l]=h.useState(),[u,d]=h.useState(),[m]=Ls("Slot",new URLSearchParams([["_count",(30*24).toString()],["schedule",pt(e.schedule)?e.schedule.reference:Z(e.schedule)],["start","gt"+qm(i)],["start","lt"+Vm(i)]]));if(!t||!m||!n)return null;let f=(p=t.actor)==null?void 0:p[0];return r.jsxs("div",{className:Rn.container,"data-testid":"scheduler",children:[r.jsxs("div",{className:Rn.info,children:[f&&r.jsx(Ge,{value:f,size:"xl"}),f&&r.jsx(T,{size:"xl",fw:500,children:r.jsx(jn,{value:f})}),r.jsx("p",{children:"1 hour"}),a&&r.jsx("p",{children:a.toLocaleDateString()}),c&&r.jsx("p",{children:Ri(new Date(c.start))})]}),r.jsxs("div",{className:Rn.selection,children:[!a&&r.jsxs("div",{children:[r.jsx("h3",{children:"Select date"}),r.jsx(fh,{slots:m,onChangeMonth:s,onClick:o})]}),a&&!c&&r.jsxs("div",{children:[r.jsx("h3",{children:"Select time"}),r.jsx(F,{children:m.map(g=>{let x=new Date(g.start);return x.getTime()>a.getTime()&&x.getTime()<a.getTime()+24*3600*1e3&&r.jsx("div",{children:r.jsx(O,{variant:"outline",style:{width:150},onClick:()=>l(g),children:Ri(x)})},g.id)})})]}),a&&c&&!u&&r.jsx(ja,{questionnaire:n,submitButtonText:"Next",onSubmit:d}),a&&c&&u&&r.jsxs("div",{children:[r.jsx("h3",{children:"You're all set!"}),r.jsx("p",{children:"Check your email for a calendar invite."})]})]})]})}function qm(e){return Ca(e.getTime())}function Vm(e){return Ca(e.getTime()+31*24*60*60*1e3)}function Ca(e){let t=new Date(Math.max(Date.now(),e));return t.setHours(0,0,0,0),t.toISOString()}function Ri(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function wa(e){let t=L(),[n,i]=h.useState();return r.jsxs(Ae,{onSubmit:async s=>{try{e.handleAuthResponse(await t.startNewProject({login:e.login,projectName:s.projectName}))}catch(a){i(he(a))}},children:[r.jsxs(fe,{style:{flexDirection:"column"},children:[r.jsx(wn,{size:32}),r.jsx($,{children:"Create project"})]}),r.jsxs(F,{gap:"xl",children:[r.jsx(W,{name:"projectName",label:"Project Name",placeholder:"My Project",required:!0,autoFocus:!0,error:He(n,"firstName")}),r.jsxs(T,{c:"dimmed",size:"xs",children:["By clicking submit you agree to the Medplum"," ",r.jsx(Y,{href:"https://www.medplum.com/privacy",children:"PrivacyPolicy"})," and ",r.jsx(Y,{href:"https://www.medplum.com/terms",children:"TermsofService"}),"."]})]}),r.jsx(D,{justify:"flex-end",mt:"xl",wrap:"nowrap",children:r.jsx(O,{type:"submit",children:"Create project"})})]})}function Sa(e,t){let n=document.getElementsByTagName("head")[0],i=document.createElement("script");i.async=!0,i.src=e,i.onload=t??null,n.appendChild(i)}function ka(e){let t=L(),{googleClientId:n,handleGoogleCredential:i}=e,s=h.useRef(null),[a,o]=h.useState(typeof google<"u"),[c,l]=h.useState(!1),[u,d]=h.useState(!1);return h.useEffect(()=>{if(typeof google>"u"){Sa("https://accounts.google.com/gsi/client",()=>o(!0));return}c||(google.accounts.id.initialize({client_id:n,callback:i}),l(!0)),s.current&&!u&&(google.accounts.id.renderButton(s.current,{}),d(!0))},[t,n,c,a,s,u,i]),n?r.jsx("div",{ref:s}):null}function Ea(e){if(e)return e;if(typeof window<"u"){let t=window.location.protocol+"//"+window.location.host;if(("undefined".split(",")??[]).includes(t))return"undefined"}}function zm(e){typeof grecaptcha>"u"&&Sa("https://www.google.com/recaptcha/api.js?render="+e)}function Hm(e){return new Promise((t,n)=>{grecaptcha.ready(async()=>{try{t(await grecaptcha.execute(e,{action:"submit"}))}catch(i){n(i)}})})}function Wm(e){let t=Ea(e.googleClientId),n=e.recaptchaSiteKey,i=L(),[s,a]=h.useState(),o=Sr(s,void 0);return h.useEffect(()=>{n&&zm(n)},[n]),r.jsxs(Ae,{onSubmit:async c=>{try{let l="";n&&(l=await Hm(n)),e.handleAuthResponse(await i.startNewUser({projectId:e.projectId,clientId:e.clientId,firstName:c.firstName,lastName:c.lastName,email:c.email,password:c.password,remember:c.remember==="true",recaptchaSiteKey:n,recaptchaToken:l}))}catch(l){a(he(l))}},children:[r.jsx(fe,{style:{flexDirection:"column"},children:e.children}),r.jsx(Sn,{issues:o}),t&&r.jsxs(r.Fragment,{children:[r.jsx(D,{justify:"center",p:"xl",style:{height:70},children:r.jsx(ka,{googleClientId:t,handleGoogleCredential:async c=>{try{e.handleAuthResponse(await i.startGoogleLogin({googleClientId:c.clientId,googleCredential:c.credential,projectId:e.projectId,createUser:!0}))}catch(l){a(he(l))}}})}),r.jsx(ht,{label:"or",labelPosition:"center",my:"lg"})]}),r.jsxs(F,{gap:"xl",children:[r.jsx(W,{name:"firstName",type:"text",label:"First name",placeholder:"First name",required:!0,autoFocus:!0,error:He(s,"firstName")}),r.jsx(W,{name:"lastName",type:"text",label:"Last name",placeholder:"Last name",required:!0,error:He(s,"lastName")}),r.jsx(W,{name:"email",type:"email",label:"Email",placeholder:"name@domain.com",required:!0,error:He(s,"email")}),r.jsx(Vi,{name:"password",label:"Password",autoComplete:"off",required:!0,error:He(s,"password")}),r.jsxs(T,{c:"dimmed",size:"xs",children:["By clicking submit you agree to the Medplum"," ",r.jsx(Y,{href:"https://www.medplum.com/privacy",children:"PrivacyPolicy"})," and ",r.jsx(Y,{href:"https://www.medplum.com/terms",children:"TermsofService"}),"."]}),r.jsxs(T,{c:"dimmed",size:"xs",children:["This site is protected by reCAPTCHA and the Google"," ",r.jsx(Y,{href:"https://policies.google.com/privacy",children:"PrivacyPolicy"})," and ",r.jsx(Y,{href:"https://policies.google.com/terms",children:"TermsofService"})," apply."]})]}),r.jsxs(D,{justify:"space-between",mt:"xl",wrap:"nowrap",children:[r.jsx(Bt,{name:"remember",label:"Remember me",size:"xs"}),r.jsx(O,{type:"submit",children:"Create account"})]})]})}function Qm(e){let{type:t,projectId:n,clientId:i,googleClientId:s,recaptchaSiteKey:a,onSuccess:o}=e,c=L(),[l,u]=h.useState(),[d,m]=h.useState();h.useEffect(()=>{t==="patient"&&l&&c.startNewPatient({login:l,projectId:n}).then(p=>c.processCode(p.code)).then(()=>o()).catch(p=>m(he(p)))},[c,t,n,l,o]);function f(p){p.code?c.processCode(p.code).then(()=>o()).catch(console.log):p.login&&u(p.login)}return r.jsxs(Ze,{width:450,children:[d&&r.jsx("pre",{children:JSON.stringify(d,null,2)}),!l&&r.jsx(Wm,{projectId:n,clientId:i,googleClientId:s,recaptchaSiteKey:a,handleAuthResponse:f,children:e.children}),l&&t==="project"&&r.jsx(wa,{login:l,handleAuthResponse:f})]})}function Gm(e){let[t,n]=h.useState();return t?r.jsx(Ym,{email:t,...e}):r.jsx(Jm,{setEmail:n,...e})}function Jm(e){let{setEmail:t,onRegister:n,handleAuthResponse:i,children:s,disableEmailAuth:a,...o}=e,c=L(),l=!e.disableGoogleAuth&&Ea(e.googleClientId),[u,d]=h.useState(),m=Sr(u,void 0),f=h.useCallback(async x=>{if(!x.authorizeUrl)return!1;let C=JSON.stringify({...await c.ensureCodeChallenge(o),domain:x.domain}),j=new URL(x.authorizeUrl);return j.searchParams.set("state",C),window.location.assign(j.toString()),!0},[c,o]),p=h.useCallback(async x=>{let C=await c.post("auth/method",{email:x.email});await f(C)||t(x.email)},[c,f,t]),g=h.useCallback(async x=>{try{let C=await c.startGoogleLogin({...o,googleCredential:x.credential});await f(C)||i(C)}catch(C){d(he(C))}},[c,o,f,i]);return r.jsxs(Ae,{onSubmit:p,children:[r.jsx(fe,{style:{flexDirection:"column"},children:s}),r.jsx(Sn,{issues:m}),l&&r.jsxs(r.Fragment,{children:[r.jsx(D,{justify:"center",p:"xl",style:{height:70},children:r.jsx(ka,{googleClientId:l,handleGoogleCredential:g})}),!a&&r.jsx(ht,{label:"or",labelPosition:"center",my:"lg"})]}),!a&&r.jsx(W,{name:"email",type:"email",label:"Email",placeholder:"name@domain.com",required:!0,autoFocus:!0,error:He(u,"email")}),r.jsxs(D,{justify:"space-between",mt:"xl",gap:0,wrap:"nowrap",children:[r.jsx("div",{children:n&&r.jsx(Y,{component:"button",type:"button",color:"dimmed",onClick:n,size:"xs",children:"Register"})}),!a&&r.jsx(O,{type:"submit",children:"Next"})]})]})}function Ym(e){let{onForgotPassword:t,handleAuthResponse:n,children:i,...s}=e,a=L(),[o,c]=h.useState(),l=Sr(o,void 0),u=h.useCallback(d=>{a.startLogin({...s,password:d.password,remember:d.remember==="on"}).then(n).catch(m=>c(he(m)))},[a,s,n]);return r.jsxs(Ae,{onSubmit:u,children:[r.jsx(fe,{style:{flexDirection:"column"},children:i}),r.jsx(Sn,{issues:l}),r.jsx(F,{gap:"xl",children:r.jsx(Vi,{name:"password",label:"Password",autoComplete:"off",required:!0,autoFocus:!0,error:He(o,"password")})}),r.jsxs(D,{justify:"space-between",mt:"xl",gap:0,wrap:"nowrap",children:[t&&r.jsx(Y,{component:"button",type:"button",c:"dimmed",onClick:t,size:"xs",children:"Forgot password"}),r.jsx(Bt,{id:"remember",name:"remember",label:"Remember me",size:"xs",style:{lineHeight:1}}),r.jsx(O,{type:"submit",children:"Sign in"})]})]})}function Zm(e){let t=L(),n=zi(),[i,s]=h.useState(""),[a,o]=h.useState();function c(m){var f;return!!((f=m==null?void 0:m.toLowerCase())!=null&&f.includes(i.toLowerCase()))}function l(m){var f,p;return c((f=m.profile)==null?void 0:f.display)||c((p=m.project)==null?void 0:p.display)}function u(m){t.post("auth/profile",{login:e.login,profile:m}).then(e.handleAuthResponse).catch(f=>o(he(f)))}let d=e.memberships.filter(l).slice(0,10).map(m=>r.jsx(de.Option,{value:m.id,children:r.jsx(Km,{...m})},m.id));return r.jsxs(F,{children:[r.jsxs(Hi,{gap:"md",mb:"md",justify:"center",align:"center",direction:"column",wrap:"nowrap",children:[r.jsx(wn,{size:32}),r.jsx($,{order:3,children:"Choose profile"})]}),r.jsx(Sn,{outcome:a}),r.jsxs(de,{store:n,onOptionSubmit:u,children:[r.jsx(de.EventsTarget,{children:r.jsx(W,{placeholder:"Search",value:i,onChange:m=>{s(m.currentTarget.value),n.updateSelectedOptionIndex()}})}),r.jsx("div",{children:r.jsx(de.Options,{children:d.length>0?d:r.jsx(de.Empty,{children:"Nothing found..."})})})]})]})}function Km(e){var t,n;return r.jsxs(D,{children:[r.jsx(en,{radius:"xl"}),r.jsxs("div",{children:[r.jsx(T,{fz:"sm",fw:500,children:(t=e.profile)==null?void 0:t.display}),r.jsx(T,{fz:"xs",opacity:.6,children:(n=e.project)==null?void 0:n.display})]})]})}function Xm(e){let t=L();return r.jsx(Ae,{onSubmit:n=>{t.post("auth/scope",{login:e.login,scope:Object.keys(n).join(" ")}).then(e.handleAuthResponse).catch(console.log)},children:r.jsxs(F,{children:[r.jsxs(fe,{style:{flexDirection:"column"},children:[r.jsx(wn,{size:32}),r.jsx($,{children:"Choose scope"})]}),r.jsx(F,{children:(e.scope??"openid").split(" ").map(n=>r.jsx(Bt,{id:n,name:n,label:n,defaultChecked:!0},n))}),r.jsx(D,{justify:"flex-end",mt:"xl",children:r.jsx(O,{type:"submit",children:"Set scope"})})]})})}function ef(e){let t=L(),[n,i]=h.useState();return r.jsx(Ae,{onSubmit:s=>{i(void 0),t.post("auth/mfa/verify",{login:e.login,token:s.token}).then(e.handleAuthResponse).catch(a=>i(be(a)))},children:r.jsxs(F,{children:[r.jsxs(fe,{style:{flexDirection:"column"},children:[r.jsx(wn,{size:32}),r.jsx($,{children:"Enter MFA code"})]}),n&&r.jsx(Ft,{icon:r.jsx(yr,{size:16}),title:"Error",color:"red",children:n}),r.jsx(F,{children:r.jsx(W,{name:"token",label:"MFA code",required:!0,autoFocus:!0})}),r.jsx(D,{justify:"flex-end",mt:"xl",children:r.jsx(O,{type:"submit",children:"Submit code"})})]})})}function tf(e){let{login:t,chooseScopes:n,onSuccess:i,onForgotPassword:s,onRegister:a,onCode:o,...c}=e,l=L(),[u,d]=h.useState(),m=h.useRef(!1),[f,p]=h.useState(!1),[g,x]=h.useState(),C=h.useCallback(y=>{o?o(y):l.processCode(y).then(()=>{i&&i()}).catch(v=>Ne({color:"red",message:be(v)}))},[l,o,i]),j=h.useCallback(y=>{p(!!y.mfaRequired),y.login&&d(y.login),y.memberships&&x(y.memberships),y.code&&(n?x(void 0):C(y.code))},[n,C]),w=h.useCallback(y=>{C(y.code)},[C]);return h.useEffect(()=>{t&&!m.current&&!u&&(m.current=!0,l.get("auth/login/"+t).then(j).catch(y=>Ne({color:"red",message:be(y)})))},[l,t,m,u,j]),r.jsx(Ze,{width:450,px:"sm",py:"md",children:u?f?r.jsx(ef,{login:u,handleAuthResponse:j}):g?r.jsx(Zm,{login:u,memberships:g,handleAuthResponse:j}):e.projectId==="new"?r.jsx(wa,{login:u,handleAuthResponse:j}):e.chooseScopes?r.jsx(Xm,{login:u,scope:e.scope,handleAuthResponse:w}):r.jsx("div",{children:"Success"}):r.jsx(Gm,{onForgotPassword:s,onRegister:a,handleAuthResponse:j,disableGoogleAuth:e.disableGoogleAuth,disableEmailAuth:e.disableEmailAuth,...c,children:e.children})})}var Pe={chatPaper:"BaseChat_chatPaper",chatTitle:"BaseChat_chatTitle",chatBody:"BaseChat_chatBody",chatScrollArea:"BaseChat_chatScrollArea",chatInputContainer:"BaseChat_chatInputContainer",chatBubbleOuterWrap:"BaseChat_chatBubbleOuterWrap",chatBubbleRightAlignedInnerWrap:"BaseChat_chatBubbleRightAlignedInnerWrap",chatBubbleLeftAlignedInnerWrap:"BaseChat_chatBubbleLeftAlignedInnerWrap",chatBubble:"BaseChat_chatBubble",chatBubbleName:"BaseChat_chatBubbleName",chatBubbleNameRight:"BaseChat_chatBubbleNameRight"};function Di(e){let t=new Date(e.sent??0),n=t.getMinutes().toString();return`${t.getHours()}:${n.length===1?"0":""}${n}`}function Ai(e,t,n){let i=[...e],s=!1;for(let a of t){let o=i.findIndex(c=>c.id===a.id);o!==-1?i[o]=a:(i.push(a),s=!0)}s&&i.sort((a,o)=>a.sent.localeCompare(o.sent)),n(i)}function nf(e){let{title:t,communications:n,setCommunications:i,query:s,sendMessage:a,onMessageReceived:o,inputDisabled:c,...l}=e,u=L(),d=h.useRef(null),m=h.useRef(null),[f,p]=h.useState(u.getProfile()),g=h.useMemo(()=>f?Z(u.getProfile()):"",[f,u]);$u(`Communication?${s}`,I=>{var Q,J;let N=(J=(Q=I.entry)==null?void 0:Q[1])==null?void 0:J.resource;Ai(w.current,[N],i),o&&Z(N.sender)!==g&&o(N)});let x=h.useCallback(I=>{c||(d.current&&(d.current.value=""),a(I.message),v.current=!0)},[c,a]);h.useEffect(()=>{let I=u.getProfile();(f==null?void 0:f.id)!==(I==null?void 0:I.id)&&(p(I),i([]))});let[C,j]=Fa(),w=h.useRef(n);w.current=n;let y=h.useRef(n),v=h.useRef(!0),A=h.useCallback(async()=>{let I=new URLSearchParams(s);I.append("_sort","-sent");let N=await u.searchResources("Communication",I,{cache:"no-cache"});Ai(w.current,N,i)},[u,i,s]);h.useEffect(()=>{A().catch(I=>Ne({color:"red",message:be(I)}))},[A]),h.useEffect(()=>{n!==y.current&&(v.current=!0),y.current=n},[n]),h.useEffect(()=>{var I;v.current&&((I=m.current)!=null&&I.scrollTo)&&(m.current.scrollTo({top:m.current.scrollHeight,behavior:"smooth"}),v.current=!1)});let M=h.useMemo(()=>{var N;let I=n.length;for(;I--;){let Q=n[I];if(((N=Q.sender)==null?void 0:N.reference)===g&&Q.received)return Q.id}return""},[n,g]);return f?r.jsxs(qn,{className:Pe.chatPaper,p:0,radius:"md",...l,children:[r.jsx($,{order:2,className:Pe.chatTitle,children:t}),r.jsx("div",{className:Pe.chatBody,ref:C,children:r.jsx(Wi,{viewportRef:m,className:Pe.chatScrollArea,h:j.height,children:n.map((I,N)=>{var pe,ge;let Q=N>0?n[N-1]:void 0,J=Q?Di(Q):void 0,K=Di(I);return r.jsxs(F,{align:"stretch",children:[(!J||K!==J)&&r.jsx("div",{style:{textAlign:"center"},children:K}),((pe=I.sender)==null?void 0:pe.reference)===g?r.jsxs(D,{justify:"flex-end",align:"flex-end",gap:"xs",mb:"sm",children:[r.jsx(Mi,{alignment:"right",communication:I,showDelivered:!!I.received&&I.id===M}),r.jsx(Ge,{radius:"xl",color:"orange",value:I.sender})]}):r.jsxs(D,{justify:"flex-start",align:"flex-end",gap:"xs",mb:"sm",children:[r.jsx(Ge,{radius:"xl",value:I.sender}),r.jsx(Mi,{alignment:"left",communication:I})]})]},`${I.id}--${((ge=I.meta)==null?void 0:ge.versionId)??"no-version"}`)})})}),r.jsx("div",{className:Pe.chatInputContainer,children:r.jsx(Ae,{onSubmit:x,children:r.jsx(W,{ref:d,name:"message",placeholder:c?"Replies are disabled":"Type a message...",radius:"xl",rightSectionWidth:42,disabled:c,rightSection:c?void 0:r.jsx($n,{type:"submit",size:"1.5rem",radius:"xl",color:"blue",variant:"filled","aria-label":"Send message",children:r.jsx(Gu,{size:"1rem",stroke:1.5})})})})})]}):null}function Mi(e){var c,l;let{communication:t,alignment:n,showDelivered:i}=e,s=((l=(c=t.payload)==null?void 0:c[0])==null?void 0:l.contentString)||"",a=new Date(t.received??-1),o=we(t.sender);return r.jsxs("div",{className:Pe.chatBubbleOuterWrap,children:[r.jsx("div",{className:xn(Pe.chatBubbleName,n==="right"&&Pe.chatBubbleNameRight),"aria-label":"Sender name",children:o?Et(o):"[Unknown sender]"}),r.jsx("div",{className:n==="left"?Pe.chatBubbleLeftAlignedInnerWrap:Pe.chatBubbleRightAlignedInnerWrap,children:r.jsx("div",{className:Pe.chatBubble,children:s})}),i&&r.jsxs("div",{style:{textAlign:"right"},children:["Delivered ",a.getHours(),":",a.getMinutes().toString().length===1?"0":"",a.getMinutes()]})]})}/*! Bundled license information:

@tabler/icons-react/dist/esm/defaultAttributes.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/createReactComponent.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconAdjustmentsHorizontal.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconAlertCircle.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconArrowDown.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconArrowRight.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconArrowUp.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconBleachOff.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconBleach.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconBoxMultiple.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconBracketsContain.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconBucketOff.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconBucket.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconCalendar.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconCheck.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconCheckbox.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconChevronDown.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconChevronUp.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconCircleMinus.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconCirclePlus.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconCloudUpload.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconColumns.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconCopy.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconCurrencyDollar.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconDots.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconEdit.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconEqualNot.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconEqual.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconFileAlert.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconFilePlus.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconFilter.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconGenderFemale.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconGenderMale.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconLogout.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconMathGreater.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconMathLower.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconMessage.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconPlus.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconRefresh.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconSearch.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconSettings.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconSortAscending.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconSortDescending.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconSquare.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconStethoscope.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconSwitchHorizontal.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconTableExport.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconTrash.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconUserSquare.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/icons/IconX.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)

@tabler/icons-react/dist/esm/tabler-icons-react.mjs:
  (**
   * @license @tabler/icons-react v3.11.0 - MIT
   *
   * This source code is licensed under the MIT license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/const rf="_container_13cku_1",sf="_title_13cku_7",af="_link_13cku_12",of="_linkIcon_13cku_28",cf="_linkActive_13cku_33",Ot={container:rf,title:sf,link:af,linkIcon:of,linkActive:cf};function Ar(e){return r.jsxs("div",{className:Ot.container,children:[r.jsx($,{order:4,className:Ot.title,children:e.title}),e.menu.map(t=>{var n;return r.jsxs(h.Fragment,{children:[r.jsx(zr,{to:t.href,end:!0,className:({isActive:i})=>zn(Ot.link,i&&Ot.linkActive),children:r.jsx("span",{children:t.name})}),(n=t.subMenu)==null?void 0:n.map(i=>r.jsx("div",{style:{paddingLeft:20},children:r.jsx(zr,{to:i.href,className:Ot.link,children:r.jsx("span",{children:i.name})})},i.href))]},t.href)})]})}const lf={title:"Account",menu:[{name:"Profile",href:"/account/profile"},{name:"Provider",href:"/account/provider"},{name:"Membership & Billing",href:"/account/membership-and-billing"}]};function uf(){return r.jsx(se,{children:r.jsxs(D,{align:"top",children:[r.jsx(Ar,{...lf}),r.jsx("div",{style:{width:800,flex:800},children:r.jsx(h.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Vn,{})})})]})})}const df="_button_1sozr_1",hf={button:df};function It(e){return r.jsx(dt,{className:hf.button,onClick:e.onClick,children:r.jsx(D,{justify:"space-between",children:e.children})})}const mf="_titleSection_1f28q_1",ff="_title_1f28q_1",_i={titleSection:mf,title:ff};function ae({title:e,children:t,onButtonClick:n,id:i=""}){return r.jsxs(Ke,{withBorder:!0,radius:"md",shadow:"sm",p:"xl",mb:"xl",w:"100%",children:[e&&r.jsxs(Ke.Section,{className:_i.titleSection,children:[r.jsx($,{order:4,className:_i.title,children:e}),n&&r.jsx(Va,{onClick:()=>n(i)})]}),t]})}function pf({coverages:e}){return r.jsxs(P,{children:[r.jsx(P.Thead,{children:r.jsxs(P.Tr,{children:[r.jsx(P.Th,{children:"Payor Name"}),r.jsx(P.Th,{children:"Subscriber ID"}),r.jsx(P.Th,{children:"Relationship to Subscriber"})]})}),r.jsx(P.Tbody,{children:e.map(t=>{var n,i,s;return r.jsxs(P.Tr,{children:[r.jsx(P.Td,{children:(n=t.payor)==null?void 0:n[0].display}),r.jsx(P.Td,{children:t.subscriberId||"-"}),r.jsx(P.Td,{children:at((s=(i=t.relationship)==null?void 0:i.coding)==null?void 0:s[0])||"-"})]},t.id)})})]})}function gf(){const e=L(),t=e.getProfile(),n=e.searchResources("Coverage",{beneficiary:Z(t)}).read(),i=e.searchResources("PaymentNotice").read();return r.jsxs(B,{p:"xl",children:[r.jsx($,{mb:"xl",children:"Membership & Billing"}),r.jsx(ae,{title:"Coverage",children:n.length===0?r.jsx(B,{p:"xl",children:"No coverage"}):r.jsx(F,{gap:0,children:r.jsx(pf,{coverages:n})})}),r.jsx(ae,{title:"Payments",children:i.length===0?r.jsx(B,{p:"xl",children:"No payments"}):r.jsx(F,{gap:0,children:i.map(s=>r.jsx(It,{children:s.id},s.id))})})]})}function yf(){var l,u,d,m,f,p;const e=L(),[t,n]=h.useState(e.getProfile()),[i,s]=h.useState(!1),[a,o]=h.useState(((l=t.address)==null?void 0:l[0])||{});async function c(g){s(!0);const x={...t,name:[{use:"official",given:[g.givenName],family:g.familyName}],birthDate:g.birthDate,gender:g.gender,address:[a]},C=await e.updateResource(x).then(j=>(Ne({icon:r.jsx(Zi,{}),title:"Success",message:"Profile edited"}),window.scrollTo(0,0),j)).catch(j=>{Ne({color:"red",icon:r.jsx(tn,{}),title:"Error",message:be(j)})});C&&n(C),s(!1)}return r.jsxs(B,{p:"xl",pos:"relative",children:[r.jsx(za,{visible:i}),r.jsx(Ae,{onSubmit:c,children:r.jsxs(F,{align:"center",children:[r.jsx(Ge,{size:200,radius:100,value:t}),r.jsx($,{order:2,children:Vt((u=t.name)==null?void 0:u[0])}),r.jsx(ae,{title:"Personal Information",children:r.jsx(B,{p:"xl",children:r.jsxs(F,{children:[r.jsx(W,{label:"First Name",name:"givenName",defaultValue:er((d=t.name)==null?void 0:d[0])}),r.jsx(W,{label:"Last Name",name:"familyName",defaultValue:ps((m=t.name)==null?void 0:m[0])}),r.jsx(tt,{label:"Gender",name:"gender",defaultValue:t.gender,data:["","female","male","other","unknown"]}),r.jsx(W,{label:"Birth Date",name:"birthDate",type:"date",defaultValue:t.birthDate}),r.jsx(O,{type:"submit",mr:"auto",children:"Save"})]})})}),r.jsx(ae,{title:"Contact Information",children:r.jsx(B,{p:"xl",children:r.jsxs(F,{children:[r.jsx(W,{label:"Email",name:"email",defaultValue:(p=(f=t.telecom)==null?void 0:f.find(g=>g.system==="email"))==null?void 0:p.value,disabled:!0}),r.jsxs(F,{gap:0,children:[r.jsx(Ha,{htmlFor:"address",children:"Address"}),r.jsx(Hu,{name:"address",path:"Patient.address",defaultValue:a,onChange:g=>o(g)})]}),r.jsx(O,{type:"submit",mr:"auto",children:"Save"})]})})})]})})]})}function xf(){const t=L().getProfile();return t.generalPractitioner&&t.generalPractitioner.length>0?r.jsxs(B,{p:"xl",children:[r.jsx($,{mb:"lg",children:"My Provider"}),r.jsx(ae,{title:"My Primary Care Provider",children:r.jsx(B,{p:"xl",children:r.jsxs(F,{align:"center",children:[r.jsx(Ge,{size:200,radius:100,value:t.generalPractitioner[0]}),r.jsx($,{order:2,children:r.jsx(jn,{value:t.generalPractitioner[0]})}),r.jsx(O,{size:"lg",children:"Choose a Primary Care Provider"})]})})})]}):r.jsxs(B,{p:"xl",children:[r.jsx($,{mb:"lg",children:"Choose a provider"}),r.jsx(ae,{title:"My Primary Care Provider",children:"TODO"})]})}function Rt(){return r.jsx(fe,{style:{width:"100%",height:"300px"},children:r.jsx(un,{})})}const vf={title:"Care Plan",menu:[{name:"Action Items",href:"/care-plan/action-items"}]};function jf(){return r.jsx(se,{children:r.jsxs(D,{align:"top",children:[r.jsx(Ar,{...vf}),r.jsx("div",{style:{width:800,flex:800},children:r.jsx(h.Suspense,{fallback:r.jsx(Rt,{}),children:r.jsx(Vn,{})})})]})})}function bf(){const e=L(),{itemId:t}=Je(),n=e.readResource("CarePlan",t).read();return r.jsxs(B,{p:"xl",children:[r.jsx($,{order:2,mb:"md",children:n.title}),r.jsx(ae,{title:"Action Item",children:r.jsx(bn,{value:n,ignoreMissingValues:!0})})]})}function Cf(){const e=Fe(),t=Se(),n=L(),i=n.getProfile(),s=n.searchResources("CarePlan","subject="+Z(i)).read();return r.jsxs(B,{p:"xl",children:[r.jsx($,{mb:"lg",children:"Action Items"}),r.jsx(ae,{title:"Action Items",children:r.jsx(F,{gap:0,children:s.map(a=>{var o,c;return r.jsxs(It,{onClick:()=>t(`./${a.id}`),children:[r.jsxs("div",{children:[r.jsx(T,{c:e.primaryColor,fw:500,children:a.title}),r.jsxs(T,{mt:"sm",c:"gray.5",style:{display:"flex",alignItems:"center",gap:4},children:[r.jsx(Ki,{size:16}),r.jsxs("time",{children:[ft((o=a.period)==null?void 0:o.start)," "]}),((c=a.period)==null?void 0:c.end)&&r.jsxs("time",{children:["-",ft(a.period.end)]})]})]}),r.jsx(kr,{status:a.status})]},a.id)})})})]})}function wf(){const t=L().searchOne("Schedule").read();return r.jsx(Ze,{width:800,children:r.jsx($m,{schedule:t,questionnaire:{resourceType:"Questionnaire",status:"active",name:"Test",item:[{id:"id-1",linkId:"q1",type:"string",text:"Question 1"},{id:"id-2",linkId:"q2",type:"string",text:"Question 2"},{id:"id-3",linkId:"q3",type:"string",text:"Question 3"}]}})})}const jt="rgba(29, 112, 214, 0.7)",bt="rgba(29, 112, 214, 1)",Sf="rgba(255, 119, 0, 0.7)",kf="rgba(255, 119, 0, 1)",Ta={"blood-pressure":{id:"blood-pressure",code:"85354-9",title:"Blood Pressure",description:"Your blood pressure is the pressure exerted on the walls of your blood vessels. When this pressure is high, it can damage your blood vessels and increase your risk for a heart attack or stroke. We measure your blood pressure periodically to make sure it is not staying high. Hypertention is a condition that refers to consistantly high blood pressure.",chartDatasets:[{label:"Diastolic",code:"8462-4",unit:"mm[Hg]",backgroundColor:Sf,borderColor:kf},{label:"Systolic",code:"8480-6",unit:"mm[Hg]",backgroundColor:jt,borderColor:bt}]},"body-temperature":{id:"body-temperature",code:"8310-5",title:"Body Temperature",description:"Your body temperature values",chartDatasets:[{label:"Body Temperature",unit:"C",backgroundColor:jt,borderColor:bt}]},height:{id:"height",code:"8302-2",title:"Height",description:"Your height values",chartDatasets:[{label:"Height",unit:"in",backgroundColor:jt,borderColor:bt}]},"respiratory-rate":{id:"respiratory-rate",code:"9279-1",title:"Respiratory Rate",description:"Your respiratory rate values",chartDatasets:[{label:"Respiratory Rate",unit:"breaths/minute",backgroundColor:jt,borderColor:bt}]},"heart-rate":{id:"heart-rate",code:"8867-4",title:"Heart Rate",description:"Your heart rate values",chartDatasets:[{label:"Heart Rate",unit:"beats/minute",backgroundColor:jt,borderColor:bt}]},weight:{id:"weight",code:"29463-7",title:"Weight",description:"Your weight values",chartDatasets:[{label:"Weight",unit:"lbs",backgroundColor:jt,borderColor:bt}]}},Ef={title:"Health Record",menu:[{name:"Lab Results",href:"/health-record/lab-results"},{name:"Medications",href:"/health-record/medications"},{name:"Questionnaire Responses",href:"/health-record/questionnaire-responses"},{name:"Vaccines",href:"/health-record/vaccines"},{name:"Vitals",href:"/health-record/vitals",subMenu:Object.values(Ta).map(({title:e,id:t})=>({name:e,href:`/health-record/vitals/${t}`}))}]};function Tf(){return r.jsx(se,{children:r.jsxs(D,{align:"top",children:[r.jsx(Ar,{...Ef}),r.jsx("div",{style:{width:800,flex:800},children:r.jsx(h.Suspense,{fallback:r.jsx(Rt,{}),children:r.jsx(Vn,{})})})]})})}function Pf(){const e=L(),{resultId:t=""}=Je(),n=e.readResource("DiagnosticReport",t).read();return r.jsx(B,{p:"xl",children:r.jsx(ae,{children:r.jsx(ia,{value:n})})})}function If(){const e=Fe(),t=Se(),n=L(),i=n.getProfile(),s=n.searchResources("DiagnosticReport","subject="+Z(i)).read();return r.jsxs(B,{p:"xl",children:[r.jsx($,{mb:"lg",children:"Lab Results"}),r.jsx(ae,{title:"Lab Results",children:r.jsx(F,{gap:0,children:s.map(a=>{var o,c;return r.jsxs(It,{onClick:()=>t(`./${a.id}`),children:[r.jsxs("div",{children:[r.jsx(T,{fw:500,mb:4,children:ft((o=a.meta)==null?void 0:o.lastUpdated)}),r.jsx(T,{children:(c=a.code)==null?void 0:c.text})]}),r.jsx(Hn,{color:e.colors.gray[5]})]},a.id)})})})]})}const Rf="modulepreload",Df=function(e){return"/medplum/"+e},Oi={},Li=function(t,n,i){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.all(n.map(c=>{if(c=Df(c),c in Oi)return;Oi[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":Rf,l||(d.as="script",d.crossOrigin=""),d.href=c,o&&d.setAttribute("nonce",o),document.head.appendChild(d),l)return new Promise((m,f)=>{d.addEventListener("load",m),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}return s.then(()=>t()).catch(a=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a})},Af={responsive:!0,scales:{y:{min:0}},plugins:{legend:{position:"bottom"}}},Mf=h.lazy(async()=>{const{CategoryScale:e,Chart:t,Legend:n,LinearScale:i,LineElement:s,PointElement:a,Title:o,Tooltip:c}=await Li(async()=>{const{CategoryScale:u,Chart:d,Legend:m,LinearScale:f,LineElement:p,PointElement:g,Title:x,Tooltip:C}=await import("./chart.js-DKzgItnz.js");return{CategoryScale:u,Chart:d,Legend:m,LinearScale:f,LineElement:p,PointElement:g,Title:x,Tooltip:C}},__vite__mapDeps([0,1]));t.register(e,i,a,s,o,c,n);const{Line:l}=await Li(async()=>{const{Line:u}=await import("./react-chartjs-2-O1y0Ls0q.js");return{Line:u}},__vite__mapDeps([2,3,4,0,1]));return{default:l}});function _f({chartData:e}){return r.jsx("div",{className:"my-5",children:r.jsx(h.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(Mf,{options:Af,data:e})})})}function Of(){const{measurementId:e}=Je(),{code:t,title:n,description:i,chartDatasets:s}=Ta[e],a=L(),o=a.getProfile(),[c,l]=h.useState(!1),[u,d]=h.useState(),m=a.searchResources("Observation",`code=${t}&patient=${Z(o)}`).read();h.useEffect(()=>{var p,g;if(m){const x=[],C=s.map(j=>({...j,data:[]}));for(const j of m)if(x.push(ft(j.effectiveDateTime)),s.length===1)C[0].data.push((p=j.valueQuantity)==null?void 0:p.value);else for(let w=0;w<s.length;w++)C[w].data.push((g=j.component[w].valueQuantity)==null?void 0:g.value);d({labels:x,datasets:C})}},[s,m]);function f(p){console.log(p);const g={resourceType:"Observation",status:"preliminary",subject:Le(o),effectiveDateTime:new Date().toISOString(),code:{coding:[{code:t,display:n,system:"http://loinc.org"}],text:n}};s.length===1?g.valueQuantity={value:parseFloat(p[s[0].label]),system:"http://unitsofmeasure.org",unit:s[0].unit,code:s[0].unit}:g.component=s.map(x=>({code:{coding:[{code:"8462-4",display:"Diastolic Blood Pressure",system:"http://loinc.org"}],text:x.label},valueQuantity:{value:parseFloat(p[x.label]),system:"http://unitsofmeasure.org",unit:x.unit,code:x.unit}})),a.createResource(g).then(()=>l(!1)).catch(console.error)}return r.jsxs(Ze,{children:[r.jsxs(D,{justify:"space-between",mb:"xl",children:[r.jsx($,{order:1,children:n}),r.jsx(O,{onClick:()=>l(!0),children:"Add Measurement"})]}),u&&r.jsx(_f,{chartData:u}),r.jsx(B,{my:"xl",children:r.jsx(Ft,{icon:r.jsx(ro,{size:16}),title:"What is this measurement?",color:"gray",radius:"md",children:i})}),(m==null?void 0:m.length)&&r.jsxs(P,{children:[r.jsx(P.Thead,{children:r.jsxs(P.Tr,{children:[r.jsx(P.Th,{children:"Date"}),r.jsx(P.Th,{children:"Your Value"})]})}),r.jsx(P.Tbody,{children:m.map(p=>r.jsxs(P.Tr,{children:[r.jsx(P.Td,{children:Ce(p.effectiveDateTime)}),r.jsx(P.Td,{children:mn(p)})]},p.id))})]}),r.jsx(kt,{size:"lg",opened:c,onClose:()=>l(!1),title:n,children:r.jsx(Ae,{onSubmit:f,children:r.jsxs(F,{gap:"md",children:[r.jsx(D,{grow:!0,wrap:"nowrap",children:s.map(p=>r.jsx(Wa,{label:p.label,name:p.label},p.label))}),r.jsx(D,{justify:"flex-end",children:r.jsx(O,{type:"submit",children:"Add"})})]})})})]})}function Lf(){var a;const e=L(),[t,n]=h.useState(!1),{medicationId:i=""}=Je(),s=e.readResource("MedicationRequest",i).read();return r.jsxs(B,{p:"xl",children:[r.jsx($,{order:2,children:(a=s.medicationCodeableConcept)==null?void 0:a.text}),r.jsx("p",{className:"mb-6 text-lg text-gray-600",children:"To refill this medication, please contact your pharmacy."}),r.jsxs("p",{className:"mb-6 text-lg text-gray-600",children:["No more refills available at your pharmacy?"," ",r.jsx(Y,{onClick:()=>n(!0),children:"Renew your prescription"})]}),r.jsx(ae,{title:"Medication",children:r.jsx(bn,{value:s,ignoreMissingValues:!0})}),r.jsx(Nf,{prev:s,opened:t,setOpened:n})]})}function Nf({prev:e,opened:t,setOpened:n}){var a,o,c,l;const s=L().getProfile();return r.jsx(kt,{size:"lg",opened:t,onClose:()=>n(!1),title:r.jsx($,{order:3,children:"Request a Renewal"}),children:r.jsxs(F,{gap:"md",children:[r.jsx(Lt,{name:"Patient",value:Vt((a=s==null?void 0:s.name)==null?void 0:a[0])}),r.jsx(Lt,{name:"Last Prescribed",value:Ce(e.authoredOn)}),r.jsx(Lt,{name:"Status",value:e.status}),r.jsx(Lt,{name:"Medication",value:(o=e.medicationCodeableConcept)==null?void 0:o.text}),r.jsx(Lt,{name:"Dosage Instructions",value:((l=(c=e.dosageInstruction)==null?void 0:c[0])==null?void 0:l.timing)&&gs(e.dosageInstruction[0].timing)}),r.jsx(O,{onClick:()=>n(!1),children:"Submit Renewal Request"})]})})}function Lt({name:e,value:t}){return r.jsxs("div",{children:[r.jsx(T,{size:"xs",color:"gray",tt:"uppercase",children:e}),r.jsx(T,{size:"lg",fw:500,children:t})]})}function Uf(){const e=Fe(),t=Se(),n=L(),i=n.getProfile(),s=n.searchResources("MedicationRequest","patient="+Z(i)).read();return r.jsxs(B,{p:"xl",children:[r.jsx($,{mb:"lg",children:"Medications"}),r.jsx(ae,{title:"Medications",children:r.jsx(F,{gap:0,children:s.map(a=>{var o,c;return r.jsxs(It,{onClick:()=>t(`./${a.id}`),children:[r.jsxs("div",{children:[r.jsx(T,{c:e.primaryColor,fw:500,mb:4,children:(o=a==null?void 0:a.medicationCodeableConcept)==null?void 0:o.text}),r.jsx(T,{c:"gray.6",children:(c=a.requester)==null?void 0:c.display})]}),r.jsx(Hn,{color:e.colors.gray[5]})]},a.id)})})})]})}function Ff(){const e=L(),t=Fe(),n=Se(),i=yn(),s=e.searchResources("QuestionnaireResponse",`source=${Z(i)}&_sort=-authored`).read();return r.jsxs(B,{p:"xl",children:[r.jsx($,{mb:"lg",children:"Questionnaire Responses"}),r.jsx(ae,{title:"Questionnaire Responses",children:r.jsx(F,{gap:0,children:s.map(a=>r.jsxs(It,{onClick:()=>n(`./${a.id}`),children:[r.jsx("div",{children:r.jsx(T,{c:t.primaryColor,fw:500,mb:4,children:Ce(a.authored)})}),r.jsx(Hn,{color:t.colors.gray[5]})]},a.id))})})]})}function Bf(){const e=L(),{responseId:t}=Je(),n=e.searchOne("QuestionnaireResponse",`_id=${t}`).read(),i=(n==null?void 0:n.item)||[];return r.jsx(B,{p:"xl",children:r.jsx(qn,{children:r.jsx(F,{children:i.map(s=>r.jsx(Pa,{item:s,order:4},s.id))})})})}function Pa({item:e,order:t}){const{text:n,answer:i,item:s}=e;return r.jsxs(F,{children:[r.jsx($,{order:t,children:n}),r.jsx(F,{children:i&&i.length>0?r.jsx($f,{answer:i[0]},i[0].id):s==null?void 0:s.map(a=>r.jsx(Pa,{item:a,order:Math.min(t+1,6)},a.id))},e.linkId)]})}function $f({answer:e}){if(!e)throw new Error("No answer");const[[t,n]]=Object.entries(e);switch(t){case"valueInteger":return r.jsx("p",{children:n});case"valueQuantity":return r.jsx(on,{value:n});case"valueString":return r.jsx("p",{children:n});case"valueCoding":return r.jsx(Ut,{value:{coding:[n]}});case"valueRange":return r.jsx(Cr,{value:n});case"valueDateTime":return r.jsx("p",{children:ft(n)});case"valueBoolean":return r.jsx("p",{children:n?"True":"False"});default:return r.jsx("p",{children:n.toString()})}}function qf(){var i;const e=L(),{vaccineId:t=""}=Je(),n=e.readResource("Immunization",t).read();return r.jsxs(B,{p:"xl",children:[r.jsx($,{order:2,mb:"md",children:(i=n.vaccineCode)==null?void 0:i.text}),r.jsx(ae,{title:"Vaccine",children:r.jsx(bn,{value:n,ignoreMissingValues:!0})})]})}const Vf="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2018.0.0,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20version='1.1'%20id='Capa_1'%20xmlns='http://www.w3.org/2000/svg'%20x='0px'%20y='0px'%20viewBox='0%200%2054.759%2054.759'%20style='enable-background:new%200%200%2054.759%2054.759;'%20xml:space='preserve'%3e%3cg%3e%3cpath%20fill='%230d9488'%20d='M50.491,21.652L38.085,3.484c-1.2-1.758-3.021-2.945-5.126-3.342c-2.105-0.398-4.233,0.046-5.991,1.247%20s-2.945,3.021-3.342,5.126c-0.397,2.105,0.046,4.233,1.247,5.991l12.406,18.168c1.2,1.758,3.021,2.945,5.126,3.342%20c0.503,0.095,1.008,0.142,1.508,0.142c1.593,0,3.145-0.475,4.483-1.389C52.038,30.283,52.978,25.295,50.491,21.652z%20M25.591,6.886%20c0.298-1.58,1.187-2.946,2.504-3.845c1.001-0.684,2.165-1.039,3.359-1.039c0.376,0,0.756,0.035,1.134,0.106%20c1.58,0.298,2.946,1.187,3.845,2.504l5.075,7.432l-9.91,6.767l-5.075-7.433C25.624,10.062,25.293,8.466,25.591,6.886z%20M47.268,31.119c-1.318,0.899-2.915,1.229-4.493,0.933c-1.58-0.298-2.946-1.187-3.845-2.504l-6.203-9.084l9.91-6.767l6.203,9.084%20C50.705,25.512,50,29.253,47.268,31.119z'/%3e%3cpath%20fill='%230d9488'%20d='M41.823,38.814l-13.629-1.623l3.043-3.565c2.864-3.355,2.464-8.415-0.891-11.279c-1.619-1.382-3.687-2.048-5.823-1.882%20c-2.136,0.169-4.073,1.154-5.456,2.773L4.784,39.971c-1.382,1.62-2.05,3.688-1.882,5.823c0.169,2.136,1.154,4.073,2.773,5.456%20c1.455,1.242,3.272,1.908,5.175,1.908c0.215,0,0.431-0.009,0.648-0.026c1.593-0.126,3.075-0.706,4.299-1.665%20c0.729,0.325,1.495,0.54,2.288,0.634l21.846,2.601c0.32,0.038,0.637,0.057,0.951,0.057c3.992,0,7.455-2.995,7.938-7.055%20C49.343,43.323,46.203,39.335,41.823,38.814z%20M20.589,24.537c1.035-1.213,2.488-1.951,4.092-2.078%20c0.163-0.013,0.326-0.02,0.487-0.02c1.428,0,2.79,0.499,3.879,1.429c2.517,2.148,2.816,5.943,0.668,8.459l-5.843,6.845%20l-9.127-7.791L20.589,24.537z%20M6.974,49.728c-2.517-2.148-2.816-5.942-0.668-8.458l7.141-8.366l9.127,7.791l-7.141,8.366%20c0,0-0.001,0.001-0.001,0.001c-0.148,0.173-0.305,0.333-0.467,0.485l-0.008,0.008C12.757,51.605,9.314,51.725,6.974,49.728z%20M17.336,49.911l9.297-10.892l4.03,0.48l-1.418,11.916l-10.923-1.301C17.987,50.075,17.658,50.007,17.336,49.911z%20M46.835,47.467%20c-0.391,3.285-3.377,5.644-6.667,5.249l-8.936-1.064l1.418-11.916l8.937,1.064c1.584,0.188,3.004,0.988,3.999,2.251%20S47.024,45.883,46.835,47.467z'/%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3c/svg%3e";function zf(){const e=L(),t=e.getProfile(),n=e.searchResources("Immunization","patient="+Z(t)).read(),i=new Date().toISOString(),s=n.filter(o=>o.occurrenceDateTime&&o.occurrenceDateTime>i),a=n.filter(o=>!o.occurrenceDateTime||o.occurrenceDateTime<=i);return r.jsxs(B,{p:"xl",children:[r.jsx($,{mb:"lg",children:"Vaccines"}),r.jsx(ae,{title:"Active upcoming vaccines",children:s.length===0?r.jsx(B,{p:"xl",style:{textAlign:"center"},children:r.jsxs(F,{align:"center",w:500,m:"auto",children:[r.jsx("img",{src:Vf,width:160,height:160}),r.jsx($,{order:2,fw:900,children:"No upcoming vaccines available"}),r.jsxs(T,{c:"gray",children:["If you think you're missing upcoming vaccines that should be here, please"," ",r.jsx(Y,{href:"#",children:"contact our medical team"}),"."]})]})}):r.jsx(Ni,{vaccines:s})}),a.length>0&&r.jsx(ae,{title:"Past vaccines",children:r.jsx(Ni,{vaccines:a})})]})}function Ni({vaccines:e}){return r.jsx(F,{gap:0,children:e.map(t=>r.jsx(Hf,{vaccine:t},t.id))})}function Hf({vaccine:e}){var i,s;const t=Fe(),n=Se();return r.jsxs(It,{onClick:()=>n(`./${e.id}`),children:[r.jsxs("div",{children:[r.jsx(T,{c:t.primaryColor,fw:500,mb:8,children:(i=e.vaccineCode)==null?void 0:i.text}),r.jsxs(T,{c:"gray.6",children:[r.jsx(io,{size:16,style:{marginRight:4}}),(s=e.location)==null?void 0:s.display]})]}),r.jsxs("div",{children:[r.jsx(kr,{status:e.status}),e.occurrenceDateTime&&r.jsxs(T,{c:"gray.6",children:[r.jsx(Ki,{size:16,style:{marginRight:4}}),r.jsx("time",{dateTime:e.occurrenceDateTime,children:ft(e.occurrenceDateTime)})]})]})]})}function Wf(){const e=L(),t=e.getProfile(),n=e.searchResources("Observation","patient="+Z(t)).read();return r.jsxs(Ze,{children:[r.jsx($,{children:"Vitals"}),r.jsxs(P,{children:[r.jsx(P.Thead,{children:r.jsxs(P.Tr,{children:[r.jsx(P.Th,{children:"Measurement"}),r.jsx(P.Th,{children:"Your Value"}),r.jsx(P.Th,{children:"Last Updated"})]})}),r.jsx(P.Tbody,{children:n.map(i=>{var s,a,o,c;return r.jsxs(P.Tr,{children:[r.jsx(P.Td,{children:(o=(a=(s=i.code)==null?void 0:s.coding)==null?void 0:a[0])==null?void 0:o.display}),r.jsx(P.Td,{children:mn(i)}),r.jsx(P.Td,{children:ft((c=i.meta)==null?void 0:c.lastUpdated)})]},i.id)})})]})]})}const Qf="/medplum/assets/doctor-D5ohnsoZ.svg",Gf="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2019.0.0,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20x='0px'%20y='0px'%20viewBox='0%200%20309.267%20309.267'%20style='enable-background:new%200%200%20309.267%20309.267;'%20xml:space='preserve'%3e%3cg%3e%3cpath%20style='fill:%23D0994B;'%20d='M280.273,120.972V62.82c0-10.67-8.659-19.329-19.329-19.329H125.64c0,0-18.324-28.994-28.994-28.994%20H48.323c-10.67,0-19.329,8.65-19.329,19.329v87.146H280.273z'/%3e%3cpath%20style='fill:%23E4E7E7;'%20d='M28.994,72.484h251.279V149.8H28.994V72.484z'/%3e%3cpath%20style='fill:%233DB39E;'%20d='M251.279,178.794c32.028,0,57.988,25.969,57.988,57.988c0,32.009-25.959,57.988-57.988,57.988%20c-32.009,0-57.988-25.978-57.988-57.988C193.292,204.764,219.27,178.794,251.279,178.794z'/%3e%3cpath%20style='fill:%23FFFFFF;'%20d='M270.609,227.117h-9.665v-9.665c0-5.345-4.32-9.665-9.665-9.665s-9.665,4.32-9.665,9.665v9.665%20h-9.665c-5.345,0-9.665,4.32-9.665,9.665c0,5.354,4.32,9.665,9.665,9.665h9.665v9.665c0,5.354,4.32,9.665,9.665,9.665%20s9.665-4.31,9.665-9.665v-9.665h9.665c5.345,0,9.665-4.31,9.665-9.665C280.273,231.438,275.953,227.117,270.609,227.117z'/%3e%3cpath%20style='fill:%23F4B459;'%20d='M179.597,236.783c0-39.586,32.106-71.682,71.682-71.682c19.126,0,36.455,7.538,49.318,19.754%20l8.669-73.712c0-10.679-8.659-19.329-19.329-19.329H19.329C8.659,91.814,0,100.463,0,111.143l19.329,164.298%20c0,10.67,8.659,19.329,19.329,19.329h170.609C191.32,281.733,179.597,260.644,179.597,236.783z'/%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3c/svg%3e",Jf="/medplum/assets/health-visit-r-G_U59v.jpg",Yf="/medplum/assets/pharmacy-DeLDhUiJ.svg",Zf="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2019.0.0,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20x='0px'%20y='0px'%20viewBox='0%200%20297%20297'%20style='enable-background:new%200%200%20297%20297;'%20xml:space='preserve'%3e%3cg%3e%3cg%3e%3cg%3e%3ccircle%20style='fill:%23345F41;'%20cx='148.5'%20cy='148.5'%20r='148.5'/%3e%3c/g%3e%3c/g%3e%3cpath%20style='fill:%231F4429;'%20d='M203.735,62.932L65.332,201.294l95.18,95.221c73.929-5.918,132.589-65.976,136.3-140.506%20L203.735,62.932z'/%3e%3cpath%20style='fill:%23D0D5D9;'%20d='M173.25,214.5L173.25,214.5c-22.782,0-41.25-18.468-41.25-41.25v-82.5%20c0-22.782,18.468-41.25,41.25-41.25l0,0c22.782,0,41.25,18.468,41.25,41.25v82.5C214.5,196.032,196.032,214.5,173.25,214.5z'/%3e%3cpath%20style='fill:%23BEC3C6;'%20d='M173.25,49.5L173.25,49.5c-0.812,0-1.616,0.03-2.416,0.076v164.848%20c0.8,0.046,1.605,0.076,2.416,0.076l0,0c22.782,0,41.25-18.468,41.25-41.25v-82.5C214.5,67.968,196.032,49.5,173.25,49.5z'/%3e%3cpath%20style='fill:%231ABC9C;'%20d='M132,130.5v42.75c0,22.782,18.468,41.25,41.25,41.25l0,0c22.782,0,41.25-18.468,41.25-41.25V130.5%20H132z'/%3e%3cpath%20style='fill:%2319A58A;'%20d='M170.834,130.5v83.924c0.8,0.046,1.605,0.076,2.416,0.076l0,0c22.782,0,41.25-18.468,41.25-41.25%20V130.5H170.834z'/%3e%3ccircle%20style='fill:%23FFFFFF;'%20cx='99'%20cy='165'%20r='49.5'/%3e%3cpath%20style='fill:%23D0D5D9;'%20d='M127.675,205.342c2.217-1.579,4.338-3.352,6.327-5.34c1.989-1.989,3.761-4.11,5.34-6.327%20l-69.017-69.017c-2.217,1.58-4.338,3.352-6.327,5.34s-3.761,4.11-5.34,6.327L127.675,205.342z'/%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3c/svg%3e",Kf="_announcements_1mu73_2",Xf="_hero_1mu73_9",ep="_heroContainer_1mu73_16",tp="_heroTitle_1mu73_33",np="_heroButton_1mu73_50",rp="_callToAction_1mu73_59",ip="_card_1mu73_67",xe={announcements:Kf,hero:Xf,heroContainer:ep,heroTitle:tp,heroButton:np,callToAction:rp,card:ip},sp=[{img:r.jsx(Yt,{}),title:"Welcome to Foo Medical",description:"Lorem ipsum at porta donec ultricies ut, arcu morbi amet arcu ornare, curabitur pharetra magna tempus",url:"/get-care",label:"Learn how we help"},{img:r.jsx(Yt,{}),title:"Verify Email",description:"Lorem ipsum at porta donec ultricies ut, arcu morbi amet arcu ornare, curabitur pharetra magna tempus",url:"/account",label:"Send verification email"},{img:r.jsx(Yt,{}),title:"Select a Doctor",description:"Lorem ipsum at porta donec ultricies ut, arcu morbi amet arcu ornare, curabitur pharetra magna tempus",url:"/account/provider/choose-a-primary-care-povider",label:"Choose a Primary Care Provider"},{img:r.jsx(Yt,{}),title:"Emergency Contact",description:"Lorem ipsum at porta donec ultricies ut, arcu morbi amet arcu ornare, curabitur pharetra magna tempus",url:"/account",label:"Add emergency contact"}],ap=[{img:Gf,title:"Health Record",description:"",href:"/health-record"},{img:Zf,title:"Request Prescription Renewal",description:"",href:"/health-record/medications"},{img:Yf,title:"Preferred Pharmacy",description:"Walgreens D2866 1363 Divisadero St  DIVISADERO",href:"#"}],op=[{title:"Get travel health recommendations",description:"Find out what vaccines and meds you need for your trip."},{title:"Get FSA/HSA reimbursement",description:"Request a prescription for over-the-counter items."},{title:"Request health record",description:"Get records sent to or from Foo Medical."}];function cp(){const e=Se(),t=Fe(),n=yn(),i=n.name?Vt(n.name[0]):"";return r.jsxs(B,{bg:"gray.0",children:[r.jsx(B,{className:xe.announcements,children:r.jsxs("span",{children:["Announcements go here. ",r.jsx(Y,{href:"#",children:"Include links if needed."})]})}),r.jsxs("div",{className:xe.hero,children:[r.jsx(Qa,{gradient:"linear-gradient(180deg, rgba(0, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.4) 40%)",opacity:1,zIndex:0}),r.jsxs(se,{className:xe.heroContainer,children:[r.jsxs($,{className:xe.heroTitle,children:["Hi ",r.jsx("span",{className:"text-teal-600",children:i}),",",r.jsx("br",{})," were here to help"]}),r.jsx(O,{size:"xl",radius:"xl",className:xe.heroButton,children:"Get Care"})]})]}),r.jsx(B,{className:xe.callToAction,children:r.jsxs(D,{justify:"center",children:[r.jsx(so,{}),r.jsx("p",{children:"Put calls to action here"}),r.jsx(O,{variant:"white",onClick:()=>e("/messages"),children:"Send Message"})]})}),r.jsx(B,{p:"lg",children:r.jsx(se,{children:r.jsx(Oe,{children:sp.map((s,a)=>r.jsx(Oe.Col,{span:3,pb:40,children:r.jsxs(Ke,{shadow:"md",radius:"md",className:xe.card,p:"xl",children:[r.jsx(Hr,{}),r.jsx(T,{size:"lg",fw:500,mt:"md",children:s.title}),r.jsx(T,{size:"sm",color:"dimmed",my:"sm",children:s.description}),r.jsx(Y,{children:s.label})]})},`card-${a}`))})})}),r.jsx(B,{p:"lg",children:r.jsx(se,{children:r.jsxs(Ke,{shadow:"md",radius:"md",className:xe.card,p:"xl",children:[r.jsx(Hr,{}),r.jsx(T,{size:"lg",fw:500,mt:"md",children:"Better rest, better health"}),r.jsx(T,{size:"sm",color:"dimmed",my:"sm",children:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Maiores impedit perferendis suscipit eaque, iste dolor cupiditate blanditiis ratione. Lorem ipsum, dolor sit amet consectetur adipisicing elit. Maiores impedit perferendis suscipit eaque, iste dolor cupiditate blanditiis ratione."}),r.jsx(D,{children:r.jsx(O,{children:"Invite Friends"})})]})})}),r.jsx(B,{p:"lg",children:r.jsx(se,{children:r.jsx(Ke,{shadow:"md",radius:"md",className:xe.card,p:"xl",children:r.jsxs(Hi,{children:[r.jsx(qr,{src:Jf,m:"-40px 30px -40px -40px",w:"40%"}),r.jsxs("div",{children:[r.jsx(qi,{color:t.primaryColor,size:"xl",children:"Now available"}),r.jsx(T,{size:"lg",fw:500,mt:"md",children:"Title"}),r.jsx(T,{size:"sm",color:"dimmed",my:"sm",children:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Maiores impedit perferendis suscipit eaque, iste dolor cupiditate blanditiis ratione. Lorem ipsum, dolor sit amet consectetur adipisicing elit. Maiores impedit perferendis suscipit eaque, iste dolor cupiditate blanditiis ratione."})]})]})})})}),r.jsx(B,{p:"lg",children:r.jsx(se,{children:r.jsx(Oe,{columns:3,pb:"xl",children:ap.map((s,a)=>r.jsx(Oe.Col,{span:1,children:r.jsxs(Ke,{shadow:"md",radius:"md",className:xe.card,p:"xl",children:[r.jsx(qr,{src:s.img,w:80}),r.jsx(T,{size:"lg",fw:500,mt:"md",children:s.title})]})},`card-${a}`))})})}),r.jsx(B,{p:"lg",children:r.jsx(se,{children:r.jsxs(Oe,{columns:2,pb:"xl",children:[r.jsx(Oe.Col,{span:1,children:r.jsx(Ke,{shadow:"md",radius:"md",className:xe.card,p:"xl",children:r.jsxs(D,{wrap:"nowrap",children:[r.jsx(en,{src:Qf,size:"xl"}),r.jsxs("div",{children:[r.jsx(T,{fw:500,children:"Primary Care Provider"}),r.jsx(T,{size:"sm",color:"dimmed",my:"sm",children:"Having a consistent, trusted provider can lead to better health."}),r.jsx(O,{onClick:()=>e("/account/provider"),children:"Choose Provider"})]})]})})}),r.jsx(Oe.Col,{span:1,children:r.jsx(Ke,{shadow:"md",radius:"md",className:xe.card,p:"xl",children:r.jsx(F,{children:op.map((s,a)=>r.jsxs("div",{children:[r.jsx(T,{fw:500,children:s.title}),r.jsx(T,{size:"sm",color:"dimmed",my:"sm",children:s.description})]},`recommendation-${a}`))})})})]})})})]})}const lp="_tableBody_bk04g_1",Ui={tableBody:lp};function up(){const[e]=Ls("Practitioner"),t=Se();return e?r.jsxs(Ze,{width:800,children:[r.jsx($,{children:"Chats"}),r.jsx(ht,{my:"xl"}),r.jsx(F,{gap:"xl",children:r.jsxs(P,{highlightOnHover:!0,children:[r.jsx(P.Thead,{children:r.jsx(P.Tr,{children:r.jsx(P.Th,{children:"Name"})})}),r.jsx(P.Tbody,{className:Ui.tableBody,children:e.map(n=>{var i,s;return r.jsx(P.Tr,{className:Ui.tr,onClick:()=>t(`/messages/${n.id}`),children:r.jsxs(P.Td,{children:[er((i=n.name)==null?void 0:i[0])," ",ps((s=n.name)==null?void 0:s[0])]})},n.id)})})]})})]}):r.jsx(Rt,{})}function dp(){var u;const e=L(),t=yn(),n=h.useMemo(()=>t?Le(t):void 0,[t]),[i,s]=h.useState([]),{practitionerId:a}=Je(),o=we({reference:`Practitioner/${a}`}),c=h.useCallback(d=>{if(!o||!n)return;const m=Le(o);e.createResource({resourceType:"Communication",status:"in-progress",sender:n,subject:n,recipient:[m],sent:new Date().toISOString(),payload:[{contentString:d}]}).catch(f=>{Ne({color:"red",icon:r.jsx(tn,{}),title:"Error",message:be(f)})})},[e,n,o]),l=h.useCallback(d=>{d.received||e.updateResource({...d,status:"completed",received:new Date().toISOString()}).catch(m=>{Ne({color:"red",icon:r.jsx(tn,{}),title:"Error",message:be(m)})})},[e]);return n?o?r.jsx(Ze,{width:800,children:r.jsx(nf,{title:`Chat with ${er((u=o.name)==null?void 0:u[0])}`,query:`sender=${Z(t)},Practitioner/${a}&recipient=${Z(t)},Practitioner/${a}`,communications:i,setCommunications:s,sendMessage:c,onMessageReceived:l,h:600})}):r.jsx(Rt,{}):r.jsx(Ft,{color:"red",children:"Error: Provider profile not found"})}function hp(){const e=Se(),t=L(),{questionnaireId:n}=Je(),i=we({reference:`Questionnaire/${n}`}),s=h.useCallback(a=>{i&&t.createResource(a).then(()=>{Ne({icon:r.jsx(Zi,{}),title:"Success",message:"Answers recorded"}),e("/health-record/questionnaire-responses/"),window.scrollTo(0,0)}).catch(o=>{Ne({color:"red",icon:r.jsx(tn,{}),title:"Error",message:be(o)})})},[t,e,i]);return i?r.jsx(Ze,{width:800,children:r.jsx(ja,{questionnaire:i,onSubmit:s})}):r.jsx(Rt,{})}function mp(){const e=L(),{observationId:t=""}=Je(),n=e.readResource("Observation",t).read();return r.jsxs(Ze,{children:[r.jsx($,{children:"Observation"}),r.jsx(bn,{value:n,ignoreMissingValues:!0})]})}function fp(){const e=L();return h.useEffect(()=>{e.signOut().then(()=>{window.location.href="/"}).catch(console.error)},[e]),null}function pp(){return r.jsxs(Yi,{children:[r.jsx(V,{path:"/",element:r.jsx(cp,{})}),r.jsx(V,{path:"messages/",element:r.jsx(up,{})}),r.jsx(V,{path:"messages/:practitionerId",element:r.jsx(dp,{})}),r.jsx(V,{path:"Questionnaire/:questionnaireId",element:r.jsx(hp,{})}),r.jsxs(V,{path:"health-record/*",element:r.jsx(Tf,{}),children:[r.jsx(V,{index:!0,element:r.jsx(Kt,{replace:!0,to:"/health-record/lab-results"})}),r.jsx(V,{path:"lab-results/*",element:r.jsx(If,{})}),r.jsx(V,{path:"lab-results/:resultId",element:r.jsx(Pf,{})}),r.jsx(V,{path:"medications",element:r.jsx(Uf,{})}),r.jsx(V,{path:"medications/:medicationId",element:r.jsx(Lf,{})}),r.jsx(V,{path:"questionnaire-responses",element:r.jsx(Ff,{})}),r.jsx(V,{path:"questionnaire-responses/:responseId",element:r.jsx(Bf,{})}),r.jsx(V,{path:"vaccines",element:r.jsx(zf,{})}),r.jsx(V,{path:"vaccines/:vaccineId",element:r.jsx(qf,{})}),r.jsx(V,{path:"vitals",element:r.jsx(Wf,{})}),r.jsx(V,{path:"vitals/:measurementId",element:r.jsx(Of,{})})]}),r.jsx(V,{path:"Observation/:observationId",element:r.jsx(mp,{})}),r.jsxs(V,{path:"care-plan/*",element:r.jsx(jf,{}),children:[r.jsx(V,{index:!0,element:r.jsx(Kt,{replace:!0,to:"/care-plan/action-items"})}),r.jsx(V,{path:"action-items",element:r.jsx(Cf,{})}),r.jsx(V,{path:"action-items/:itemId",element:r.jsx(bf,{})})]}),r.jsx(V,{path:"get-care/*",element:r.jsx(wf,{})}),r.jsxs(V,{path:"account/*",element:r.jsx(uf,{}),children:[r.jsx(V,{index:!0,element:r.jsx(Kt,{replace:!0,to:"/account/profile"})}),r.jsx(V,{path:"profile",element:r.jsx(yf,{})}),r.jsx(V,{path:"provider/*",element:r.jsx(xf,{})}),r.jsx(V,{path:"membership-and-billing",element:r.jsx(gf,{})})]}),r.jsx(V,{path:"signout",element:r.jsx(fp,{})})]})}const gp="_footer_g9hhf_1",yp="_inner_g9hhf_5",Fi={footer:gp,inner:yp};function Ia(){return r.jsx("footer",{className:Fi.footer,children:r.jsx("div",{className:Fi.inner,children:r.jsx(se,{p:"xl",children:r.jsxs(F,{gap:"xl",children:[r.jsxs(dn,{cols:4,children:[r.jsx(Y,{href:"https://www.medplum.com/docs/tutorials/api-basics/create-fhir-data",children:"Getting started"}),r.jsx(Y,{href:"https://www.medplum.com/docs/tutorials",children:"Playing with Medplum"}),r.jsx(Y,{href:"https://github.com/medplum/foomedical",children:"Open Source"}),r.jsx(Y,{href:"https://www.medplum.com/docs",children:"Documentation"})]}),r.jsx(ht,{}),r.jsxs(T,{c:"dimmed",size:"sm",children:[" ",new Date().getFullYear()," Foo Medical, Inc. All rights reserved."]})]})})})})}const xp="_inner_lxi02_1",vp="_logoButton_lxi02_8",jp="_links_lxi02_19",bp="_burger_lxi02_25",Cp="_link_lxi02_19",wp="_linkLabel_lxi02_46",Sp="_user_lxi02_50",kp="_userActive_lxi02_65",ut={inner:xp,logoButton:vp,links:jp,burger:bp,link:Cp,linkLabel:wp,user:Sp,userActive:kp};function Ra(e){const n=Fe().primaryColor,i=e.width,s=Math.round(180/1050*i);return r.jsxs("svg",{width:"1050",height:"180",viewBox:"0 0 1343 150",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:i,height:s,color:n},children:[r.jsx("path",{d:"M222.183 59.8846V146.43H251.385V59.8846H271.538V40.4016H251.385V34.044C251.385 29.6689 252.207 26.5926 253.852 24.8152C255.635 22.9011 258.514 21.944 262.49 21.944C266.191 21.944 269.756 22.1491 273.183 22.5593V0.820341C270.716 0.683619 268.179 0.546899 265.574 0.410178C262.97 0.136728 260.365 0 257.76 0C245.832 0 236.921 3.00791 231.026 9.02372C225.13 15.0395 222.183 22.7644 222.183 32.1982V40.4016H204.703V59.8846H222.183Z",fill:"currentColor"}),r.jsx("path",{d:"M310.202 93.5185C310.202 89.2801 310.613 85.11 311.435 81.0083C312.258 76.9066 313.629 73.2835 315.548 70.1389C317.605 66.9942 320.278 64.4649 323.569 62.5507C326.859 60.4999 330.972 59.4745 335.908 59.4745C340.843 59.4745 344.956 60.4999 348.246 62.5507C351.674 64.4649 354.347 66.9942 356.267 70.1389C358.323 73.2835 359.763 76.9066 360.585 81.0083C361.408 85.11 361.819 89.2801 361.819 93.5185C361.819 97.7569 361.408 101.927 360.585 106.029C359.763 109.994 358.323 113.617 356.267 116.898C354.347 120.043 351.674 122.572 348.246 124.486C344.956 126.4 340.843 127.357 335.908 127.357C330.972 127.357 326.859 126.4 323.569 124.486C320.278 122.572 317.605 120.043 315.548 116.898C313.629 113.617 312.258 109.994 311.435 106.029C310.613 101.927 310.202 97.7569 310.202 93.5185ZM281 93.5185C281 101.995 282.302 109.652 284.907 116.488C287.512 123.324 291.213 129.203 296.012 134.125C300.81 138.911 306.568 142.602 313.286 145.2C320.004 147.797 327.545 149.096 335.908 149.096C344.271 149.096 351.811 147.797 358.529 145.2C365.384 142.602 371.21 138.911 376.009 134.125C380.807 129.203 384.509 123.324 387.114 116.488C389.719 109.652 391.021 101.995 391.021 93.5185C391.021 85.0417 389.719 77.3852 387.114 70.549C384.509 63.5762 380.807 57.6971 376.009 52.9118C371.21 47.9897 365.384 44.2299 358.529 41.6321C351.811 38.8977 344.271 37.5304 335.908 37.5304C327.545 37.5304 320.004 38.8977 313.286 41.6321C306.568 44.2299 300.81 47.9897 296.012 52.9118C291.213 57.6971 287.512 63.5762 284.907 70.549C282.302 77.3852 281 85.0417 281 93.5185Z",fill:"currentColor"}),r.jsx("path",{d:"M435.92 93.5185C435.92 89.2801 436.331 85.11 437.154 81.0083C437.976 76.9066 439.347 73.2835 441.267 70.1389C443.323 66.9942 445.997 64.4649 449.287 62.5507C452.577 60.4999 456.69 59.4745 461.626 59.4745C466.561 59.4745 470.674 60.4999 473.965 62.5507C477.392 64.4649 480.066 66.9942 481.985 70.1389C484.042 73.2835 485.481 76.9066 486.304 81.0083C487.126 85.11 487.538 89.2801 487.538 93.5185C487.538 97.7569 487.126 101.927 486.304 106.029C485.481 109.994 484.042 113.617 481.985 116.898C480.066 120.043 477.392 122.572 473.965 124.486C470.674 126.4 466.561 127.357 461.626 127.357C456.69 127.357 452.577 126.4 449.287 124.486C445.997 122.572 443.323 120.043 441.267 116.898C439.347 113.617 437.976 109.994 437.154 106.029C436.331 101.927 435.92 97.7569 435.92 93.5185ZM406.718 93.5185C406.718 101.995 408.02 109.652 410.625 116.488C413.23 123.324 416.932 129.203 421.73 134.125C426.529 138.911 432.287 142.602 439.005 145.2C445.722 147.797 453.263 149.096 461.626 149.096C469.989 149.096 477.529 147.797 484.247 145.2C491.102 142.602 496.929 138.911 501.727 134.125C506.526 129.203 510.227 123.324 512.832 116.488C515.437 109.652 516.74 101.995 516.74 93.5185C516.74 85.0417 515.437 77.3852 512.832 70.549C510.227 63.5762 506.526 57.6971 501.727 52.9118C496.929 47.9897 491.102 44.2299 484.247 41.6321C477.529 38.8977 469.989 37.5304 461.626 37.5304C453.263 37.5304 445.722 38.8977 439.005 41.6321C432.287 44.2299 426.529 47.9897 421.73 52.9118C416.932 57.6971 413.23 63.5762 410.625 70.549C408.02 77.3852 406.718 85.0417 406.718 93.5185Z",fill:"currentColor"}),r.jsx("path",{d:"M593.785 40.4016V146.43H622.987V84.9049C622.987 79.7095 623.741 75.5394 625.249 72.3948C626.757 69.1134 628.54 66.6524 630.596 65.0118C632.79 63.2344 634.983 62.0722 637.177 61.5253C639.508 60.8417 641.358 60.4999 642.729 60.4999C647.391 60.4999 650.887 61.3202 653.217 62.9609C655.685 64.4649 657.399 66.5157 658.359 69.1134C659.455 71.7112 660.072 74.5824 660.209 77.727C660.347 80.7349 660.415 83.8112 660.415 86.9558V146.43H689.617V87.3659C689.617 84.0846 689.823 80.8716 690.234 77.727C690.782 74.4456 691.742 71.5745 693.113 69.1134C694.621 66.5157 696.609 64.4649 699.077 62.9609C701.682 61.3202 705.041 60.4999 709.154 60.4999C713.267 60.4999 716.488 61.1835 718.819 62.5507C721.287 63.918 723.138 65.7637 724.372 68.088C725.605 70.4123 726.359 73.1468 726.634 76.2914C726.908 79.436 727.045 82.7857 727.045 86.3405V146.43H756.247V75.4711C756.247 68.6349 755.287 62.8242 753.368 58.0389C751.448 53.1169 748.775 49.1519 745.348 46.144C741.92 43.1361 737.807 40.9485 733.009 39.5813C728.21 38.2141 723.001 37.5304 717.38 37.5304C709.976 37.5304 703.533 39.3078 698.049 42.8626C692.702 46.4174 688.452 50.5191 685.298 55.1677C682.419 48.605 678.169 44.0248 672.548 41.4271C667.064 38.8293 660.963 37.5304 654.246 37.5304C647.254 37.5304 641.016 39.0344 635.532 42.0423C630.185 45.0502 625.592 49.2886 621.753 54.7575H621.342V40.4016H593.785Z",fill:"currentColor"}),r.jsx("path",{d:"M850.896 82.0338H803.392C803.529 79.9829 803.94 77.6586 804.626 75.0609C805.448 72.4632 806.751 70.0021 808.533 67.6778C810.452 65.3536 812.92 63.4394 815.936 61.9355C819.09 60.2948 822.997 59.4745 827.658 59.4745C834.787 59.4745 840.066 61.3886 843.493 65.2168C847.058 69.0451 849.525 74.6507 850.896 82.0338ZM803.392 100.491H880.098C880.647 92.288 879.961 84.4264 878.042 76.9066C876.122 69.3869 872.969 62.6875 868.582 56.8084C864.332 50.9293 858.848 46.2807 852.13 42.8626C845.412 39.3078 837.529 37.5304 828.481 37.5304C820.392 37.5304 812.989 38.966 806.271 41.8372C799.69 44.7084 794 48.6734 789.202 53.7321C784.404 58.6541 780.702 64.5332 778.097 71.3694C775.492 78.2055 774.19 85.5885 774.19 93.5185C774.19 101.722 775.424 109.242 777.891 116.078C780.496 122.914 784.129 128.793 788.791 133.715C793.452 138.637 799.142 142.465 805.859 145.2C812.577 147.797 820.118 149.096 828.481 149.096C840.545 149.096 850.828 146.362 859.328 140.893C867.828 135.424 874.135 126.332 878.248 113.617H852.542C851.582 116.898 848.977 120.043 844.727 123.051C840.477 125.922 835.404 127.357 829.509 127.357C821.283 127.357 814.977 125.238 810.589 121C806.202 116.761 803.803 109.925 803.392 100.491Z",fill:"currentColor"}),r.jsx("path",{d:"M972.891 93.1083C972.891 97.4835 972.479 101.722 971.657 105.824C970.834 109.925 969.463 113.617 967.544 116.898C965.624 120.043 963.019 122.572 959.729 124.486C956.576 126.4 952.6 127.357 947.802 127.357C943.277 127.357 939.37 126.4 936.08 124.486C932.926 122.435 930.253 119.838 928.059 116.693C926.003 113.412 924.495 109.72 923.535 105.618C922.575 101.517 922.096 97.4151 922.096 93.3134C922.096 88.9383 922.507 84.7682 923.329 80.8033C924.289 76.7016 925.729 73.0784 927.648 69.9338C929.705 66.7891 932.378 64.2598 935.668 62.3457C938.959 60.4315 943.003 59.4745 947.802 59.4745C952.6 59.4745 956.576 60.4315 959.729 62.3457C962.882 64.2598 965.419 66.7891 967.338 69.9338C969.395 72.9417 970.834 76.4965 971.657 80.5982C972.479 84.5631 972.891 88.7332 972.891 93.1083ZM973.302 132.895V146.43H1001.06V0H971.862V53.3219H971.451C968.161 48.1265 963.636 44.2299 957.878 41.6321C952.257 38.8977 946.293 37.5304 939.987 37.5304C932.172 37.5304 925.317 39.1028 919.422 42.2474C913.527 45.2553 908.591 49.2886 904.615 54.3474C900.777 59.4061 897.829 65.2852 895.773 71.9846C893.853 78.5473 892.894 85.3835 892.894 92.4931C892.894 99.8761 893.853 106.986 895.773 113.822C897.829 120.658 900.777 126.742 904.615 132.074C908.591 137.27 913.595 141.44 919.628 144.584C925.66 147.592 932.652 149.096 940.604 149.096C947.596 149.096 953.834 147.866 959.318 145.405C964.939 142.807 969.463 138.637 972.891 132.895H973.302Z",fill:"currentColor"}),r.jsx("path",{d:"M1053.16 23.9949V0H1023.96V23.9949H1053.16ZM1023.96 40.4016V146.43H1053.16V40.4016H1023.96Z",fill:"currentColor"}),r.jsx("path",{d:"M1148.54 77.727H1177.13C1176.72 70.8908 1175.07 65.0118 1172.19 60.0897C1169.31 55.031 1165.54 50.8609 1160.88 47.5796C1156.36 44.1615 1151.15 41.6321 1145.25 39.9915C1139.49 38.3508 1133.46 37.5304 1127.16 37.5304C1118.52 37.5304 1110.84 38.966 1104.12 41.8372C1097.4 44.7084 1091.72 48.7417 1087.05 53.9372C1082.39 58.9959 1078.83 65.0801 1076.36 72.1897C1074.03 79.1626 1072.86 86.7507 1072.86 94.9541C1072.86 102.884 1074.17 110.199 1076.77 116.898C1079.38 123.461 1083.01 129.135 1087.67 133.92C1092.33 138.705 1097.95 142.465 1104.53 145.2C1111.25 147.797 1118.59 149.096 1126.54 149.096C1140.66 149.096 1152.24 145.405 1161.29 138.022C1170.34 130.639 1175.83 119.906 1177.74 105.824H1149.57C1148.61 112.386 1146.21 117.65 1142.37 121.615C1138.67 125.443 1133.32 127.357 1126.33 127.357C1121.81 127.357 1117.97 126.332 1114.82 124.281C1111.66 122.23 1109.13 119.633 1107.21 116.488C1105.43 113.207 1104.12 109.583 1103.3 105.618C1102.48 101.653 1102.07 97.7569 1102.07 93.9287C1102.07 89.9637 1102.48 85.9987 1103.3 82.0338C1104.12 77.9321 1105.49 74.2405 1107.41 70.9592C1109.47 67.5411 1112.07 64.8067 1115.23 62.7558C1118.38 60.5683 1122.29 59.4745 1126.95 59.4745C1139.43 59.4745 1146.62 65.5586 1148.54 77.727Z",fill:"currentColor"}),r.jsx("path",{d:"M1193.01 73.01C1193.42 66.1739 1195.13 60.4999 1198.15 55.988C1201.16 51.4762 1205 47.853 1209.67 45.1186C1214.33 42.3841 1219.54 40.47 1225.29 39.3762C1231.19 38.1457 1237.08 37.5304 1242.98 37.5304C1248.33 37.5304 1253.74 37.9406 1259.23 38.7609C1264.71 39.4446 1269.71 40.8802 1274.24 43.0677C1278.76 45.2553 1282.46 48.3316 1285.34 52.2965C1288.22 56.1248 1289.66 61.2519 1289.66 67.6778V122.846C1289.66 127.631 1289.94 132.211 1290.48 136.586C1291.03 140.961 1291.99 144.243 1293.36 146.43H1263.75C1263.2 144.79 1262.72 143.149 1262.31 141.508C1262.04 139.731 1261.83 137.953 1261.69 136.176C1257.03 140.961 1251.55 144.311 1245.24 146.225C1238.94 148.139 1232.49 149.096 1225.91 149.096C1220.84 149.096 1216.11 148.481 1211.72 147.251C1207.33 146.02 1203.5 144.106 1200.21 141.508C1196.91 138.91 1194.31 135.629 1192.39 131.664C1190.61 127.699 1189.72 122.982 1189.72 117.513C1189.72 111.498 1190.75 106.576 1192.8 102.747C1195 98.7823 1197.74 95.6377 1201.03 93.3134C1204.46 90.9891 1208.29 89.2801 1212.54 88.1863C1216.93 86.9558 1221.32 85.9987 1225.71 85.3151C1230.09 84.6315 1234.41 84.0846 1238.66 83.6744C1242.91 83.2643 1246.68 82.649 1249.97 81.8287C1253.26 81.0083 1255.87 79.8462 1257.79 78.3422C1259.71 76.7016 1260.6 74.3773 1260.46 71.3694C1260.46 68.2247 1259.91 65.7637 1258.81 63.9863C1257.86 62.0722 1256.48 60.6366 1254.7 59.6796C1253.06 58.5858 1251.07 57.9022 1248.74 57.6287C1246.54 57.2185 1244.15 57.0135 1241.54 57.0135C1235.78 57.0135 1231.26 58.244 1227.97 60.705C1224.68 63.166 1222.76 67.2677 1222.21 73.01H1193.01ZM1260.46 94.5439C1259.23 95.6377 1257.65 96.5264 1255.73 97.21C1253.95 97.7569 1251.96 98.2354 1249.77 98.6456C1247.71 99.0558 1245.52 99.3976 1243.19 99.671C1240.86 99.9445 1238.52 100.286 1236.19 100.696C1234 101.107 1231.81 101.653 1229.61 102.337C1227.56 103.021 1225.71 103.978 1224.06 105.208C1222.55 106.302 1221.32 107.738 1220.36 109.515C1219.4 111.292 1218.92 113.548 1218.92 116.283C1218.92 118.881 1219.4 121.068 1220.36 122.846C1221.32 124.623 1222.62 126.059 1224.27 127.152C1225.91 128.109 1227.83 128.793 1230.02 129.203C1232.22 129.613 1234.48 129.818 1236.81 129.818C1242.57 129.818 1247.02 128.861 1250.18 126.947C1253.33 125.033 1255.66 122.777 1257.17 120.179C1258.68 117.445 1259.57 114.711 1259.84 111.976C1260.25 109.242 1260.46 107.054 1260.46 105.413V94.5439Z",fill:"currentColor"}),r.jsx("path",{d:"M1313.15 0V146.43H1342.35V0H1313.15Z",fill:"currentColor"}),r.jsx("circle",{cx:"75.5",cy:"125",r:"25",fill:"currentColor"}),r.jsx("circle",{cx:"125.5",cy:"75",r:"25",fill:"currentColor"}),r.jsx("circle",{cx:"25.5",cy:"75",r:"25",fill:"currentColor"}),r.jsx("circle",{cx:"75.5",cy:"25",r:"25",fill:"currentColor"}),r.jsx("path",{d:"M70.4455 24.7864V69.518H25.7139V80.0548H70.4455V124.786H80.9823V80.0548H125.714V69.518H80.9823V24.7864H70.4455Z",fill:"white"})]})}const Ep=[{name:"Health Record",href:"/health-record"},{name:"Messages",href:"/messages"},{name:"Care Plan",href:"/care-plan"},{name:"Get Care",href:"/get-care"}];function Tp(){const e=Se(),t=yn(),n=Fe(),[i,{toggle:s}]=Dn(!1),[a,o]=h.useState(!1);return r.jsx(Ct.Header,{children:r.jsx(se,{children:r.jsxs("div",{className:ut.inner,children:[r.jsx(dt,{className:ut.logoButton,onClick:()=>e("/"),children:r.jsx(Ra,{width:240})}),r.jsx(D,{gap:5,className:ut.links,children:Ep.map(c=>r.jsx(to,{to:c.href,className:ut.link,children:c.name},c.name))}),r.jsxs(E,{width:260,shadow:"xl",position:"bottom-end",transitionProps:{transition:"pop-top-right"},onClose:()=>o(!1),onOpen:()=>o(!0),children:[r.jsx(E.Target,{children:r.jsx(dt,{className:zn(ut.user,{[ut.userActive]:a}),children:r.jsxs(D,{gap:7,children:[r.jsx(Ge,{radius:"xl",value:t}),r.jsx(An,{size:12,stroke:1.5})]})})}),r.jsxs(E.Dropdown,{children:[r.jsx(E.Item,{leftSection:r.jsx(ao,{size:16,color:n.colors.red[6],stroke:1.5}),onClick:()=>e("/account/profile"),children:"Your profile"}),r.jsx(E.Item,{leftSection:r.jsx(oo,{size:16,color:n.colors.blue[6],stroke:1.5}),onClick:()=>e("/account/profile"),children:"Settings"}),r.jsx(E.Item,{leftSection:r.jsx(co,{size:16,color:n.colors.gray[6],stroke:1.5}),onClick:()=>e("/signout"),children:"Sign out"})]})]}),r.jsx(Gi,{opened:i,onClick:s,className:ut.burger,size:"sm"})]})})})}const Da="",Aa="220709119901-j7kdbb1hoq15h0d5ssk53n99bmofun6k.apps.googleusercontent.com",Pp="6Lex6BcqAAAAAD8zk9NDc93QIlkslpQup3kcGB3T";function Ip(){const e=Se();return r.jsxs(dn,{cols:2,children:[r.jsx(B,{pt:100,pb:200,children:r.jsx(Qm,{type:"patient",projectId:Da,googleClientId:Aa,recaptchaSiteKey:Pp,onSuccess:()=>e("/"),children:r.jsx("h2",{children:"Register with Foo Medical"})})}),r.jsx(Ji,{src:"https://images.unsplash.com/photo-1556761175-4b46a572b786?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1567&q=80"})]})}function Rp(){const e=Se();return r.jsxs(dn,{cols:2,children:[r.jsx(B,{pt:100,pb:200,children:r.jsx(tf,{projectId:Da,googleClientId:Aa,onSuccess:()=>e("/"),children:r.jsx("h2",{children:"Sign in to Foo Medical"})})}),r.jsx(Ji,{src:"https://images.unsplash.com/photo-1556761175-4b46a572b786?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1567&q=80"})]})}const Dp="/medplum/assets/doctor-DdWHJM8D.jpg",Ap="/medplum/assets/engineering-Mr8bO-Mg.jpg",Mp="/medplum/assets/laboratory-CBokhpQP.jpg",_p="/medplum/assets/working-environment-ChbszdP2.jpg",Op="_logoButton_jtj7b_1",Lp="_link_jtj7b_11",Np="_subLink_jtj7b_31",Up="_dropdownFooter_jtj7b_41",Fp="_hiddenMobile_jtj7b_50",Bp="_hiddenDesktop_jtj7b_56",ce={logoButton:Op,link:Lp,subLink:Np,dropdownFooter:Up,hiddenMobile:Fp,hiddenDesktop:Bp},$p=[{icon:lo,title:"Open source",description:"This Pokmons cry is very loud and distracting"},{icon:uo,title:"Free for everyone",description:"The fluid of Smeargles tail secretions changes"},{icon:ho,title:"Documentation",description:"Yanma is capable of seeing 360 degrees without"},{icon:mo,title:"Security",description:"The shells rounded shape and the grooves on its."},{icon:fo,title:"Analytics",description:"This Pokmon uses its flying ability to quickly chase"},{icon:po,title:"Notifications",description:"Combusken battles with the intensely hot flames it spews"}];function qp(){const e=Se(),[t,{toggle:n,close:i}]=Dn(!1),[s,{toggle:a}]=Dn(!1),o=Fe(),c=$p.map(l=>r.jsx(dt,{className:ce.subLink,children:r.jsxs(D,{wrap:"nowrap",align:"flex-start",children:[r.jsx(Ga,{size:34,variant:"default",radius:"md",children:r.jsx(l.icon,{style:{width:Vr(22),height:Vr(22)},color:o.primaryColor})}),r.jsxs("div",{children:[r.jsx(T,{size:"sm",fw:500,children:l.title}),r.jsx(T,{size:"xs",c:"dimmed",children:l.description})]})]})},l.title));return r.jsxs(r.Fragment,{children:[r.jsx(Ct.Header,{px:"md",children:r.jsx(se,{h:"100%",children:r.jsxs(D,{justify:"space-between",h:"100%",children:[r.jsx(dt,{className:ce.logoButton,onClick:()=>e("/"),children:r.jsx(Ra,{width:240})}),r.jsxs(D,{style:{height:"100%"},gap:0,className:ce.hiddenMobile,children:[r.jsxs(En,{width:600,position:"bottom",radius:"md",shadow:"md",withinPortal:!0,children:[r.jsx(En.Target,{children:r.jsx("a",{href:"#",className:ce.link,children:r.jsxs(fe,{inline:!0,children:[r.jsx(B,{component:"span",mr:5,children:"Services"}),r.jsx(An,{size:16})]})})}),r.jsxs(En.Dropdown,{style:{overflow:"hidden"},children:[r.jsxs(D,{justify:"space-between",px:"md",children:[r.jsx(T,{fw:500,children:"Services"}),r.jsx(Y,{href:"#",size:"xs",children:"View all"})]}),r.jsx(ht,{my:"sm",mx:"-md"}),r.jsx(dn,{cols:2,spacing:0,children:c}),r.jsx("div",{className:ce.dropdownFooter,children:r.jsxs(D,{justify:"space-between",children:[r.jsxs("div",{children:[r.jsx(T,{fw:500,size:"sm",children:"Get started"}),r.jsx(T,{size:"xs",color:"dimmed",children:"Their food sources have decreased, and their numbers"})]}),r.jsx(O,{variant:"default",children:"Get started"})]})})]})]}),r.jsx("a",{href:"#",className:ce.link,children:"Counseling"}),r.jsx("a",{href:"#",className:ce.link,children:"Physicians"}),r.jsx("a",{href:"#",className:ce.link,children:"More"})]}),r.jsxs(D,{className:ce.hiddenMobile,children:[r.jsx(O,{variant:"default",onClick:()=>e("/signin"),children:"Log in"}),r.jsx(O,{onClick:()=>e("/register"),children:"Sign up"})]}),r.jsx(Gi,{opened:t,onClick:n,className:ce.hiddenDesktop})]})})}),r.jsx(Ja,{opened:t,onClose:i,size:"100%",padding:"md",title:"Navigation",className:ce.hiddenDesktop,zIndex:1e6,children:r.jsxs(Wi,{style:{height:"calc(100vh - 60px)"},mx:"-md",children:[r.jsx(ht,{my:"sm"}),r.jsx("a",{href:"#",className:ce.link,children:"Home"}),r.jsx(dt,{className:ce.link,onClick:a,children:r.jsxs(fe,{inline:!0,children:[r.jsx(B,{component:"span",mr:5,children:"Features"}),r.jsx(An,{size:16})]})}),r.jsx(Ya,{in:s,children:c}),r.jsx("a",{href:"#",className:ce.link,children:"Learn"}),r.jsx("a",{href:"#",className:ce.link,children:"Academy"}),r.jsx(ht,{my:"sm"}),r.jsxs(D,{justify:"center",grow:!0,pb:"xl",px:"md",children:[r.jsx(O,{variant:"default",onClick:()=>e("/signin"),children:"Log in"}),r.jsx(O,{onClick:()=>e("/register"),children:"Sign up"})]})]})})]})}const Vp="_outer_sjem9_1",zp="_inner_sjem9_6",Hp="_content_sjem9_20",Wp="_title_sjem9_25",Qp="_control_sjem9_39",Gp="_highlight_sjem9_45",Jp="_heroImage1_sjem9_49",Yp="_heroImage2_sjem9_50",Zp="_heroImage3_sjem9_51",Kp="_heroImage4_sjem9_52",Xp="_featureSection_sjem9_100",e0="_featureBox_sjem9_105",t0="_featureTitle_sjem9_112",n0="_featureDescription_sjem9_118",te={outer:Vp,inner:zp,content:Hp,title:Wp,control:Qp,highlight:Gp,heroImage1:Jp,heroImage2:Yp,heroImage3:Zp,heroImage4:Kp,featureSection:Xp,featureBox:e0,featureTitle:t0,featureDescription:n0},r0=[{title:"Comprehsive Care Plans",description:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Maiores impedit perferendis suscipit eaque, iste dolor cupiditate blanditiis ratione."},{title:"No hidden fees",description:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Maiores impedit perferendis suscipit eaque, iste dolor cupiditate blanditiis ratione."},{title:"24/7 Messaging",description:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Maiores impedit perferendis suscipit eaque, iste dolor cupiditate blanditiis ratione."},{title:"Clinically rigorous",description:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Maiores impedit perferendis suscipit eaque, iste dolor cupiditate blanditiis ratione."}];function i0(){const e=Fe();return r.jsxs(Ct,{className:te.outer,header:{height:100},children:[r.jsx(qp,{}),r.jsxs(Ct.Main,{className:te.outer,children:[r.jsx("img",{className:te.heroImage1,src:_p,alt:"Working Environment"}),r.jsx(se,{children:r.jsxs("div",{className:te.inner,children:[r.jsxs("div",{className:te.content,children:[r.jsxs($,{className:te.title,children:["An extraordinary",r.jsx("br",{}),r.jsx("span",{className:te.highlight,children:"doctor's office"})]}),r.jsx(T,{size:"lg",c:"dimmed",mt:"md",children:"This is not actually a medical practice, this is a sample open source application for developers to clone, customize and run."}),r.jsxs(D,{mt:30,children:[r.jsx(O,{radius:"xl",size:"md",className:te.control,children:"Get started"}),r.jsx(O,{variant:"default",radius:"xl",size:"md",className:te.control,children:"Source code"})]})]}),r.jsx("img",{className:te.heroImage2,src:Dp,alt:"Doctor"})]})}),r.jsx(se,{children:r.jsxs("div",{className:te.inner,children:[r.jsxs("div",{style:{width:500},children:[r.jsx($,{order:3,fw:500,c:e.primaryColor,mb:"lg",children:"Healthcare"}),r.jsx($,{order:1,fw:500,mb:"md",children:"A better way to get care"}),r.jsx(T,{size:"xl",c:"gray",children:"Lorem ipsum dolor sit amet consect adipisicing elit. Possimus magnam voluptatum cupiditate veritatis in accusamus quisquam."})]}),r.jsx("img",{className:te.heroImage3,src:Mp,alt:"Laboratory"})]})}),r.jsx(se,{children:r.jsxs("div",{className:zn(te.inner,te.featureSection),children:[r.jsx(F,{align:"flex-end",children:r0.map((t,n)=>r.jsxs(B,{className:te.featureBox,children:[r.jsx(T,{className:te.featureTitle,children:t.title}),r.jsx(T,{className:te.featureDescription,children:t.description})]},`feature-${n}`))}),r.jsx("img",{className:te.heroImage4,src:Ap,alt:"Laboratory"})]})})]}),r.jsx(Ia,{})]})}function s0(){const e=L();return e.isLoading()?null:e.getProfile()?r.jsxs(Ct,{header:{height:80},children:[r.jsx(Tp,{}),r.jsx(Ct.Main,{children:r.jsx(ld,{children:r.jsx(h.Suspense,{fallback:r.jsx(Rt,{}),children:r.jsx(pp,{})})})}),r.jsx(Ia,{})]}):r.jsxs(Yi,{children:[r.jsx(V,{path:"/",element:r.jsx(i0,{})}),r.jsx(V,{path:"signin",element:r.jsx(Rp,{})}),r.jsx(V,{path:"register",element:r.jsx(Ip,{})}),r.jsx(V,{path:"*",element:r.jsx(Kt,{replace:!0,to:"/"})})]})}const a0=new Ts({baseUrl:"http://localhost:8103/",onUnauthenticated:()=>window.location.href="/"}),o0=Xa({primaryColor:"teal",primaryShade:8,fontSizes:{xs:"0.6875rem",sm:"0.875rem",md:"0.875rem",lg:"1rem",xl:"1.125rem"},components:{Container:{defaultProps:{size:1200}}}}),c0=eo(document.getElementById("root"));c0.render(r.jsx(h.StrictMode,{children:r.jsx(no,{children:r.jsx(Nu,{medplum:a0,children:r.jsxs(Za,{theme:o0,children:[r.jsx(Ka,{}),r.jsx(s0,{})]})})})}));
